[
  {
    "objectID": "posts/lanategundir/index.html",
    "href": "posts/lanategundir/index.html",
    "title": "Dreifing húsnæðislánategunda hjá íslenskum heimilum",
    "section": "",
    "text": "Í nýjustu útgáfu af Fjármálastöðugleika birti Seðlabankinn tölur yfir hlutfall lánategunda hjá íslenskum heimilum. Ég hafði verið að spjalla við Ingva og Arnar hjá Pyngjunni um þessi gögn þ.a. ég útbjó snöggvast gagnvirka HTML skýrslu með Quarto í RStudio og sendi á kauðana.\nMyndirnar hér eru teiknaðar með blöndu af ggplot2 og plotly. Hreyfið músina yfir stöplana til að sjá merkingar (hlutföll, tegund lána eða tegund vaxta). Þið getið smellt á code flipana til að sjá undirliggjandi kóðann á bakvið skýrsluna. Kóðann í heild sinni má svo finna á githubinu mínu.\nSvo er lítið mál að uppfæra slíkar skýrslur sjálfkrafa ef slóðin að gögnum sem eru notuð og uppsetning þeirra helst óbreytt.\n\nAllar undirtegundirTegund vaxtaTegund lánsMánaðarleg breyting\n\n\n\n\nCode\np <- d |> \n    mutate(dags = as_date(dags),\n           value = value / 100,\n           text = str_c(\"Dagsetning: \", dags, \"\\n\",\n                        \"Tegund láns: \", tegund1, \"\\n\",\n                        \"Tegund vaxta: \", str_to_title(tegund2), \"\\n\",\n                        \"Hlutfall: \", percent(value))) |> \n    ggplot(aes(dags, value, text = text)) +\n    geom_col(aes(fill = paste(tegund1, \"og\", tegund2)), position = \"stack\") +\n    scale_x_date(date_labels = \"%m/%y\",\n                 expand = expansion()) +\n    scale_y_continuous(labels = label_percent(big.mark = \".\",\n                                              decimal.mark = \",\"),\n                       breaks = c(0, 0.2, 0.4, 0.6, 0.8, 1),\n                       expand = expansion()) +\n    scale_fill_brewer(type = \"qual\", palette = \"Set1\") +\n    theme_half_open() +\n    theme(legend.position = \"none\",\n          axis.text = element_text(size = 10)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Dreifing húsnæðislánategunda heimila\")\n\nggsave(plot = p + \n           theme(legend.position = \"top\", legend.text = element_text(size = 11)), \n       filename = \"dreifing.png\",\n       width = 8, height = 0.5 * 8, scale = 1.3, bg = \"white\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\np <- d |> \n    mutate(dags = as_date(dags),\n           value = value / 100) |> \n    group_by(dags, tegund2) |> \n    summarise(value = sum(value),\n              .groups = \"drop\") |> \n    mutate(text = str_c(\"Dagsetning: \", dags, \"\\n\",\n                        \"Tegund láns: \", \"Heild\", \"\\n\",\n                        \"Tegund vaxta: \", str_to_title(tegund2), \"\\n\",\n                        \"Hlutfall: \", percent(value))) |> \n    ggplot(aes(dags, value, text = text)) +\n    geom_col(aes(fill = paste(tegund2)), position = \"stack\") +\n    scale_x_date(date_labels = \"%m/%y\",\n                 expand = expansion()) +\n    scale_y_continuous(labels = label_percent(big.mark = \".\",\n                                              decimal.mark = \",\"),\n                       breaks = c(0, 1),\n                       expand = expansion()) +\n    scale_fill_brewer(type = \"qual\", palette = \"Set1\") +\n    theme_half_open() +\n    theme(legend.position = \"none\",\n          axis.text = element_text(size = 10)) +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Dreifing vaxtategunda heimila\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\np <- d |> \n    mutate(dags = as_date(dags)) |> \n    group_by(dags, tegund1) |> \n    summarise(value = sum(value/100),\n              .groups = \"drop\") |> \n    mutate(text = str_c(\"Dagsetning: \", dags, \"\\n\",\n                        \"Tegund láns: \", tegund1, \"\\n\",\n                        \"Tegund vaxta: \", \"Heild\", \"\\n\",\n                        \"Hlutfall: \", percent(value))) |> \n    ggplot(aes(dags, value, text = text)) +\n    geom_col(aes(fill = paste(tegund1)), position = \"stack\") +\n    scale_x_date(date_labels = \"%m/%y\",\n                 expand = expansion()) +\n    scale_y_continuous(labels = label_percent(big.mark = \".\",\n                                              decimal.mark = \",\"),\n                       breaks = c(0, 1),\n                       expand = expansion()) +\n    scale_fill_brewer(type = \"qual\", palette = \"Set1\") +\n    theme_half_open() +\n    theme(legend.position = \"none\",\n          axis.text = element_text(size = 10)) +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Dreifing lánategunda heimila\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <- d |> \n    bind_rows(\n        d |> \n            mutate(tegund1 = \"Heild\") |> \n            group_by(dags, tegund1, tegund2) |> \n            summarise(value = sum(value),\n                      .groups = \"drop\")\n    ) |> \n    bind_rows(\n        d |> \n            mutate(tegund2 = \"Heild\") |> \n            group_by(dags, tegund1, tegund2) |> \n            summarise(value = sum(value),\n                      .groups = \"drop\")\n    ) |> \n    mutate(name = str_c(tegund1, \" og \", tegund2),\n           dags = as_date(dags),\n           tegund2 = str_to_sentence(tegund2)) |> \n    group_by(name) |> \n    mutate(breyting = c(0, diff(value))/100) |> \n    ungroup() |> \n    mutate(text = str_c(\"Dagsetning: \", dags, \"\\n\",\n                        \"Tegund láns: \", tegund1, \"\\n\",\n                        \"Tegund vaxta: \", str_to_title(tegund2), \"\\n\",\n                        \"Breyting: \", percent(breyting, suffix = \"%-stig\")))\n\n\np <- plot_dat |> \n    ggplot(aes(dags, breyting, text = text)) +\n    geom_col(data = plot_dat |> \n                 rename(t1 = tegund1, t2 = tegund2, nm = name) |> \n                 filter(t1 != \"Heild\", t2 != \"Heild\"),\n             position = \"stack\", fill = \"grey80\", width = 28) +\n    geom_col(aes(fill = name), position = \"stack\", width = 28) +\n    geom_hline(yintercept = 0, lty = 2) +\n    scale_x_date(date_labels = \"%m/%y\") +\n    scale_y_continuous(labels = label_percent(suffix = \"%-stig\",\n                                              big.mark = \".\",\n                                              decimal.mark = \",\"),\n                       breaks = c(-0.04, -0.02, 0, 0.02, 0.04)) +\n    scale_fill_brewer(type = \"qual\", palette = \"Set1\") +\n    facet_grid(tegund2 ~ tegund1) +\n    theme_half_open() +\n    theme(legend.position = \"none\",\n          axis.text = element_text(size = 10)) +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Mánaðarleg breyting á húsnæðislánategundum heimila\")\n\nggsave(plot = p, filename = \"manbreyting.png\",\n       width = 8, height = 0.7 * 8, scale = 1.3, bg = \"white\")\n\nggplotly(p, tooltip = \"text\")"
  },
  {
    "objectID": "posts/kosningarannsokn/index.html",
    "href": "posts/kosningarannsokn/index.html",
    "title": "Kjósendatryggð",
    "section": "",
    "text": "Íslenska Kosningarannsóknin er framkvæmd af Félagsvísindastofnun Háskóla Íslands, og mér finnst vinnan sem fer fram þar hreint út sagt frábær og upplýsingar um gögnin vel skipulagðar, enda eina sviðið sem ég veit að sé með eigin RStudio server innanhúss!\nÞessi úrvinnsla byggir á Íslensku Kosningarannsókninni sem er framkvæmd af Félagsvísindastofnun Háskóla Íslands eftir alþingiskosninar. Notendaskilmálar GAGNÍS.\n\n\n\n\nCode\npreprocess_data_attrition <- function(doi, filename, year) {\n    get_dataframe_by_name(filename,\n                          doi,\n                          original = TRUE,\n                          .f = haven::read_sav) |> \n        select(current = starts_with(\"prtvote\"), former = starts_with(\"prtfvote\"), age) |> \n        mutate_at(vars(everything(), -age), as_factor) |> \n        filter(!as.character(current) %in% c(\"No, did not vote\",\n                                             \"Not applicable\",\n                                             \"Don‘t remember what I voted\",\n                                             \"95\",\n                                             \"Cast a blank or invalid ballot\",\n                                             \"Voted, refuses to say for what party\",\n                                             \"Other party, what party\",\n                                             \"Refuses to answer (volunteered)\",\n                                             \"Don’t know (volunteered)\",\n                                             \"Voted, does not want to say which party\",\n                                             \"Cast a blank ballot\",\n                                             \"Cast an invalid vote\",\n                                             \"Missing\",\n                                             \"Voted, doesn‘t want to say for what party\",\n                                             \"Another party or party list, which?\",\n                                             \"Refuses to answer\")) |> \n        drop_na(current) |> \n        group_by(current, former) |> \n        summarise(n = n(),\n                  age = mean(age),\n                  .groups = \"drop\") |> \n        arrange(former, desc(n)) |> \n        group_by(former) |> \n        mutate(p = n / sum(n),\n               cum_p = cumsum(p)) |> \n        ungroup() |> \n        mutate(year = year)\n}\n\ntranslate_parties <- function(name) {\n    parties <- c(\n        \"Independence Party\" = \"Sjálfstæðisflokkurinn\",\n        \"Progressive Party\" = \"Framsóknarflokkurinn\",\n        \"Social Democratic Alliance\" = \"Samfylkingin\",\n        \"Left Green Movement\" = \"Vinstri Græn\",\n        \"Pirate Party\" = \"Píratar\",\n        \"Reform Party\" = \"Viðreisn\",\n        \"Centre Party\" = \"Miðflokkurinn\",\n        \"Bright Future\" = \"Björt Framtíð\",\n        \"Peoples party\" = \"Flokkur Fólksins\",\n        \"Civic Movement\" = \"Borgarahreyfingin\",\n        \"Dawn\" = \"Dögun\",\n        \"Liberal Party\" = \"Frjálslyndi flokkurinn\",\n        \"Cast a blank or invalid ballot\" = \"Skilaði auðu\",\n        \"95\" = \"Nýr kjósandi\"\n    )\n    \n    ifelse(name %in% names(parties), parties[name], name)\n}\n\n\n\n\nCode\ndoi <- c(\"doi:10.34881/1.00011\", \n         \"doi:10.34881/1.00010\",\n         \"doi:10.34881/1.00009\",\n         \"doi:10.34881/1.00008\",\n         \"doi:10.34881/1.00007\",\n         \"doi:10.34881/1.00006\")\nfilename <- c(\"ICENES_2017_Open_access_english_1release.tab\",\n              \"ICENES_2016_Open_access_english_2release.tab\",\n              \"ICENESS_2013_open_access_english_1release.tab\",\n              \"ICENES_2009_open_access_english_3release.tab\",\n              \"ICENES_2007_open_access_english_3release.tab\",\n              \"ICENES_2003_open_access_english_4release.tab\")\nyear <- c(2017,\n          2016,\n          2013,\n          2009,\n          2007,\n          2003)\n\nd_retention <- pmap(list(doi = doi, filename = filename, year = year), preprocess_data_attrition) |> \n    reduce(bind_rows) |> \n    mutate_at(vars(current, former), as.character) |> \n    mutate_at(vars(current, former), translate_parties)\n\n\n\n\nTil að auðvelda mér að merkja flokkana með réttum litum geymi ég hex kóða fyrir litina þeirra og set þá svo inn í litapallettur þar sem við á.\n\n\nCode\nxS <- \"#e41a1c\"\nxV <- \"#238b45\"\nxD <- \"#377eb8\"\nxP <- \"#984ea3\"\nxB <- \"#b2df8a\"\nxBF <- \"#cab2d6\"\nxC <- \"#ff7f00\"\nxM <- \"#08306b\"\nxFF <- \"#fee391\"\nAnnad <- \"#e5d8bd\"\n\n\n\n\n\n\nÞátttakendur eru m.a. spurðir hvað þau kusu í nýliðnum kosningum en líka hvað þau kusu þar á undan. Þótt svör við slíkum spurningum séu ekki 100% áreiðanleg getum við nálgað svör við spurningunni:\n“Hvaða % kjósenda flokks úr síðustu kosningum kaus hann aftur núna?”\n\n\nCode\nplot_dat <- d_retention |> \n    filter(current %in% c(\"Framsóknarflokkurinn\",\n                          \"Píratar\",\n                          \"Samfylkingin\",\n                          \"Sjálfstæðisflokkurinn\",\n                          \"Vinstri Græn\"),\n           current == former)\n\nplot_text <- plot_dat |> \n    filter(year == max(year)) |> \n    mutate(p = case_when(current == \"Píratar\" ~ p + 0.005,\n                         current == \"Framsóknarflokkurinn\" ~ p - 0.005,\n                         current == \"Samfylkingin\" ~ p + 0.00,\n                         TRUE ~ p))\n\n\np <- plot_dat |> \n    ggplot(aes(year, p)) +\n    geom_line(aes(col = current, group = current)) +\n    geom_point(aes(col = current, group = current)) +\n    geom_text(data = plot_text, \n              aes(label = current, col = current), hjust = 0, nudge_x = 0.2) +\n    geom_rangeframe() +\n    scale_y_continuous(limits = range(plot_dat$p), \n                       labels = label_percent(),\n                       breaks = c(range(plot_dat$p), 0.4, 0.5, 0.6, 0.7)) +\n    scale_x_continuous(breaks = c(2003, 2007, 2009, 2013, 2016, 2017),\n                       limits = c(2003, 2020)) +\n    scale_colour_manual(values = c(xB,\n                                   xP,\n                                   xS,\n                                   xD,\n                                   xV)) +\n    labs(title = \"Flokkshollusta í alþingiskosningum frá 2003 - 2017\",\n         subtitle = \"Hlutfall eigin kjósenda sem flokkur heldur í frá síðustu kosningum\",\n         x = NULL,\n         y = NULL) +\n    theme_tufte() +\n    theme(plot.caption = element_text(hjust = 0),\n          legend.position = \"none\",\n          plot.title = element_text(face = \"bold\"))\n\np\n\n\n\n\n\nCode\nggsave(plot = p, filename = \"flokkshollusta.png\",\n       width = 8, height = 0.5 * 8, scale = 1.3, bg = \"white\")\n\n\n\n\n\n\nSamfylkinginSjálfstæðisflokkurinnFramsóknarflokkurinnVinstri Græn\n\n\n\n\nCode\np <- d_retention |> \n    filter(former == \"Samfylkingin\") |> \n    mutate(current = ifelse(current %in% c(\"Samfylkingin\",\n                                           \"Vinstri Græn\",\n                                           \"Sjálfstæðisflokkurinn\", \n                                           \"Píratar\",\n                                           \"Framsóknarflokkurinn\", \n                                           \"Píratar\",\n                                           \"Björt Framtíð\",\n                                           \"Viðreisn\",\n                                           \"Miðflokkurinn\",\n                                           \"Flokkur Fólksins\"),\n                            current,\n                            \"Annað\")) |> \n    mutate(current = as_factor(current),\n           current = fct_reorder(current, p * (current != \"Annað\"), .fun = max)) |> \n    mutate(election = as.numeric(as.factor(year)),\n           text = str_c(\"Kaus síðast: \", former, \"\\n\",\n                        \"Kaus nú: \", current, \"\\n\",\n                        \"Hlutfall (af kjósendum síðast): \", percent(p, accuracy = 0.1))) |>\n    ggplot(aes(election, p, text = text)) +\n    geom_col(aes(fill = current), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xFF,\n                                 xM,\n                                 xD,\n                                 xC,\n                                 xB,\n                                 xP,\n                                 xBF,\n                                 xV,\n                                 xS)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert missir Samfylkingin kjósendur sína?\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\np <- d_retention |> \n    filter(former == \"Sjálfstæðisflokkurinn\") |> \n    mutate(current = ifelse(current %in% c(\"Samfylkingin\",\n                                           \"Vinstri Græn\",\n                                           \"Flokkur Fólksins\",\n                                           \"Sjálfstæðisflokkurinn\", \n                                           \"Píratar\",\n                                           \"Framsóknarflokkurinn\", \n                                           \"Píratar\",\n                                           \"Björt Framtíð\",\n                                           \"Viðreisn\",\n                                           \"Miðflokkurinn\"),\n                            current,\n                            \"Annað\")) |> \n    mutate(current = as_factor(current),\n           current = fct_reorder(current, p * (current != \"Annað\"), .fun = max),\n           curent = factor(current, levels = rev(levels(current)))) |> \n    mutate(election = as.numeric(as.factor(year)),\n           text = str_c(\"Kaus síðast: \", former, \"\\n\",\n                        \"Kaus nú: \", current, \"\\n\",\n                        \"Hlutfall (af kjósendum síðast): \", percent(p, accuracy = 0.1))) |>\n    ggplot(aes(election, p, text = text)) +\n    geom_col(aes(fill = current), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xP,\n                                 xFF,\n                                 xBF,\n                                 xV,\n                                 xM,\n                                 xC,\n                                 xB,\n                                 xS,\n                                 xD)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert missir Sjálfstæðisflokkurinn kjósendur sína?\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\np <- d_retention |> \n    filter(former == \"Framsóknarflokkurinn\") |> \n    mutate(current = ifelse(current %in% c(\"Samfylkingin\",\n                                           \"Vinstri Græn\",\n                                           \"Flokkur Fólksins\",\n                                           \"Sjálfstæðisflokkurinn\", \n                                           \"Píratar\",\n                                           \"Framsóknarflokkurinn\", \n                                           \"Píratar\",\n                                           \"Björt Framtíð\",\n                                           \"Viðreisn\",\n                                           \"Miðflokkurinn\"),\n                            current,\n                            \"Annað\")) |> \n    mutate(current = as_factor(current),\n           current = fct_reorder(current, p * (current != \"Annað\"), .fun = max),\n           curent = factor(current, levels = rev(levels(current)))) |> \n    mutate(election = as.numeric(as.factor(year)),\n           text = str_c(\"Kaus síðast: \", former, \"\\n\",\n                        \"Kaus nú: \", current, \"\\n\",\n                        \"Hlutfall (af kjósendum síðast): \", percent(p, accuracy = 0.1))) |>\n    ggplot(aes(election, p, text = text)) +\n    geom_col(aes(fill = current), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xBF,\n                                 xC,\n                                 xP,\n                                 xFF,\n                                 xV,\n                                 xS,\n                                 xD,\n                                 xM,\n                                 xB)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert missir Framsóknarflokkurinn kjósendur sína?\",\n         caption = \"Kóði og gögn: https://github.com/bgautijonsson/kosningarannsokn\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\np <- d_retention |> \n    filter(former == \"Vinstri Græn\") |> \n    mutate(current = ifelse(current %in% c(\"Samfylkingin\",\n                                           \"Flokkur Fólksins\",\n                                           \"Vinstri Græn\",\n                                           \"Sjálfstæðisflokkurinn\", \n                                           \"Píratar\",\n                                           \"Framsóknarflokkurinn\", \n                                           \"Píratar\",\n                                           \"Björt Framtíð\",\n                                           \"Viðreisn\",\n                                           \"Miðflokkurinn\"),\n                            current,\n                            \"Annað\")) |> \n    mutate(current = as_factor(current),\n           current = fct_reorder(current, p * (current != \"Annað\"), .fun = max),\n           curent = factor(current, levels = rev(levels(current)))) |> \n    mutate(election = as.numeric(as.factor(year)),\n           text = str_c(\"Kaus síðast: \", former, \"\\n\",\n                        \"Kaus nú: \", current, \"\\n\",\n                        \"Hlutfall (af kjósendum síðast): \", percent(p, accuracy = 0.1))) |>\n    ggplot(aes(election, p, text = text)) +\n    geom_col(aes(fill = current), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xM,\n                                 xFF,\n                                 xC,\n                                 xD,\n                                 xBF,\n                                 xB,\n                                 xP,\n                                 xS,\n                                 xV)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert missa Vinstri Græn kjósendur sína?\")\n\nggplotly(p, tooltip = \"text\")"
  },
  {
    "objectID": "posts/kosningarannsokn/index.html#útbúa-gögnin-1",
    "href": "posts/kosningarannsokn/index.html#útbúa-gögnin-1",
    "title": "Kjósendatryggð",
    "section": "Útbúa gögnin",
    "text": "Útbúa gögnin\n\n\nCode\npreprocess_data_recruitment <- function(doi, filename, year) {\n    get_dataframe_by_name(filename,\n                          doi,\n                          original = TRUE,\n                          .f = haven::read_sav) |> \n        select(current = starts_with(\"prtvote\"), former = starts_with(\"prtfvote\"), age) |> \n        mutate_at(vars(everything(), -age), as_factor) |> \n        filter(!as.character(former) %in% c(\"No, did not vote\",\n                                            \"Not applicable\",\n                                            \"Don‘t remember what I voted\",\n                                            \"95\",\n                                            \"Cast a blank or invalid ballot\",\n                                            \"Voted, refuses to say for what party\",\n                                            \"Other party, what party\",\n                                            \"Refuses to answer (volunteered)\",\n                                            \"Don’t know (volunteered)\",\n                                            \"Voted, does not want to say which party\",\n                                            \"Cast a blank ballot\",\n                                            \"Cast an invalid vote\",\n                                            \"Missing\",\n                                            \"Voted, doesn‘t want to say for what party\",\n                                            \"Another party or party list, which?\",\n                                            \"Refuses to answer\")) |> \n        drop_na(former) |> \n        group_by(current, former) |> \n        summarise(n = n(),\n                  age = mean(age),\n                  .groups = \"drop\") |> \n        arrange(current, desc(n)) |> \n        group_by(current) |> \n        mutate(p = n / sum(n),\n               cum_p = cumsum(p)) |> \n        ungroup() |> \n        mutate(year = year)\n}\n\ntranslate_parties <- function(name) {\n    parties <- c(\n        \"Independence Party\" = \"Sjálfstæðisflokkurinn\",\n        \"Progressive Party\" = \"Framsóknarflokkurinn\",\n        \"Social Democratic Alliance\" = \"Samfylkingin\",\n        \"Left Green Movement\" = \"Vinstri Græn\",\n        \"Pirate Party\" = \"Píratar\",\n        \"Reform Party\" = \"Viðreisn\",\n        \"Centre Party\" = \"Miðflokkurinn\",\n        \"Bright Future\" = \"Björt Framtíð\",\n        \"Peoples party\" = \"Flokkur Fólksins\",\n        \"Civic Movement\" = \"Borgarahreyfingin\",\n        \"Dawn\" = \"Dögun\",\n        \"Liberal Party\" = \"Frjálslyndi flokkurinn\"\n    )\n    \n    ifelse(name %in% names(parties), parties[name], name)\n}\n\nd_recruitment <- pmap(list(doi = doi, filename = filename, year = year), preprocess_data_recruitment) |> \n    reduce(bind_rows) |> \n    mutate_at(vars(current, former), as.character) |> \n    mutate_at(vars(current, former), translate_parties)"
  },
  {
    "objectID": "posts/kosningarannsokn/index.html#nýliðun-frá-öðrum-flokkum",
    "href": "posts/kosningarannsokn/index.html#nýliðun-frá-öðrum-flokkum",
    "title": "Kjósendatryggð",
    "section": "Nýliðun frá öðrum flokkum",
    "text": "Nýliðun frá öðrum flokkum\n\n\nCode\nplot_dat <- d_recruitment |> \n    filter(current %in% c(\"Framsóknarflokkurinn\",\n                          \"Píratar\",\n                          \"Samfylkingin\",\n                          \"Sjálfstæðisflokkurinn\",\n                          \"Vinstri Græn\"),\n           current != former,\n           !former %in% c(\"No, did not vote\",\n                          \"Not applicable\",\n                          \"Don‘t remember what I voted\",\n                          \"Nýr kjósandi\",\n                          \"Skilaði auðu\",\n                          \"Voted, refuses to say for what party\",\n                          \"Other party, what party\",\n                          \"Refuses to answer (volunteered)\",\n                          \"Don’t know (volunteered)\"),\n           !(current == \"Píratar\" & year == 2013), !(current %in% c(\"Flokkur Fólksins\", \"Viðreisn\") & year == 2016)) |> \n    group_by(current, year) |> \n    summarise(p = sum(p),\n              .groups = \"drop\")\n\nplot_text <- plot_dat |> \n    filter(year == max(year)) |> \n    mutate(p = case_when(current == \"Flokkur Fólksins\" ~ p + 0.025,\n                         current == \"Framsóknarflokkurinn\" ~ p - 0.01,\n                         current == \"Viðreisn\" ~ p - 0.01,\n                         TRUE ~ p))\n\n\np <- plot_dat |> \n    ggplot(aes(year, p)) +\n    geom_line(aes(col = current, group = current)) +\n    geom_point(aes(col = current, group = current)) +\n    geom_text(data = plot_text, \n              aes(label = current, col = current), hjust = 0, nudge_x = 0.2) +\n    geom_rangeframe() +\n    scale_y_continuous(limits = range(plot_dat$p), \n                       labels = label_percent(),\n                       breaks = c(range(plot_dat$p), 0.1, 0.2, 0.3, 0.4, 0.5, 0.6)) +\n    scale_x_continuous(breaks = c(2003, 2007, 2009, 2013, 2016, 2017),\n                       limits = c(2003, 2021.5)) +\n    scale_colour_manual(values = c(xB,\n                                   xP,\n                                   xS,\n                                   xD,\n                                   xV)) +\n    labs(title = \"Nýliðun kjósenda frá öðrum flokkum í alþingiskosningum frá 2003 - 2017\",\n         subtitle = \"Hlutfall kjósenda sem kusu annan flokk í síðustu kosningum\",\n         x = NULL,\n         y = NULL) +\n    theme_tufte() +\n    theme(plot.caption = element_text(hjust = 0),\n          legend.position = \"none\",\n          plot.title = element_text(face = \"bold\"))\n\np"
  },
  {
    "objectID": "posts/kosningarannsokn/index.html#hvaðan-sækja-flokkar-kjósendur-sína",
    "href": "posts/kosningarannsokn/index.html#hvaðan-sækja-flokkar-kjósendur-sína",
    "title": "Kjósendatryggð",
    "section": "Hvaðan sækja flokkar kjósendur sína?",
    "text": "Hvaðan sækja flokkar kjósendur sína?\n\nSamfylkinginSjálfstæðisflokkurinnFramsóknarflokkurinnVinstri GrænViðreisnPíratarMiðflokurinn\n\n\n\n\nCode\np <- d_recruitment |> \n    filter(current == \"Samfylkingin\") |> \n    mutate(former = ifelse(former %in% c(\"Samfylkingin\",\n                                         \"Vinstri Græn\",\n                                         \"Sjálfstæðisflokkurinn\", \n                                         \"Píratar\",\n                                         \"Framsóknarflokkurinn\", \n                                         \"Flokkur Fólksins\",\n                                         \"Píratar\",\n                                         \"Björt Framtíð\",\n                                         \"Viðreisn\",\n                                         \"Miðflokkurinn\"),\n                           former,\n                           \"Annað\")) |> \n    mutate(former = as_factor(former),\n           former = fct_reorder(former, p * (former != \"Annað\") + 1e-8 * (former == \"Miðflokkurinn\"), .fun = max),\n           election = as.numeric(as.factor(year)),\n           text = str_c(\"Kaus síðast: \", former, \"\\n\",\n                        \"Kaus nú: \", current, \"\\n\",\n                        \"Hlutfall (af kjósendum núna): \", percent(p, accuracy = 0.1))) |>\n    ggplot(aes(election, p, text = text)) +\n    geom_col(aes(fill = former), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xC,\n                                 xP,\n                                 xBF,\n                                 xB,\n                                 xD,\n                                 xV,\n                                 xS)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert sækir Samfylkingin kjósendur sína?\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\np <- d_recruitment |> \n    filter(current == \"Sjálfstæðisflokkurinn\") |> \n    mutate(former = ifelse(former %in% c(\"Samfylkingin\",\n                                         \"Vinstri Græn\",\n                                         \"Sjálfstæðisflokkurinn\", \n                                         \"Píratar\",\n                                         \"Framsóknarflokkurinn\", \n                                         \"Píratar\",\n                                         \"Björt Framtíð\",\n                                         \"Viðreisn\",\n                                         \"Miðflokkurinn\"),\n                           former,\n                           \"Annað\")) |> \n    mutate(former = as_factor(former),\n           former = fct_reorder(former, p * (former != \"Annað\"), .fun = max),\n           election = as.numeric(as.factor(year)),\n           text = str_c(\"Kaus síðast: \", former, \"\\n\",\n                        \"Kaus nú: \", current, \"\\n\",\n                        \"Hlutfall (af kjósendum núna): \", percent(p, accuracy = 0.1))) |>\n    ggplot(aes(election, p, text = text)) +\n    geom_col(aes(fill = former), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xBF,\n                                 xP,\n                                 xV,\n                                 xC,\n                                 xS,\n                                 xB,\n                                 xD)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert sækir Sjálfstæðisflokkurinn kjósendur sína?\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\np <- d_recruitment |> \n    filter(current == \"Framsóknarflokkurinn\") |> \n    mutate(former = ifelse(former %in% c(\"Samfylkingin\",\n                                         \"Vinstri Græn\",\n                                         \"Sjálfstæðisflokkurinn\", \n                                         \"Píratar\",\n                                         \"Framsóknarflokkurinn\", \n                                         \"Píratar\",\n                                         \"Björt Framtíð\",\n                                         \"Viðreisn\",\n                                         \"Miðflokkurinn\"),\n                           former,\n                           \"Annað\")) |> \n    mutate(former = as_factor(former),\n           former = fct_reorder(former, p * (former != \"Annað\"), .fun = max),\n           election = as.numeric(as.factor(year)),\n           text = str_c(\"Kaus síðast: \", former, \"\\n\",\n                        \"Kaus nú: \", current, \"\\n\",\n                        \"Hlutfall (af kjósendum núna): \", percent(p, accuracy = 0.1))) |>\n    ggplot(aes(election, p, text = text)) +\n    geom_col(aes(fill = former), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xP,\n                                 xBF,\n                                 xC,\n                                 xV,\n                                 xS,\n                                 xD,\n                                 xB)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert sækir Framsóknarflokurinn kjósendur sína?\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\np <- d_recruitment |> \n    filter(current == \"Vinstri Græn\") |> \n    mutate(former = ifelse(former %in% c(\"Samfylkingin\",\n                                         \"Vinstri Græn\",\n                                         \"Sjálfstæðisflokkurinn\", \n                                         \"Píratar\",\n                                         \"Framsóknarflokkurinn\", \n                                         \"Píratar\",\n                                         \"Björt Framtíð\",\n                                         \"Viðreisn\",\n                                         \"Miðflokkurinn\"),\n                           former,\n                           \"Annað\")) |> \n    mutate(former = as_factor(former),\n           former = fct_reorder(former, p * (former != \"Annað\"), .fun = max),\n           election = as.numeric(as.factor(year)),\n           text = str_c(\"Kaus síðast: \", former, \"\\n\",\n                        \"Kaus nú: \", current, \"\\n\",\n                        \"Hlutfall (af kjósendum núna): \", percent(p, accuracy = 0.1))) |>\n    ggplot(aes(election, p, text = text)) +\n    geom_col(aes(fill = former), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xC,\n                                 xBF,\n                                 xD,\n                                 xP,\n                                 xB,\n                                 xS,\n                                 xV)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvaðan sækja Vinstri Græn kjósendur sína?\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\np <- d_recruitment |> \n    filter(current == \"Viðreisn\") |> \n    mutate(former = ifelse(former %in% c(\"Samfylkingin\",\n                                         \"Vinstri Græn\",\n                                         \"Sjálfstæðisflokkurinn\", \n                                         \"Píratar\",\n                                         \"Framsóknarflokkurinn\", \n                                         \"Píratar\",\n                                         \"Björt Framtíð\",\n                                         \"Viðreisn\",\n                                         \"Miðflokkurinn\"),\n                           former,\n                           \"Annað\")) |> \n    mutate(former = as_factor(former),\n           former = fct_reorder(former, p * (former != \"Annað\"), .fun = max),\n           election = as.numeric(as.factor(year)),\n           text = str_c(\"Kaus síðast: \", former, \"\\n\",\n                        \"Kaus nú: \", current, \"\\n\",\n                        \"Hlutfall (af kjósendum núna): \", percent(p, accuracy = 0.1))) |>\n    ggplot(aes(election, p, text = text)) +\n    geom_col(aes(fill = former), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:2, labels = c(2016, 2017)) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xP,\n                                 xV,\n                                 xBF,\n                                 xB,\n                                 xS,\n                                 xD,\n                                 xC)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert sækir Viðreisn kjósendur sína?\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\np <- d_recruitment |> \n    filter(current == \"Píratar\") |> \n    mutate(former = ifelse(former %in% c(\"Samfylkingin\",\n                                         \"Vinstri Græn\",\n                                         \"Sjálfstæðisflokkurinn\", \n                                         \"Píratar\",\n                                         \"Framsóknarflokkurinn\", \n                                         \"Píratar\",\n                                         \"Björt Framtíð\",\n                                         \"Viðreisn\",\n                                         \"Miðflokkurinn\"),\n                           former,\n                           \"Annað\")) |> \n    mutate(former = as_factor(former),\n           former = fct_reorder(former, p * (former != \"Annað\"), .fun = max),\n           election = as.numeric(as.factor(year)),\n           text = str_c(\"Kaus síðast: \", former, \"\\n\",\n                        \"Kaus nú: \", current, \"\\n\",\n                        \"Hlutfall (af kjósendum núna): \", percent(p, accuracy = 0.1))) |>\n    ggplot(aes(election, p, text = text)) +\n    geom_col(aes(fill = former), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:3, labels = c(2013, 2016, 2017)) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xC,\n                                 xB,\n                                 xD,\n                                 xBF,\n                                 xS,\n                                 xV,\n                                 xP)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvaðan sækja Píratar kjósendur sína?\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\np <- d_recruitment |> \n    filter(current == \"Miðflokkurinn\") |> \n    mutate(former = ifelse(former %in% c(\"Samfylkingin\",\n                                         \"Vinstri Græn\",\n                                         \"Sjálfstæðisflokkurinn\", \n                                         \"Píratar\",\n                                         \"Framsóknarflokkurinn\", \n                                         \"Píratar\",\n                                         \"Björt Framtíð\",\n                                         \"Viðreisn\",\n                                         \"Miðflokkurinn\"),\n                           former,\n                           \"Annað\")) |> \n    mutate(former = as_factor(former),\n           former = fct_reorder(former, p * (former != \"Annað\"), .fun = max),\n           election = as.numeric(as.factor(year)),\n           text = str_c(\"Kaus síðast: \", former, \"\\n\",\n                        \"Kaus nú: \", current, \"\\n\",\n                        \"Hlutfall (af kjósendum núna): \", percent(p, accuracy = 0.1))) |>\n    ggplot(aes(election, p, text = text)) +\n    geom_col(aes(fill = former), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:1, labels = c(2017)) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xV,\n                                 xS,\n                                 xC,\n                                 xP,\n                                 xD,\n                                 xB,\n                                 xM)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert sækir Miðflokkurinn kjósendur sína?\")\n\nggplotly(p, tooltip = \"text\")"
  },
  {
    "objectID": "posts/orkumal/index.html",
    "href": "posts/orkumal/index.html",
    "title": "Orkumál",
    "section": "",
    "text": "Code\nd <- read_csv(\"https://raw.githubusercontent.com/owid/energy-data/master/owid-energy-data.csv\",\n              col_types = cols()) |> \n    select(country, year, \n           contains(\"gdp\"), contains(\"pop\"), \n           fossil_share_energy, fossil_share_elec, fossil_energy_per_capita,\n           fossil_fuel_consumption,\n           renewables_share_elec, renewables_share_energy, \n           energy_per_capita, per_capita_electricity,\n           oil_prod_per_capita,\n           greenhouse_gas_emissions,\n           carbon_intensity_elec,\n           low_carbon_energy_per_capita) |> \n    mutate(gdp_per_capita = gdp / population,\n           greenhouse_per_capita = greenhouse_gas_emissions / population * 1e6 * 1e5,\n           gdp_per_greenhouse = gdp / greenhouse_gas_emissions,\n           high_carbon_energy_per_capita = energy_per_capita - low_carbon_energy_per_capita,\n           fossil_fuel_consumption = fossil_fuel_consumption * 1e9)"
  },
  {
    "objectID": "posts/orkumal/index.html#section",
    "href": "posts/orkumal/index.html#section",
    "title": "Orkumál",
    "section": "2018",
    "text": "2018\n\n\nCode\np <- d |> \n    filter(year == 2018) |> \n    select(country, fossil_fuel_consumption, gdp) |> \n    drop_na() |> \n    mutate(fossil_per_gdp = fossil_fuel_consumption / gdp,\n           country = fct_reorder(country, fossil_per_gdp)) |> \n    ggplot(aes(fossil_per_gdp, country,\n               fill = country == \"Iceland\")) +\n    geom_col() +\n    scale_fill_manual(values = c(\"#969696\", \"#4292c6\")) +\n    theme_half_open() +\n    theme(legend.position = \"none\") +\n    coord_cartesian(expand = FALSE) +\n    labs(x = \"Notkun jarðefnaeldsneytis (kWh) deilt með landsframleiðslu ($)\",\n         y = NULL,\n         title = \"Röðun landa eftir jarðefnaeldsneyti (kWh) per $ af landsframleiðslu árið 2018\",\n         subtitle = \"Árið 2018 kostaði1$ af landsframleiðslu 0.94 kWh af jarðefnaeldsneyti\",\n         caption = \"Kóði og gögn: https://github.com/bgautijonsson/orkumal\")\n\nggsave(plot = p, filename = \"ordered_fossil.png\",\n       width = 8, height = 8, scale = 1.7, bg = \"white\")\n\np"
  },
  {
    "objectID": "posts/orkumal/index.html#þróun",
    "href": "posts/orkumal/index.html#þróun",
    "title": "Orkumál",
    "section": "Þróun",
    "text": "Þróun\n\n\nCode\ncountries <- c(\"Denmark\", \"Finland\",\n               \"Germany\", \"Iceland\", \"India\", \"New Zealand\", \"Norway\", \"Sweden\")\nicelandic <- c(\n    \"Denmark\" = \"Danmörk\",\n    \"Finland\" = \"Finnland\",\n    \"Germany\" = \"Þýskaland\", \n    \"Iceland\" = \"Ísland\", \n    \"India\" = \"Indland\", \n    \"New Zealand\" = \"Nýja Sjáland\",\n    \"Norway\" = \"Noregur\",\n    \"Sweden\" = \"Svíþjóð\")\n\n\nplot_dat <- d |> \n    select(year, country, fossil_fuel_consumption, gdp) |> \n    drop_na() |> \n    mutate(fossil_per_gdp = fossil_fuel_consumption / gdp) |> \n    filter(year >= 1980) |> \n    mutate(alpha = country %in% countries,\n           colour = fct_other(country,\n                              keep = countries,\n                              other_level = \"Other\"),\n           y = fossil_per_gdp,\n           y = case_when(country == \"Iceland\" ~ y + 0,\n                         country == \"New Zealand\" ~ y - 0.05,\n                         country == \"India\" ~ y + 0.05,\n                         country == \"Finland\" ~ y - 0.02,\n                         country == \"Sweden\" ~ y + 0.02,\n                         country == \"Norway\" ~ y - 0.02,\n                         TRUE ~ y))\n\np <- plot_dat |> \n    ggplot(aes(year, fossil_per_gdp,\n               colour = colour,\n               alpha = alpha)) +\n    geom_line(aes(group = country, size = alpha)) +\n    geom_text(data = plot_dat |> \n                  filter(country %in% countries,\n                         year == max(year)) |> \n                  mutate(country = icelandic[country]),\n              aes(y = y, label = country),\n              hjust = 0, nudge_x = 0.1, size = 4) +\n    geom_rangeframe(colour = \"black\", alpha = 1) +\n    scale_x_continuous(expand = expansion(),\n                       limits = c(1980, 2018.5),\n                       breaks = c(1980, 1985, 1990, 1995, 2000, 2005, 2010, 2015, 2018)) +\n    scale_y_continuous() +\n    scale_colour_manual(values = c(\"#a50f15\",\n                                   \"#a6bddb\",\n                                   \"#ff7f00\", \n                                   \"#045a8d\",\n                                   \"#4daf4a\",\n                                   \"black\", \n                                   \"#e41a1c\", \n                                   \"#fed976\",\n                                   \"grey\")) +\n    scale_alpha_manual(values = c(0.3, 1)) +\n    scale_size_manual(values = c(0.5, 1)) +\n    theme_tufte() +\n    theme(legend.position = \"none\",\n          plot.title = element_text(face = \"bold\")) +\n    coord_cartesian(ylim = c(0, 2),\n                    xlim = c(1980, 2021.9),\n                    expand = F) +\n    labs(x = NULL,\n         y = \"Notkun jarðefnaeldsneytis (kWh) deilt með landsframleiðslu ($)\",\n         title = \"Þróun jarðefnaeldsneytis (kWh) per $ af landsframleiðslu árin 1980 - 2018\",\n         caption = \"Kóði og gögn: https://github.com/bgautijonsson/orkumal\")\n\nggsave(plot = p, filename = \"throun_fossil.png\",\n       width = 8, height = 0.621 * 8, scale = 1.5, bg = \"white\")\n\np"
  },
  {
    "objectID": "posts/orkumal/index.html#breyting-2010---2018",
    "href": "posts/orkumal/index.html#breyting-2010---2018",
    "title": "Orkumál",
    "section": "Breyting 2010 - 2018",
    "text": "Breyting 2010 - 2018\n\n\nCode\np <- d |> \n    filter(year %in% c(2010, 2018)) |> \n    select(year, country, fossil_fuel_consumption, gdp) |> \n    drop_na() |> \n    mutate(fossil_per_gdp = fossil_fuel_consumption / gdp,\n           country = fct_reorder(country, fossil_per_gdp),\n           year = ifelse(year == max(year), \"eftir\", \"fyrir\")) |> \n    select(year, country, fossil_per_gdp) |> \n    pivot_wider(names_from = year, values_from = fossil_per_gdp) |> \n    mutate(breyting = eftir / fyrir - 1) |> \n    mutate(country = fct_reorder(country, breyting)) |> \n    ggplot(aes(breyting, country,\n               fill = country == \"Iceland\")) +\n    geom_col() +\n    scale_x_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(\"#969696\", \"#4292c6\")) +\n    theme_half_open() +\n    theme(legend.position = \"none\") +\n    coord_cartesian(expand = FALSE) +\n    labs(x = \"Notkun jarðefnaeldsneytis (kWh) deilt með landsframleiðslu ($) (% breyting frá 2010 til 2018)\",\n         y = NULL,\n         title = \"Breyting í notkun jarðefnaeldsneytis (kWh) per $ af landsframleiðslu frá 2010 til 2018\",\n         subtitle = \"Árið 2018 kostaði dollari af landsframleiðslu á Íslandi 14% meira jarðefnaeldsneyti en 2010\",\n         caption = \"Kóði og gögn: https://github.com/bgautijonsson/orkumal\")\n\np"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Færslur",
    "section": "",
    "text": "Hver er útblástur Íslands og hvernig er hann borið saman við önnur lönd?\n\n\n\n\norkumál\n\n\nR\n\n\níslenska\n\n\n\n\nTil að vernda jörðina viljum við draga úr notkun jarðefnaeldsneytis, en einnig vilja þjóðir heims vaxa efnahagslega. Hér skoða ég hvað þjóðir nota margar kílówattstundir (kWh) af jarðefnaeldsneyti og eldsneyti alls per $ af landsframleiðslu. Ég skoða líka útblástur gróðurhúsaloftteguna við framleiðslu rafmagns og tengingu við landsframleiðslu.\n\n\n\n\n\n\nJun 28, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\n\nCreating forest plots with coefficient tables in ggplot2 with cowplot\n\n\n\n\nenglish\n\n\nR\n\n\nplots\n\n\ntutorial\n\n\n\n\nI’ve seen this kind of figure poking around, but I didn’t really think about them until the other day I was asked about how to make one in R. Here I will walk through making one of these plots using the ggplot2 and cowplot packages.\n\n\n\n\n\n\nJun 28, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\n\nHvert missa flokkar kjósendur sína og hvaðan sækja þeir nýja?\n\n\n\n\nR\n\n\nkosningar\n\n\níslenska\n\n\n\n\nÍslenska Kosningarannsóknin er framkvæmd af Félagsvísindastofnun Háskóla Íslands, og mér finnst vinnan sem fer fram þar hreint út sagt frábær og upplýsingar um gögnin vel skipulagðar, enda eina sviðið sem ég veit að sé með eigin RStudio server innanhúss!\n\n\n\n\n\n\nJun 26, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\n\nDæmi um notkun Quarto og RStudio til að útbúa gagnvirkar HTML skýrslur\n\n\n\n\nefnahagur\n\n\nR\n\n\níslenska\n\n\n\n\n\n\n\n\n\n\n\nJun 23, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "Brynjólfur Gauti Guðrúnar Jónsson",
    "section": "",
    "text": "Auk þessa kenni ég Tölfræðiráðgjöf og vinn hjá Hjartavernd."
  },
  {
    "objectID": "posts/forest-plot-table/index.html",
    "href": "posts/forest-plot-table/index.html",
    "title": "Forest Plots with Built-In Tables",
    "section": "",
    "text": "I’ve seen this kind of figure poking around, but I didn’t really think about them until the other day I was asked about how to make one in R. Here I will walk through making one of these plots using the ggplot2 and cowplot packages.\nTo start with I have some fake data, d.\n\n\nCode\nd |> \n    kable(format = \"html\") |> \n    kable_styling(full_width = F)\n\n\n\n\n \n  \n    name \n    mean \n    lower \n    upper \n  \n \n\n  \n    Covfefe \n    1.1989430 \n    1.0707825 \n    1.358700 \n  \n  \n    Coffee \n    1.8509518 \n    1.5589701 \n    2.227752 \n  \n  \n    Variable \n    1.2181512 \n    1.0834045 \n    1.411683 \n  \n  \n    Covariate \n    1.1970336 \n    1.0699671 \n    1.342737 \n  \n  \n    Predictor \n    0.9085823 \n    0.8049225 \n    1.000000 \n  \n  \n    Smoking \n    0.8770238 \n    0.7447709 \n    1.000000 \n  \n  \n    Age \n    0.9344551 \n    0.8305984 \n    1.000000 \n  \n  \n    Uranium \n    0.9177338 \n    0.8021060 \n    1.000000 \n  \n  \n    Stuff \n    1.0760010 \n    1.0000000 \n    1.216474 \n  \n  \n    Thing \n    0.9143605 \n    0.7753231 \n    1.000000 \n  \n  \n    Koffing \n    1.0686924 \n    1.0000000 \n    1.178642 \n  \n  \n    Coughing \n    1.0648236 \n    1.0000000 \n    1.194998 \n  \n  \n    Polvo \n    0.9227277 \n    0.8097846 \n    1.000000 \n  \n\n\n\n\n\n\nThe Forest Plot\nThe forest plot itself is not hard to do. Notice how I create this striped pattern with geom_vline(aes(xintercept = name), col = \"grey95\", size = 5). I’ll do the same thing to the table part of the figure later.\n\n\nCode\np1 <- d |> \n    mutate(name = fct_reorder(name, mean)) |> \n    ggplot(aes(x = name, y = mean,\n                  ymin = lower, ymax = upper)) +\n    geom_vline(aes(xintercept = name), col = \"grey95\", size = 5) +\n    geom_hline(yintercept = 1, lty = 2) +\n    geom_point() +\n    geom_linerange() +\n    coord_flip() +\n    labs(x = NULL, y = NULL) +\n    theme(plot.margin = margin(t = 5, r = -4, b = 5, l = 5))\n\np1\n\n\n\n\n\n\n\nThe Table\nTo make the table look nice I convert the numbers to text and clean them up so that the text is justified nicely when plotting it. I did some manual tuning of the margins to make the plot and table line up nicely.\n\n\nCode\np2 <- d |> \n    mutate(name = fct_reorder(name, mean),\n           mean = round(mean, 2),\n           mean = str_pad(mean, width = 4, side = \"right\", pad = \"0\"),\n           lower = round(lower, 2),\n           lower = as.character(lower),\n           lower = ifelse(lower == \"1\", \"1.00\", lower),\n           lower = str_pad(lower, width = 4, side = \"right\", pad = \"0\"),\n           upper = round(upper, 2),\n           upper = as.character(upper),\n           upper = ifelse(upper == \"1\", \"1.00\", upper),\n           upper = str_pad(upper, width = 4, side = \"right\", pad = \"0\"),\n           ci = str_c(lower, \", \", upper)) |> \n    ggplot(aes(x = name)) +\n    geom_vline(aes(xintercept = name), col = \"grey95\", size = 5) +\n    geom_text(aes(label = mean, y = 1)) +\n    geom_text(aes(label = ci, y = 1.07)) +\n    coord_flip(ylim = c(0.99, 1.1)) +\n    theme(axis.title = element_blank(),\n          axis.text = element_blank(),\n          axis.ticks = element_blank(),\n          axis.line.y = element_blank(),\n          panel.border = element_blank(), \n          panel.grid = element_blank(), \n          plot.background = element_blank(),\n          plot.margin = margin(t = 5, r = 5, b = 19.3, l = 0))\n\np2\n\n\n\n\n\n\nThe finished bottom row\nNow we have alligned the plot and table. If you zoom in you might see that they don’t line up perfectly. I am not liable for any bodily harm caused by this.\n\n\nCode\nbottom_row <- plot_grid(p1, p2, nrow = 1, rel_widths = c(1, 0.3)) \n\nbottom_row\n\n\n\n\n\n\n\n\nThe headers\nI admit that this is a pretty handwavy manual way to make the header fit, and there is probably a nice way to automatically fit this using the coordinate system.\n\n\nCode\ntop_row <- ggplot(data = tibble()) +\n    geom_text(aes(y = 1, x = 0.02, label = \"Variable\"), size = 5) +\n    geom_text(aes(y = 1, x = 0.84, label = \"Mean\"), size = 5) +\n    geom_text(aes(y = 1, x = 0.98, label = \"95% CI\"), size = 5) +\n    coord_cartesian(xlim = c(0, 1)) +\n    theme_void() +\n    theme(plot.margin = margin(t = 0, r = 5, b = 0, l = 5),\n          axis.line.x.bottom = element_line())\n\n\ntop_row\n\n\n\n\n\n\n\nPutting it all together\nAnd so we come to the finished plot. If we wrangle the rel_heights setting a little bit we can get a pretty nice looking forest plot and table hybrid.\n\n\nCode\nplot_grid(top_row, bottom_row, ncol = 1, rel_heights = c(0.07, 1))\n\n\n\n\n\nThis was actually less of an inconvenience than I thought. The mixture of ggplot2 and cowplot made this a pretty easy task."
  }
]