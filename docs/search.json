[
  {
    "objectID": "posts/lausstorf/index.html",
    "href": "posts/lausstorf/index.html",
    "title": "Laus störf",
    "section": "",
    "text": "Code\nd <- pxweb_get_data(\"https://px.hagstofa.is:443/pxis/api/v1/is/Samfelag/vinnumarkadur/lausstorf/JVS00001.px\", \n                    query = list(\n                        \"Ársfjórðungur\" = c(\"*\"),\n                        \"Atvinnugrein\" = c(\"*\"),\n                        \"Eining\" = c(\"*\")\n                    )) |> \n    as_tibble() |> \n    janitor::clean_names() |> \n    rename(value = 4) |> \n    mutate(af = arsfjordungur) |> \n    separate(arsfjordungur, into = c(\"ar\", \"man\"), sep = \"Á\", convert = T) |> \n    mutate(man = 1 + (man - 1) * 3,\n           dags = str_c(ar, \"-\", str_pad(man, width = 2, side = \"left\", pad = \"0\"), \"-01\") |> ymd()) |> \n    select(dags, af, atvinnugrein, eining, value) |> \n    # filter(str_detect(eining, \"Hlutfa|Fjöldi starfa\")) |> \n    mutate(eining = case_when(str_detect(eining, \"Hlutfa\") ~ \"hlutf_laus\",\n                              eining == \"Fjöldi starfa\" ~ \"fjoldi\",\n                              TRUE ~ \"fjoldi_laus\")) |> \n    select(dags, af, atvinnugrein, eining, value) |> \n    pivot_wider(names_from = eining, values_from = value) |> \n    mutate(hlutf_laus = hlutf_laus / 100)\n\nfacet_strip_bigger <- function(gp, size){\n    if(missing(gp)){\n        print(\"this function needs a facet_wrap ggplotly object\")\n    }\n    if(missing(size)){\n        print(\"this function needs 'size' argument to be specified as integer. 80 will be introduced as default\")\n        size <- 80\n    }\n    \n    n_facets <- c(1:length(gp[[\"x\"]][[\"layout\"]][[\"shapes\"]]))\n    \n    for(i in n_facets){\n        if(n_facets[i] %% 2 == 0){\n            gp[[\"x\"]][[\"layout\"]][[\"shapes\"]][[i]][[\"y0\"]] <- + as.numeric(size)\n            gp[[\"x\"]][[\"layout\"]][[\"shapes\"]][[i]][[\"y1\"]] <- 0\n        }\n    }\n    \n    return(gp)\n}\n\ntheme_set(\n    theme_half_open(font_size = 12) +\n        theme(panel.spacing.y = unit(0.1, \"cm\"),\n              plot.margin = margin(t = 5, r = 5, b = 15, l = 5))\n)\n\n\n\nLaus störf eftir atvinnugreinum\n\nHlutfall lausra starfaFjöldi starfaFjöldi lausra starfa\n\n\n\n\nCode\nplot_dat <- d |> \n    filter(atvinnugrein != \"Alls\") |> \n    mutate(atvinnugrein = str_wrap(atvinnugrein, width = 100),\n           text = str_c(\"<b>\", atvinnugrein, \"</b>\", \"\\n\",\n                        \"Dags: \", af, \"\\n\" ,\n                        \"<b>Hlutfall laus: \", percent(hlutf_laus, accuracy = 0.1, decimal.mark = \",\", big.mark = \".\"), \"</b>\", \"\\n\",\n                        \"Fjöldi starfa: \", number(fjoldi, big.mark = \".\", decimal.mark = \",\", accuracy = 1), \"\\n\",\n                        \"Fjöldi lausra starfa: \", number(fjoldi_laus, big.mark = \".\", decimal.mark = \",\", accuracy = 1)))\n\np <- plot_dat |> \n    ggplot(aes(dags, hlutf_laus, text = text)) +\n    geom_line(data = plot_dat |> rename(atv = atvinnugrein),\n              aes(group = atv), alpha = 0.1) +\n    geom_line(aes(group = atvinnugrein)) +\n    scale_y_continuous(labels = label_percent()) +\n    facet_wrap(\"atvinnugrein\", ncol = 1, scales = \"free_x\") +\n    labs(x = NULL, y = NULL)\n\nggplotly(\n    p,\n    tooltip = \"text\") |> \n    layout(hoverlabel = list(align = \"left\"))\n\n\n\n\n\n\n\n\n\nAtvinnugreinÍ samhengi\n\n\n\n\nCode\nplot_dat <- d |> \n    filter(atvinnugrein != \"Alls\") |> \n    mutate(atvinnugrein = str_wrap(atvinnugrein, width = 100),\n           text = str_c(\"<b>\", atvinnugrein, \"</b>\", \"\\n\",\n                        \"Dags: \", af, \"\\n\" ,\n                        \"Hlutfall laus: \", percent(hlutf_laus, accuracy = 0.1, decimal.mark = \",\", big.mark = \".\"), \"\\n\",\n                        \"<b>Fjöldi starfa: \", number(fjoldi, big.mark = \".\", decimal.mark = \",\", accuracy = 1), \"</b>\", \"\\n\",\n                        \"Fjöldi lausra starfa: \", number(fjoldi_laus, big.mark = \".\", decimal.mark = \",\", accuracy = 1)))\n\np <- plot_dat |> \n    ggplot(aes(dags, fjoldi, text = text)) +\n    # geom_line(data = plot_dat |> rename(atv = atvinnugrein),\n    #           aes(group = atv), alpha = 0.1) +\n    geom_line(aes(group = atvinnugrein)) +\n    scale_y_log10(labels = label_number(big.mark = \".\", decimal.mark = \",\", accuracy = 1)) +\n    facet_wrap(\"atvinnugrein\", ncol = 1, scales = \"free\") +\n    labs(x = NULL, y = NULL)\n\nggplotly(\n    p,\n    tooltip = \"text\") |> \n    layout(hoverlabel = list(align = \"left\"))\n\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <- d |> \n    filter(atvinnugrein != \"Alls\") |> \n    mutate(atvinnugrein = str_wrap(atvinnugrein, width = 100),\n           text = str_c(\"<b>\", atvinnugrein, \"</b>\", \"\\n\",\n                        \"Dags: \", af, \"\\n\" ,\n                        \"Hlutfall laus: \", percent(hlutf_laus, accuracy = 0.1, decimal.mark = \",\", big.mark = \".\"), \"\\n\",\n                        \"<b>Fjöldi starfa: \", number(fjoldi, big.mark = \".\", decimal.mark = \",\", accuracy = 1), \"</b>\", \"\\n\",\n                        \"Fjöldi lausra starfa: \", number(fjoldi_laus, big.mark = \".\", decimal.mark = \",\", accuracy = 1)))\n\np <- plot_dat |> \n    ggplot(aes(dags, fjoldi, text = text)) +\n    geom_line(data = plot_dat |> rename(atv = atvinnugrein),\n              aes(group = atv), alpha = 0.1) +\n    geom_line(aes(group = atvinnugrein)) +\n    scale_y_log10(labels = label_number(big.mark = \".\", decimal.mark = \",\", accuracy = 1)) +\n    facet_wrap(\"atvinnugrein\", ncol = 1, scales = \"free_x\") +\n    labs(x = NULL, y = NULL)\n\nggplotly(\n    p,\n    tooltip = \"text\") |> \n    layout(hoverlabel = list(align = \"left\"))\n\n\n\n\n\n\n\n\n\n\n\n\nAtvinnugreinSamhengi\n\n\n\n\nCode\nplot_dat <- d |> \n    filter(atvinnugrein != \"Alls\") |> \n    mutate(atvinnugrein = str_wrap(atvinnugrein, width = 100),\n           text = str_c(\"<b>\", atvinnugrein, \"</b>\", \"\\n\",\n                        \"Dags: \", af, \"\\n\" ,\n                        \"Hlutfall laus: \", percent(hlutf_laus, accuracy = 0.1, decimal.mark = \",\", big.mark = \".\"), \"\\n\",\n                        \"Fjöldi starfa: \", number(fjoldi, big.mark = \".\", decimal.mark = \",\", accuracy = 1), \"\\n\",\n                        \"<b>Fjöldi lausra starfa: \", number(fjoldi_laus, big.mark = \".\", decimal.mark = \",\", accuracy = 1), \"</b>\"))\n\np <- plot_dat |> \n    ggplot(aes(dags, fjoldi_laus, text = text)) +\n    # geom_line(data = plot_dat |> rename(atv = atvinnugrein),\n    #           aes(group = atv), alpha = 0.1) +\n    geom_line(aes(group = atvinnugrein)) +\n    scale_y_continuous(labels = label_number(big.mark = \".\", decimal.mark = \",\", accuracy = 1)) +\n    facet_wrap(\"atvinnugrein\", ncol = 1, scales = \"free\") +\n    labs(x = NULL, y = NULL)\n\nggplotly(\n    p,\n    tooltip = \"text\") |> \n    layout(hoverlabel = list(align = \"left\"))\n\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <- d |> \n    filter(atvinnugrein != \"Alls\") |> \n    mutate(atvinnugrein = str_wrap(atvinnugrein, width = 100),\n           text = str_c(\"<b>\", atvinnugrein, \"</b>\", \"\\n\",\n                        \"Dags: \", af, \"\\n\" ,\n                        \"Hlutfall laus: \", percent(hlutf_laus, accuracy = 0.1, decimal.mark = \",\", big.mark = \".\"), \"\\n\",\n                        \"Fjöldi starfa: \", number(fjoldi, big.mark = \".\", decimal.mark = \",\", accuracy = 1), \"\\n\",\n                        \"<b>Fjöldi lausra starfa: \", number(fjoldi_laus, big.mark = \".\", decimal.mark = \",\", accuracy = 1), \"</b>\"))\n\np <- plot_dat |> \n    ggplot(aes(dags, fjoldi_laus, text = text)) +\n    geom_line(data = plot_dat |> rename(atv = atvinnugrein),\n              aes(group = atv), alpha = 0.1) +\n    geom_line(aes(group = atvinnugrein)) +\n    scale_y_continuous(labels = label_number(big.mark = \".\", decimal.mark = \",\", accuracy = 1)) +\n    facet_wrap(\"atvinnugrein\", ncol = 1, scales = \"free\") +\n    labs(x = NULL, y = NULL)\n\nggplotly(\n    p,\n    tooltip = \"text\") |> \n    layout(hoverlabel = list(align = \"left\"))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nKóði fyrir þumalmynd færslunnar\nÍ hverri færslu get valið mynd sem birtist í smærri útgáfu. Mér datt í hug að hafa kóðann fyrir þá mynd í lokin á færslunni fyrir áhugasama. Þar sem plotly býður ekki upp á jafn góða hönnunarstaðla og ggplot2 eru þessar myndir oft aðeins fallegri en gagnvirku plotly myndirnar.\n\n\nCode\nplot_dat <- d |> \n    filter(atvinnugrein != \"Alls\") |> \n    mutate(atvinnugrein = str_wrap(atvinnugrein, width = 60))\n\np <- plot_dat |> \n    ggplot(aes(dags, hlutf_laus)) +\n    geom_line(data = plot_dat |> rename(atv = atvinnugrein),\n              aes(group = atv), alpha = 0.1) +\n    geom_line(aes(group = atvinnugrein)) +\n    geom_rangeframe(sides = \"l\") +\n    geom_rangeframe(data = plot_dat |> filter(str_detect(atvinnugrein, \"R-S|M-N|O-Q\")), sides = \"b\") +\n    scale_y_continuous(labels = label_percent()) +\n    facet_wrap(\"atvinnugrein\", ncol = 3) +\n    theme_tufte() +\n    theme(strip.background = element_rect(fill = \"grey90\"),\n          plot.title = element_text(face = \"bold\")) +\n    labs(x = NULL, y = NULL,\n         title = \"Hlutfall lausra starfa eftir atvinnugrein\")\n\nggsave(plot = p, filename = \"fig.png\",\n       width = 8, height = 1 * 8, scale = 1.3, bg = \"white\")\n\np"
  },
  {
    "objectID": "posts/lanategundir/index.html",
    "href": "posts/lanategundir/index.html",
    "title": "Dreifing húsnæðislánategunda hjá íslenskum heimilum",
    "section": "",
    "text": "Í nýjustu útgáfu af Fjármálastöðugleika birti Seðlabankinn tölur yfir hlutfall lánategunda hjá íslenskum heimilum. Ég hafði verið að spjalla við Ingva og Arnar hjá Pyngjunni um þessi gögn þ.a. ég útbjó snöggvast gagnvirka HTML skýrslu með Quarto í RStudio og sendi á kauðana.\nMyndirnar hér eru teiknaðar með blöndu af ggplot2 og plotly. Hreyfið músina yfir stöplana til að sjá merkingar (hlutföll, tegund lána eða tegund vaxta). Þið getið smellt á code flipana til að sjá undirliggjandi kóðann á bakvið skýrsluna. Kóðann í heild sinni má svo finna á githubinu mínu.\nSvo er lítið mál að uppfæra slíkar skýrslur sjálfkrafa ef slóðin að gögnum sem eru notuð og uppsetning þeirra helst óbreytt.\n\nAllar undirtegundirTegund vaxtaTegund lánsMánaðarleg breyting\n\n\n\n\nCode\np <- d |> \n    mutate(dags = as_date(dags),\n           value = value / 100,\n           text = str_c(\"Dagsetning: \", dags, \"\\n\",\n                        \"Tegund láns: \", tegund1, \"\\n\",\n                        \"Tegund vaxta: \", str_to_title(tegund2), \"\\n\",\n                        \"Hlutfall: \", percent(value))) |> \n    ggplot(aes(dags, value, text = text)) +\n    geom_col(aes(fill = paste(tegund1, \"og\", tegund2)), position = \"stack\") +\n    scale_x_date(date_labels = \"%m/%y\",\n                 expand = expansion()) +\n    scale_y_continuous(labels = label_percent(big.mark = \".\",\n                                              decimal.mark = \",\"),\n                       breaks = c(0, 0.2, 0.4, 0.6, 0.8, 1),\n                       expand = expansion()) +\n    scale_fill_brewer(type = \"qual\", palette = \"Set1\") +\n    theme_half_open() +\n    theme(legend.position = \"none\",\n          axis.text = element_text(size = 10)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Dreifing húsnæðislánategunda heimila\")\n\nggsave(plot = p + \n           theme(legend.position = \"top\", legend.text = element_text(size = 11)), \n       filename = \"dreifing.png\",\n       width = 8, height = 0.5 * 8, scale = 1.3, bg = \"white\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\np <- d |> \n    mutate(dags = as_date(dags),\n           value = value / 100) |> \n    group_by(dags, tegund2) |> \n    summarise(value = sum(value),\n              .groups = \"drop\") |> \n    mutate(text = str_c(\"Dagsetning: \", dags, \"\\n\",\n                        \"Tegund láns: \", \"Heild\", \"\\n\",\n                        \"Tegund vaxta: \", str_to_title(tegund2), \"\\n\",\n                        \"Hlutfall: \", percent(value))) |> \n    ggplot(aes(dags, value, text = text)) +\n    geom_col(aes(fill = paste(tegund2)), position = \"stack\") +\n    scale_x_date(date_labels = \"%m/%y\",\n                 expand = expansion()) +\n    scale_y_continuous(labels = label_percent(big.mark = \".\",\n                                              decimal.mark = \",\"),\n                       breaks = c(0, 1),\n                       expand = expansion()) +\n    scale_fill_brewer(type = \"qual\", palette = \"Set1\") +\n    theme_half_open() +\n    theme(legend.position = \"none\",\n          axis.text = element_text(size = 10)) +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Dreifing vaxtategunda heimila\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\np <- d |> \n    mutate(dags = as_date(dags)) |> \n    group_by(dags, tegund1) |> \n    summarise(value = sum(value/100),\n              .groups = \"drop\") |> \n    mutate(text = str_c(\"Dagsetning: \", dags, \"\\n\",\n                        \"Tegund láns: \", tegund1, \"\\n\",\n                        \"Tegund vaxta: \", \"Heild\", \"\\n\",\n                        \"Hlutfall: \", percent(value))) |> \n    ggplot(aes(dags, value, text = text)) +\n    geom_col(aes(fill = paste(tegund1)), position = \"stack\") +\n    scale_x_date(date_labels = \"%m/%y\",\n                 expand = expansion()) +\n    scale_y_continuous(labels = label_percent(big.mark = \".\",\n                                              decimal.mark = \",\"),\n                       breaks = c(0, 1),\n                       expand = expansion()) +\n    scale_fill_brewer(type = \"qual\", palette = \"Set1\") +\n    theme_half_open() +\n    theme(legend.position = \"none\",\n          axis.text = element_text(size = 10)) +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Dreifing lánategunda heimila\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <- d |> \n    bind_rows(\n        d |> \n            mutate(tegund1 = \"Heild\") |> \n            group_by(dags, tegund1, tegund2) |> \n            summarise(value = sum(value),\n                      .groups = \"drop\")\n    ) |> \n    bind_rows(\n        d |> \n            mutate(tegund2 = \"Heild\") |> \n            group_by(dags, tegund1, tegund2) |> \n            summarise(value = sum(value),\n                      .groups = \"drop\")\n    ) |> \n    mutate(name = str_c(tegund1, \" og \", tegund2),\n           dags = as_date(dags),\n           tegund2 = str_to_sentence(tegund2)) |> \n    group_by(name) |> \n    mutate(breyting = c(0, diff(value))/100) |> \n    ungroup() |> \n    mutate(text = str_c(\"Dagsetning: \", dags, \"\\n\",\n                        \"Tegund láns: \", tegund1, \"\\n\",\n                        \"Tegund vaxta: \", str_to_title(tegund2), \"\\n\",\n                        \"Breyting: \", percent(breyting, suffix = \"%-stig\")))\n\n\np <- plot_dat |> \n    ggplot(aes(dags, breyting, text = text)) +\n    geom_col(data = plot_dat |> \n                 rename(t1 = tegund1, t2 = tegund2, nm = name) |> \n                 filter(t1 != \"Heild\", t2 != \"Heild\"),\n             position = \"stack\", fill = \"grey80\", width = 28) +\n    geom_col(aes(fill = name), position = \"stack\", width = 28) +\n    geom_hline(yintercept = 0, lty = 2) +\n    scale_x_date(date_labels = \"%m/%y\") +\n    scale_y_continuous(labels = label_percent(suffix = \"%-stig\",\n                                              big.mark = \".\",\n                                              decimal.mark = \",\"),\n                       breaks = c(-0.04, -0.02, 0, 0.02, 0.04)) +\n    scale_fill_brewer(type = \"qual\", palette = \"Set1\") +\n    facet_grid(tegund2 ~ tegund1) +\n    theme_half_open() +\n    theme(legend.position = \"none\",\n          axis.text = element_text(size = 10)) +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Mánaðarleg breyting á húsnæðislánategundum heimila\")\n\nggsave(plot = p, filename = \"manbreyting.png\",\n       width = 8, height = 0.7 * 8, scale = 1.3, bg = \"white\")\n\nggplotly(p, tooltip = \"text\")"
  },
  {
    "objectID": "posts/visitala_neysluverds/index.html",
    "href": "posts/visitala_neysluverds/index.html",
    "title": "Vísitala neysluverðs",
    "section": "",
    "text": "Code\nd <- pxweb_get(\n    url =\"https://px.hagstofa.is:443/pxis/api/v1/is/Efnahagur/visitolur/1_vnv/2_undirvisitolur/VIS01301.px\", \n    query = list(\n        \"Mánuður\" = c(\"*\"),\n        \"Liður\"  = c(\"effect\", \"change_M\", \"breakdown\"),\n        \"Undirvísitala\" = c(\"*\")\n    ),\n    verbose = FALSE\n) |> \n    as.data.frame() |> \n    as_tibble() |> \n    janitor::clean_names() |> \n    separate(manudur, into = c(\"ar\", \"manudur\"), sep = \"M\", convert = T) |> \n    mutate(manudur = str_pad(manudur, width = 2, side = \"left\", pad = \"0\"),\n           date = str_c(ar, \"-\", manudur, \"-01\") |> ymd(),\n           visitala_neysluverds = visitala_neysluverds / 100) |> \n    select(date, undirvisitala, lidur, value = visitala_neysluverds) |> \n    filter(str_detect(undirvisitala, \"^[0-9]{2} |Vísitala neysluverðs\")) |>\n    arrange(date) |> \n    mutate(undirvisitala = str_replace(undirvisitala, \"^[0-9]{2} \", \"\"),\n           lidur = fct_recode(lidur,\n                              \"vaegi\" = \"Vægi, %\",\n                              \"breyting\" = \"Mánaðarbreyting, %\",\n                              \"ahrif\" = \"Áhrif á vísitölu, %\")) |> \n    pivot_wider(names_from = lidur, values_from = value)\n\n\n\nUndirvísitölur\nÍ grófum dráttum er vísitala neysluverðs vegið meðaltal af breytingu í verði hinna ýmsu afurða sem við kaupum. Því eru t.d. áhrif breytingar á húsnæðisverði reiknuð með því að margfalda verðbreytingar þess flokks við vægi hans í vísitölunni. Vægið á að endurspegla útgjöld einhvers konar meðal-Íslendings.\nFærið músina yfir myndirnar til að sjá nákvæm tölugildi og hvaða litir tilheyra hvaða flokkum.\n\nVísitalaVægiVerðbreyting\n\n\nDragið rennuna undir myndinni til að þysja inn á tiltekið tímabil.\n\n\nCode\nroll_fun <- function(x) {\n    x <- log(1 + x)\n    out <- x\n    \n    for (i in 1:11) out <- out + lag(x, n = i)\n    \n    exp(out) - 1\n}\n\n\nplot_dat <- d |> \n    arrange(date) |> \n    group_by(undirvisitala) |> \n    mutate(year_ahrif = roll_fun(ahrif),\n           year_breyting = roll_fun(breyting)) |> \n    ungroup() |> \n    filter(year(date) >= 2012) |> \n    mutate(undirvisitala = fct_reorder(undirvisitala, year_ahrif, .fun = sum),\n           text = str_c(\"<b>\", undirvisitala, \"</b>\\n\",\n                        \"Dagsetning: \", format(date, \"%B, %Y\"), \"\\n\",\n                        \"Hrein breyting (ár): \", percent(year_breyting, accuracy = 0.01), \"\\n\",\n                        \"Hrein breyting (mánuður): \", percent(breyting, accuracy = 0.01), \"\\n\",\n                        \"Vægi í vísitölu: \", percent(vaegi, accuracy = 0.01), \"\\n\",\n                        \"<b>Áhrif á vísitölu (ár): \", percent(year_ahrif, accuracy = 0.01), \"</b>\\n\",\n                        \"<b>Áhrif á vísitölu (mánuður): \", percent(ahrif, accuracy = 0.01), \"</b>\"))\n\n\n\np <- plot_dat |> \n    filter(undirvisitala != \"Vísitala neysluverðs\") |> \n    ggplot(aes(date, year_ahrif, text = text)) +\n    geom_hline(yintercept = 0, lty = 2) +\n    geom_col(aes(fill = undirvisitala, col = undirvisitala), position = \"stack\", width = 30) +\n    geom_line(data = plot_dat |> \n                  filter(undirvisitala == \"Vísitala neysluverðs\") |> \n                  mutate(text = str_c(\"<b>\", undirvisitala, \"</b>\\n\",\n                                      \"Dagsetning: \", format(date, \"%B, %Y\"), \"\\n\",\n                                      \"Hrein breyting (ár): \", percent(year_breyting, accuracy = 0.01), \"\\n\",\n                                      \"Hrein breyting (mánuður): \", percent(breyting, accuracy = 0.01), \"\\n\",\n                                      \"Vægi í vísitölu: \", percent(vaegi, accuracy = 0.01), \"\\n\",\n                                      \"<b>Áhrif á vísitölu (ár): \", percent(year_ahrif, accuracy = 0.01), \"</b>\\n\",\n                                      \"<b>Áhrif á vísitölu (mánuður): \", percent(ahrif, accuracy = 0.01), \"</b>\\n\")), \n              aes(group = \"none\")) +\n    scale_x_date(expand = expansion(),\n                 date_breaks = \"year\",\n                 date_labels = \"%Y\") +\n    scale_y_continuous(labels = label_percent(),\n                       breaks = c(-0.02, 0, 0.04, 0.06, 0.08, 0.1)) +\n    scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n    scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n    theme_half_open() +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Árleg breyting vísitölu og áhrif undirtalna (2012-2022)\")\n\nggsave(plot = p, filename = \"undirtolur.png\",\n       width = 8, height = 0.621 * 8, scale = 1, bg = \"white\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(hoverlabel = list(align = \"left\"),\n           xaxis = list(\n               rangeslider = list(type = \"date\")\n           )\n    )\n\n\n\n\n\n\n\n\nDragið rennuna undir myndinni til að þysja inn á tiltekið tímabil.\n\n\nCode\nroll_fun <- function(x) {\n    x <- log(1 + x)\n    out <- x\n    \n    for (i in 1:11) out <- out + lag(x, n = i)\n    \n    exp(out) - 1\n}\n\n\nplot_dat <- d |> \n    arrange(date) |> \n    group_by(undirvisitala) |> \n    mutate(year_ahrif = roll_fun(ahrif),\n           year_breyting = roll_fun(breyting)) |> \n    ungroup() |> \n    filter(year(date) >= 2012) |> \n    mutate(undirvisitala = fct_reorder(undirvisitala, year_ahrif, .fun = sum),\n           text = str_c(\"<b>\", undirvisitala, \"</b>\\n\",\n                        \"Dagsetning: \", format(date, \"%B, %Y\"), \"\\n\",\n                        \"Hrein breyting (ár): \", percent(year_breyting, accuracy = 0.01), \"\\n\",\n                        \"Hrein breyting (mánuður): \", percent(breyting, accuracy = 0.01), \"\\n\",\n                        \"<b>Vægi í vísitölu: \", percent(vaegi, accuracy = 0.01), \"</b>\\n\",\n                        \"Áhrif á vísitölu (ár): \", percent(year_ahrif, accuracy = 0.01), \"\\n\",\n                        \"Áhrif á vísitölu (mánuður): \", percent(ahrif, accuracy = 0.01)))\n\n\n\np <- plot_dat |> \n    filter(undirvisitala != \"Vísitala neysluverðs\") |> \n    ggplot(aes(date, vaegi, text = text)) +\n    geom_hline(yintercept = 0, lty = 2) +\n    geom_col(aes(fill = undirvisitala, col = undirvisitala), position = \"stack\", width = 30) +\n    scale_x_date(expand = expansion(),\n                 date_breaks = \"year\",\n                 date_labels = \"%Y\") +\n    scale_y_continuous(labels = label_percent(),\n                       breaks = pretty_breaks(8),\n                       expand = expansion()) +\n    scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n    scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n    theme_half_open() +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Vægi undirflokka í vísitölu neysluverðs (2012-2022)\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(hoverlabel = list(align = \"left\"),\n           xaxis = list(\n               rangeslider = list(type = \"date\")\n           ))\n\n\n\n\n\n\n\n\n\n\nCode\nroll_fun <- function(x) {\n    x <- log(1 + x)\n    out <- x\n    \n    for (i in 1:11) out <- out + lag(x, n = i)\n    \n    exp(out) - 1\n}\n\n\nplot_dat <- d |> \n    arrange(date) |> \n    group_by(undirvisitala) |> \n    mutate(year_ahrif = roll_fun(ahrif),\n           year_breyting = roll_fun(breyting)) |> \n    ungroup() |> \n    filter(year(date) >= 2012) |> \n    mutate(undirvisitala = fct_reorder(undirvisitala, year_ahrif, .fun = sum),\n           text = str_c(\"<b>\", undirvisitala, \"</b>\\n\",\n                        \"Dagsetning: \", format(date, \"%B, %Y\"), \"\\n\",\n                        \"<b>Hrein breyting (ár): \", percent(year_breyting, accuracy = 0.01), \"</b>\\n\",\n                        \"<b>Hrein breyting (mánuður): \", percent(breyting, accuracy = 0.01), \"</b>\\n\",\n                        \"Vægi í vísitölu: \", percent(vaegi, accuracy = 0.01), \"\\n\",\n                        \"Áhrif á vísitölu (ár): \", percent(year_ahrif, accuracy = 0.01), \"\\n\",\n                        \"Áhrif á vísitölu (mánuður): \", percent(ahrif, accuracy = 0.01)))\n\n\n\np <- plot_dat |> \n    filter(undirvisitala != \"Vísitala neysluverðs\") |> \n    ggplot(aes(date, year_breyting, text = text)) +\n    geom_hline(yintercept = 0, lty = 2) +\n    geom_col(aes(fill = undirvisitala, col = undirvisitala), width = 30) +\n    scale_x_date(expand = expansion(),\n                 date_breaks = \"2 year\",\n                 date_labels = \"%Y\") +\n    scale_y_continuous(labels = label_percent(),\n                       breaks = pretty_breaks(8)) +\n    scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n    scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n    facet_wrap(\"undirvisitala\", ncol = 3) +\n    theme_half_open() +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Árleg verðbreyting á undirflokkum vísitölu neysluverðs (2012-2022)\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(hoverlabel = list(align = \"left\"))\n\n\n\n\n\n\n\n\n\n\n\nÁrleg breyting og mánaðarleg breyting\nÞar sem árleg verðbólga samanstendur af verðbólgu síðustu 12 mánaða getur ekki hver og einn mánuður lækkað hana mikið. Ef mánaðarleg verðbólga síðustu 11 mánuði hefur verið 0,5% en hún mælist svo 0% verður árleg verðbólgan samt \\(1,005^{11} = 1,056 = 5,6\\%\\). Hins vegar getur verið gott að bera saman mánaðarlega verðbólgi við meðaltal síðastliðins árs. Ef mánaðarleg verðbólga er lægri en meðaltal síðasta árs er árleg verðbólga að lækka.\n\n\nCode\np <- plot_dat |> \n    mutate(text = str_c(\"<b>\", undirvisitala, \"</b>\\n\",\n                        \"Dagsetning: \", format(date, \"%B, %Y\"), \"\\n\",\n                        \"<b>Árleg (deilt með 12): \", percent(year_breyting/12, accuracy = 0.01), \"\\n</b>\",\n                        \"<b>Mánaðarleg: \", percent(breyting, accuracy = 0.01), \"</b>\")) |> \n    filter(undirvisitala == \"Vísitala neysluverðs\",\n           date >= ymd(\"2020-08-01\")) |> \n    ggplot(aes(year_ahrif/12, ahrif, text = text)) +\n    geom_abline(intercept = 0, slope = 1, lty = 2) +\n    geom_path(aes(group = \"none\")) +\n    scale_x_continuous(labels = label_percent()) +\n    scale_y_continuous(labels = label_percent()) +\n    coord_cartesian(ylim = c(0, 0.17)/12, xlim = c(0, 0.17)/12,\n                    expand = F) +\n    theme_half_open() +\n    labs(x = \"Árleg verðbólga (deilt með 12)\",\n         y = \"Mánaðarleg verðbólga\",\n         title = \"Árleg verðbólga á móti mánaðarlegri verðbólgu (ágúst 2020 - ágúst 2022)\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n)"
  },
  {
    "objectID": "posts/landspitali/index.html",
    "href": "posts/landspitali/index.html",
    "title": "Landspítalinn",
    "section": "",
    "text": "Gögnin eru fengin úr starfsemisupplýsingum Landspítala. Þar sem þetta er allt í PDF skjölum er ég ekki búinn að sækja öll gögnin, en ég birti hérna yfirlit yfir það helsta sem ég hef náð að safna saman. Það er kannski óþarfi að segja það, en það væri mikill kostur ef Landspítali myndi birta töflurnar úr þessum PDF skýrslum t.d. á csv formi, eða sem excel skrár. Seðlabankinn birtir t.d. excel skrár með viðeigandi gögnum samhliða PDF skýrslum sínum.\nEitt það besta sem yfirvöld geta gert til að auka traust á rekstri spítalans eða ákvarðanir í kringum hann er að auðvelda almenningi að nálgast upplýsingar um reksturinn. Það er ekki nóg að lesa/heyra í fjölmiðlum að einhver klár manneskja segir eitthvað um reksturinn, það verður að vera hægt að sannreyna þetta.\n\n\nCode\nd <- read_csv2(\"landspitali.csv\")\n\nvisitala <- pxweb_get(\n    url =\"https://px.hagstofa.is:443/pxis/api/v1/is/Efnahagur/visitolur/1_vnv/1_vnv/VIS01000.px\", \n    query = list(\n        \"Mánuður\" = c(\"*\"),\n        \"Vísitala\"  = c(\"CPI\"),\n        \"Liður\" = c(\"index\")\n    ),\n    verbose = FALSE\n) |> \n    as.data.frame() |> \n    as_tibble() |> \n    janitor::clean_names() |> \n    separate(manudur, into = c(\"ar\", \"manudur\"), sep = \"M\", convert = T) |> \n    mutate(manudur = str_pad(manudur, width = 2, side = \"left\", pad = \"0\"),\n           date = str_c(ar, \"-\", manudur, \"-01\") |> ymd()) |> \n    select(-manudur, -ar, -visitala, -lidur) |> \n    mutate(ar = year(date)) |> \n    group_by(ar) |> \n    filter(date == min(date)) |> \n    ungroup() |> \n    mutate(visitala_2022 = visitala_neysluverds / visitala_neysluverds[ar == 2022]) |> \n    select(-date, -visitala_neysluverds)\n\n\nurl_mannfjoldi <- \"https://px.hagstofa.is:443/pxis/api/v1/is/Ibuar/mannfjoldi/1_yfirlit/Yfirlit_mannfjolda/MAN00109.px\"\n\nquery_list_mannfjoldi <- list(\n    \"Ár\" = c(\"*\"),\n    \"Aldur\" = c(\"*\"),\n    \"Kyn\" = c(\"0\")\n)\n\n\nmannfjoldi <- pxweb_get(url_mannfjoldi, query = pxweb_query(query_list_mannfjoldi),\n                        verbose = FALSE) |> \n    as.data.frame() |> \n    as_tibble() |> \n    janitor::clean_names()  |> \n    filter(aldur == \"Alls\") |> \n    mutate(ar = parse_number(ar)) |> \n    group_by(ar) |> \n    summarise(mannfjoldi = sum(mannfjoldi_1841_2066))\n\nmannfjoldi <- pxweb_get(\n    url =\"https://px.hagstofa.is:443/pxis/api/v1/is/Ibuar/mannfjoldi/2_byggdir/sveitarfelog/MAN02005.px\", \n    query = list(\n        \"Sveitarfélag\" = c(\"*\"),\n        \"Aldur\" = c(\"-1\"),\n        \"Ár\" = c(\"*\"),\n        \"Kyn\" = c(\"0\")\n    ),\n    verbose = FALSE\n) |> \n    as.data.frame() |> \n    as_tibble() |> \n    janitor::clean_names() |> \n    rename(mannfjoldi = mannfjoldi_eftir_sveitarfelagi_kyni_og_aldri_1_januar_1998_2022) |> \n    mutate(ar = parse_number(ar)) |> \n    filter(sveitarfelag %in% c(\"Alls\", \"Reykjavíkurborg\", \"Garðabær\", \"Hafnarfjarðarkaupstaður\", \"Kópavogsbær\", \"Seltjarnarnesbær\", \"Mosfellsbær\")) |> \n    mutate(stadur = ifelse(sveitarfelag == \"Alls\", \"mannfjoldi_island\", \"mannfjoldi_hfbsv\")) |> \n    count(ar, stadur, wt = mannfjoldi) |> \n    pivot_wider(names_from = stadur, values_from = n)\n\nlands_laun <- read_csv(\"landspitali_laun.csv\") |> \n    rename(tegund_launa = tegund3,\n           samtals_laun = samtals)\n\nd <- d |> \n    inner_join(\n        visitala,\n        by = \"ar\"\n    ) |> \n    inner_join(\n        mannfjoldi,\n        by = \"ar\"\n    )"
  },
  {
    "objectID": "posts/landspitali/index.html#læknar-hjúkrunarfræðingar-og-sjúkraliðar",
    "href": "posts/landspitali/index.html#læknar-hjúkrunarfræðingar-og-sjúkraliðar",
    "title": "Landspítalinn",
    "section": "Læknar, Hjúkrunarfræðingar og Sjúkraliðar",
    "text": "Læknar, Hjúkrunarfræðingar og Sjúkraliðar\nÍ fréttum hefur verið talað um að of mikið starfsfólk sé ekki beintengt umönnun sjúklinga. Ein tilraun til að sannreyna þetta er að reikna hlutfall stöðugilda sem eru ekki hjúkrunarfræðingar, læknar eða sjúkraliðar. Þess ber þó að geta að meðlimir þessara stéttarfélaga geta líka sinnt stjórnenda/skrifstofustörfum að hluta til eða öllu leyti. Aðrar fagstéttir tengjast líka sjúklingum beint (t.d. sálfræðingar, lyfjafræðingar, meinafræðingar og sjúkraþjálfararar), en til einföldunar skoðum við hérna þessar þrjár stóru stéttir.\n\n\nCode\nplot_dat <- d |> \n    mutate(annad = stodugildi - stg_hjukr - stg_laekna - stg_sjukral,\n           hlutf_annad = annad / stodugildi) |> \n    select(ar, annad, hlutf_annad) |> \n    mutate(text = str_c(\"Ár: \", ar, \"\\n\",\n                        \"<b>Hlutfall: \", percent(hlutf_annad, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\"), \"</b>\\n\",\n                        \"Fjöldi: \", number(annad, suffix = \" stöðugildi\", big.mark = \".\", decimal.mark = \",\"), \"\\n\")) |> \n    drop_na()\n\np <- plot_dat |> \n    ggplot(aes(ar, hlutf_annad, text = text)) +\n    geom_line(aes(group = \"none\")) +\n    scale_x_continuous(expand = expansion(add = 0.6),\n                       breaks = 2006:2021) +\n    scale_y_continuous(expand = expansion(),\n                       labels = label_percent(),\n                       breaks = c(0.4, 0.45, 0.5, 0.55, 0.6),\n                       limits = c(0.4, 0.6)) +\n    scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n    scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n    theme_half_open() +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Hlutfall stöðugilda Landspítala sem eru ekki hjúkrunarfræðingar,\\n\\t\\t\\tlæknar eða sjúkraliðar (2010 - 2021)\",\n         subtitle = \"Reiknað út frá starfsemisupplýsingum Landspítala um stöðugildi eftir stéttarfélögum\")\n\nggsave(plot = p +\n           geom_rangeframe() +\n           theme_tufte() +\n           scale_y_continuous(expand = expansion(),\n                              labels = label_percent(),\n                              limits = c(0.4, 0.6),\n                              breaks = c(range(plot_dat$hlutf_annad), 0.5, 0.45, 0.55, 0.6)) +\n           theme(plot.title = element_text(face = \"bold\")) +\n           labs(title =  \"Hlutfall stöðugilda Landspítala sem eru ekki hjúkrunarfræðingar, læknar eða sjúkraliðar (2010 - 2021)\"), \n       filename = \"hlutf_ekki3.png\",\n       width = 8, height = 0.5 * 8, scale = 1.5,\n       bg = \"white\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(hoverlabel = list(align = \"left\"))"
  },
  {
    "objectID": "posts/landspitali/index.html#stéttarfélög",
    "href": "posts/landspitali/index.html#stéttarfélög",
    "title": "Landspítalinn",
    "section": "Stéttarfélög",
    "text": "Stéttarfélög\nHér má sjá fjölda og hlutföll stöðugilda fyrir fleiri stéttarfélög. Þar sem Sameyki varð ekki til fyrr en 2019 lagði ég saman fjölda stöðugilda hjá viðeigandi stéttarfélögum fyrir þann tíma.\n\nHlutföllFjöldi\n\n\n\n\nCode\nplot_dat <- d |> \n    select(ar, stodugildi, starts_with(\"stg\"), -ends_with(\"svid\")) |> \n    drop_na() |> \n    pivot_longer(c(-ar, -stodugildi)) |> \n    group_by(ar) |> \n    mutate(annad = stodugildi - sum(value)) |> \n    pivot_wider(names_from = name, values_from = value) |> \n    pivot_longer(c(-ar, -stodugildi)) |> \n    mutate(name = fct_reorder(name, value * (name != \"annad\"))) |> \n    group_by(ar) |> \n    mutate(hlutf = value / sum(value)) |> \n    ungroup() |> \n    mutate(name = fct_recode(name,\n                             \"Annað\" = \"annad\",\n                             \"Hjúkrunarfræðingar\" = \"stg_hjukr\",\n                             \"Læknar\" = \"stg_laekna\",\n                             \"Sjúkraliðar\" = \"stg_sjukral\",\n                             \"Sameyki\" = \"stg_sameyki\",\n                             \"Sálfræðingar\" = \"stg_salfr\",\n                             \"Sjúkraþjálfarar\" = \"stg_sjukrathj\",\n                             \"Félagsráðgjafar\" = \"stg_felrad\",\n                             \"Lyfjafræðingar\" = \"stg_lyfjafr\",\n                             \"Iðjuþjálfar\" = \"stg_idjuthj\",\n                             \"Ljósmæður\" = \"stg_ljosmaedur\"),\n           text = str_c(\"<b>\", name, \"</b>\", \"\\n\",\n                        \"Ár: \", ar, \"\\n\",\n                        \"<b>Hlutfall: \", percent(hlutf, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\"), \"</b>\\n\",\n                        \"Fjöldi: \", number(value, suffix = \" stöðugildi\", big.mark = \".\", decimal.mark = \",\"), \"\\n\"))\n\np <- plot_dat |> \n    ggplot(aes(ar, value, text = text)) +\n    geom_col(aes(fill = name, col = name), width = 1, position = \"fill\") +\n    scale_x_continuous(expand = expansion(),\n                       breaks = 2010:2021) +\n    scale_y_continuous(expand = expansion(),\n                       labels = label_percent()) +\n    scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n    scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n    theme_half_open() +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Dreifing stöðugilda á Landspítala eftir stéttarfélagi (2010 - 2021)\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(hoverlabel = list(align = \"left\"))\n\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <- d |> \n    select(ar, stodugildi, starts_with(\"stg\"), -ends_with(\"svid\")) |> \n    drop_na() |> \n    pivot_longer(c(-ar, -stodugildi)) |> \n    group_by(ar) |> \n    mutate(annad = stodugildi - sum(value)) |> \n    pivot_wider(names_from = name, values_from = value) |> \n    pivot_longer(c(-ar, -stodugildi)) |> \n    mutate(name = fct_reorder(name, value * (name != \"annad\"))) |> \n    group_by(ar) |> \n    mutate(hlutf = value / sum(value)) |> \n    ungroup() |> \n    mutate(name = fct_recode(name,\n                             \"Annað\" = \"annad\",\n                             \"Hjúkrunarfræðingar\" = \"stg_hjukr\",\n                             \"Læknar\" = \"stg_laekna\",\n                             \"Sjúkraliðar\" = \"stg_sjukral\",\n                             \"Sameyki\" = \"stg_sameyki\",\n                             \"Sálfræðingar\" = \"stg_salfr\",\n                             \"Sjúkraþjálfarar\" = \"stg_sjukrathj\",\n                             \"Félagsráðgjafar\" = \"stg_felrad\",\n                             \"Lyfjafræðingar\" = \"stg_lyfjafr\",\n                             \"Iðjuþjálfar\" = \"stg_idjuthj\",\n                             \"Ljósmæður\" = \"stg_ljosmaedur\"),\n           text = str_c(\"<b>\", name, \"</b>\", \"\\n\",\n                        \"Ár: \", ar, \"\\n\",\n                        \"Hlutfall: \", percent(hlutf, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                        \"<b>Fjöldi: \", number(value, suffix = \" stöðugildi\", big.mark = \".\", decimal.mark = \",\"), \"</b>\\n\"))\n\np <- plot_dat |> \n    ggplot(aes(ar, value, text = text)) +\n    geom_col(aes(fill = name, col = name), width = 1, position = \"stack\") +\n    scale_x_continuous(expand = expansion(),\n                       breaks = 2010:2021) +\n    scale_y_continuous(expand = expansion(),\n                       labels = label_number(big.mark = \".\", decimal.mark = \",\")) +\n    scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n    scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n    theme_half_open() +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Fjöldi stöðugilda á Landspítala eftir stéttarfélagi (2010 - 2021)\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(hoverlabel = list(align = \"left\"))"
  },
  {
    "objectID": "posts/landspitali/index.html#stoðþjónusta-yfirstjórnstjórnsýsla",
    "href": "posts/landspitali/index.html#stoðþjónusta-yfirstjórnstjórnsýsla",
    "title": "Landspítalinn",
    "section": "Stoðþjónusta (Yfirstjórn/stjórnsýsla)",
    "text": "Stoðþjónusta (Yfirstjórn/stjórnsýsla)\nTexti og gögn frá Spurt og svarað um Landspítala þar sem er m.a. vitnað í skýrslu McKinsey frá 2020.\n\nStjórnendur við Landspítala eru ríflega 200 talsins en starfsmenn um 6000 í rúmlega 4500 stöðugildum, að meðaltali einn stjórnandi á hverja 26 starfsmenn. Samkvæmt hinu erlenda ráðgjafarfyrirtæki McKinsey er „yfirstjórn/stjórnsýsla“ hlutfallslega minnst á Landspítala (13,2%) borið saman við Sjúkrahúsið á Akureyri (15,5%) og erlend samanburðarsjúkrahús (allt að 21,2%).\n\n\nÍ stoðþjónustu á Landspítala voru 602 stöðugildi árið 2020 sem gerir 13,5% af heildarfjölda stöðugilda það árið (4462 stg). Þetta er sambærilegt hlutfall og á Sjúkrahúsinu á Akureyri og einnig því samanburðarsjúkrahúsi sem valið var til samanburðar í skýrslu McKinsey frá árinu 2020.\n\n\nÞrátt fyrir að koma ekki beint að þjónustu við sjúklinga gegnir þetta starfsfólk engu að síður mikilvægu hlutverki. Þannig verður spítali ekki rekinn án fólks sem býr til mat handa sjúklingum, útvegar fatnað handa hjúkrunarfræðingum, reiknar laun handa sjúkraliðum, tæknifólks sem viðheldur öndunarvélum, forriturum sem passa upp á sjúkraskrár og svo framvegis. Þess má geta að á árunum eftir hrun var sérstaklega skorið niður í hópi þessara starfsmanna.\n\n\nÞannig var hlutfall starfsmanna í stoðþjónustu af heildarfjölda stöðugilda 16,3% árið 2008 en er sem fyrr segir 13,5% árið 2021. Það er sérstakt markmið stjórnenda Landspítala að fjölga starfsfólki í stoðþjónustu svo faglært starfsfólk geti einbeitt sér að beinni þjónustu við sjúklinga og starfað í samræmi við menntun sína (e. Working from the top of your licence).\n\n\nHlutfallFjöldi\n\n\n\n\nCode\nplot_dat <- d |> \n    select(ar, hlutf_stodtj, stodugildi) |> \n    drop_na() |> \n    mutate(text = str_c(\"Ár: \", ar, \"\\n\",\n                        \"<b>Hlutfall: \", percent(hlutf_stodtj, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\"), \"</b>\\n\",\n                        \"Fjöldi: \", number(hlutf_stodtj * stodugildi, suffix = \" stöðugildi\", big.mark = \".\", decimal.mark = \",\"), \"\\n\")) |> \n    drop_na()\n\np <- plot_dat |> \n    ggplot(aes(ar, hlutf_stodtj, text = text)) +\n    geom_line(aes(group = \"none\"), alpha = 0.6, col = \"black\") +\n    scale_x_continuous(expand = expansion(add = 0.6),\n                       breaks = 2006:2021) +\n    scale_y_continuous(expand = expansion(),\n                       labels = label_percent(),\n                       breaks = seq(0, 0.2, by = 0.02),\n                       limits = c(0.1, 0.2)) +\n    scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n    scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n    theme_half_open() +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Hlutfall stoðþjónustu af stöðugildum Landspítala (2008 - 2020)\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(hoverlabel = list(align = \"left\"))\n\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <- d |> \n    select(ar, hlutf_stodtj, stodugildi) |> \n    drop_na() |> \n    mutate(fjoldi = hlutf_stodtj * stodugildi,\n           text = str_c(\"Ár: \", ar, \"\\n\",\n                        \"Hlutfall: \", percent(hlutf_stodtj, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                        \"<b>Fjöldi: \", number(fjoldi, suffix = \" stöðugildi\", big.mark = \".\", decimal.mark = \",\"), \"</b>\")) |> \n    drop_na()\n\np <- plot_dat |> \n    ggplot(aes(ar, fjoldi, text = text)) +\n    geom_area(aes(group = \"none\"), alpha = 0.6, col = \"black\") +\n    scale_x_continuous(expand = expansion(add = 0.6),\n                       breaks = 2006:2021) +\n    scale_y_continuous(expand = expansion(),\n                       labels = label_number(),\n                       limits = c(0, NA)) +\n    scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n    scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n    theme_half_open() +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Fjöldi stöðugilda stoðþjónustu á Landspítala (2008 - 2020)\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(hoverlabel = list(align = \"left\"))"
  },
  {
    "objectID": "posts/landspitali/index.html#stjórnendur",
    "href": "posts/landspitali/index.html#stjórnendur",
    "title": "Landspítalinn",
    "section": "Stjórnendur",
    "text": "Stjórnendur\nFyrir tæpu ári síðan birti Landspítali Samantekt um stjórnendur á Landspítala og laun þeirra. Þar getum við séð hlutfall stjórnenda af öllum stöðugildum og notað svo gögnin um heildarfjölda stöðugilda til að reikna fjölda stöðugilda stjórnenda. Eins og sést að neðan hefur hlutfallið farið stöðugt lækkandi frá 2008 til 2020, og fjöldi stöðugilda stjórnenda lækkað eða haldist í stað.\n\nHlutfallFjöldi\n\n\n\n\nCode\nplot_dat <- d |> \n    select(ar, hlutf_stjornendur, stodugildi) |> \n    drop_na() |> \n    mutate(text = str_c(\"Ár: \", ar, \"\\n\",\n                        \"<b>Hlutfall: \", percent(hlutf_stjornendur, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\"), \"</b>\\n\",\n                        \"Fjöldi: \", number(hlutf_stjornendur * stodugildi, suffix = \" stöðugildi\", big.mark = \".\", decimal.mark = \",\"), \"\\n\")) |> \n    drop_na()\n\np <- plot_dat |> \n    ggplot(aes(ar, hlutf_stjornendur, text = text)) +\n    geom_line(aes(group = \"none\"), alpha = 0.6, col = \"black\") +\n    scale_x_continuous(expand = expansion(add = 0.6),\n                       breaks = 2006:2021) +\n    scale_y_continuous(expand = expansion(),\n                       labels = label_percent(),\n                       breaks = 0:10/100,\n                       limits = c(0.02, 0.07)) +\n    scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n    scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n    theme_half_open() +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Hlutfall stjórnenda af stöðugildum Landspítala (2008 - 2020)\",\n         subtitle = \"Árið 2008 voru stjórnendur 5,9% af stöðugildum en 4,7% árið 2020.\")\n\nggsave(plot = p +\n           geom_rangeframe() +\n           theme_tufte() +\n           scale_y_continuous(expand = expansion(),\n                              labels = label_percent(accuracy = 0.1),\n                              limits = c(0.03, 0.07),\n                              breaks = c(range(plot_dat$hlutf_stjornendur), \n                                         0, 0.03, 0.04, 0.05, 0.055, 0.07)) +\n           theme(plot.title = element_text(face = \"bold\")), \n       filename = \"hlutf_stjornendur.png\",\n       width = 8, height = 0.5 * 8, scale = 1.5,\n       bg = \"white\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(hoverlabel = list(align = \"left\"))\n\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <- d |> \n    select(ar, hlutf_stjornendur, stodugildi) |> \n    drop_na() |> \n    mutate(fjoldi = hlutf_stjornendur * stodugildi,\n           text = str_c(\"Ár: \", ar, \"\\n\",\n                        \"Hlutfall: \", percent(hlutf_stjornendur, accuracy = 0.1, big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                        \"<b>Fjöldi: \", number(fjoldi, suffix = \" stöðugildi\", big.mark = \".\", decimal.mark = \",\"), \"</b>\")) |> \n    drop_na()\n\np <- plot_dat |> \n    ggplot(aes(ar, fjoldi, text = text)) +\n    geom_area(aes(group = \"none\"), alpha = 0.6, col = \"black\") +\n    scale_x_continuous(expand = expansion(add = 0.6),\n                       breaks = 2006:2021) +\n    scale_y_continuous(expand = expansion(),\n                       labels = label_number(),\n                       limits = c(0, NA)) +\n    scale_colour_brewer(type = \"qual\", palette = \"Paired\") +\n    scale_fill_brewer(type = \"qual\", palette = \"Paired\") +\n    theme_half_open() +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Fjöldi stöðugilda stjórnenda á Landspítala (2008 - 2020)\",\n         subtitle = \"Árið 2008 voru stöðugildi stjórnenda 229,2 en voru 208,3 árið 2020\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n) |> \n    layout(hoverlabel = list(align = \"left\"))"
  },
  {
    "objectID": "posts/landspitali/index.html#skrifstofa",
    "href": "posts/landspitali/index.html#skrifstofa",
    "title": "Landspítalinn",
    "section": "Skrifstofa",
    "text": "Skrifstofa\nFyrir nokkrum árum endurskilgreindi Landspítali starfsemissviðin sín og tók að nota færri yfirsvið í starfsemisupplýsingum sínum. Í starfemisupplýsingum má sjá að stöðugildum hefur fjölgað á Skrifstofusviði, en þessi fjölgun þýðir ekki að skrifstofufólki hefur fjölgað heldur hefur verið að færa starfsemi á milli sviða. Ég bendi áhugasömum á Spurt og svarað um Landspítala.\n\n\nCode\nknitr::include_graphics(\"skrifstof_landsp.png\")\n\n\n\n\n\nTilkynning vegna skrifstofustöðugilda"
  },
  {
    "objectID": "posts/landspitali/index.html#á-höfðatölu",
    "href": "posts/landspitali/index.html#á-höfðatölu",
    "title": "Landspítalinn",
    "section": "Á höfðatölu",
    "text": "Á höfðatölu\n\n\nCode\nd <- read_csv(\"data.csv\") |> \n    mutate(text = str_c(\"Ár: \", ar, \"\\n\",\n                        \"Launaútgjöld: \", number(laun, suffix = \" kr\", big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                        \"Mannfjöldi (heild): \", number(pop, big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                        \"Mannfjöldi (65+): \", number(pop_65, big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                        \"Laun per íbúi (heild): \", number(laun_per_pers, suffix = \" kr\", big.mark = \".\", decimal.mark = \",\"), \"\\n\",\n                        \"Laun per íbúi (65+): \", number(laun_per_pers_65, suffix = \" kr\", big.mark = \".\", decimal.mark = \",\")))\n\n\nVið getum svo notað tölur Hagstofu um mannfjölda eftir aldri til að reikna launaútgjöld á höfðatölu, bæði fyrir alla íbúa og fyrir íbúa sem hafa náð 65 ára aldri.\nUpphæðirnar að neðan eru leiðréttar fyrir verðbólgu með vísitölu neysluverðs.\n\nAllir65+\n\n\nEf við skoðum launaútgjöld á hvern íbúa sýnist okkur að launaútgjöldin hafa aldrei verið hærri.\n\n\nCode\np <- d |> \n    ggplot(aes(x = ar, y = laun_per_pers, text = text)) +\n    geom_area(aes(group = \"none\"), alpha = 0.6, col = \"black\") +\n    scale_x_continuous(breaks = seq(1999, 2021, by = 2)) +\n    scale_y_continuous(labels = label_number(suffix = \" kr\", big.mark = \".\", decimal.mark = \",\")) +\n    coord_cartesian(ylim = c(0, NA)) +\n    theme_half_open() +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Launaútgjöld til Landspítala á íbúa\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n)\n\n\n\n\n\n\n\n\nEn þegar við skoðum launaútgjöld á hvern íbúa sem hefur náð 65 ára aldri eru við rétt að komast upp í sömu fjárhæð og árið 2007.\n\n\nCode\np <- d |> \n    ggplot(aes(x = ar, y = laun_per_pers_65, text = text)) +\n    geom_area(aes(group = \"none\"), alpha = 0.6, col = \"black\") +\n    scale_x_continuous(breaks = seq(1999, 2021, by = 2)) +\n    scale_y_continuous(labels = label_number(suffix = \" kr\", big.mark = \".\", decimal.mark = \",\")) +\n    theme_half_open() +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Launaútgjöld til Landspítala á 65+ ára íbúa\")\n\nggplotly(\n    p,\n    tooltip = \"text\"\n)"
  },
  {
    "objectID": "posts/leigaogkaupverd/index.html",
    "href": "posts/leigaogkaupverd/index.html",
    "title": "Leiga og kaupverð fasteigna",
    "section": "",
    "text": "Leiga sem hlutfall af afborgun láns\nNúna erum við tilbúin til að bera saman þróun leiguverðs og afborganir af húsnæðislánum samkvæmt forsendum að ofan.\n\n\nCode\nd <- d1 |> \n    inner_join(\n        d2,\n        by = c(\"ar\", \"staerd\", \"sveitarfelag\")\n    )\n\nplot_dat <- d |> \n    mutate(hlutf = leiguverd / afborgun) |> \n    filter(sveitarfelag %in% c(\"Reykjavíkurborg\", \"Kópavogsbær\", \n                               \"Seltjarnarnesbær\", \"Garðabær\", \"Hafnarfjarðarkaupstaður\",\n                               \"Mosfellsbær\")) |> \n    mutate(staerd = str_c(staerd, \" m2\") |> \n               fct_relevel(\"50-59 m2\",\n                           \"60-69 m2\",\n                           \"70-79 m2\",\n                           \"80-89 m2\",\n                           \"90-99 m2\",\n                           \"100-109 m2\"))\n\np <- plot_dat |> \n    ggplot(aes(ar, hlutf)) +\n    geom_hline(yintercept = 1, lty = 2) +\n    geom_line(aes(group = staerd, col = staerd)) +\n    # geom_rangeframe() +\n    scale_x_continuous(breaks = seq(2012, 2022, by = 2), expand = expansion(add = 0.2)) +\n    scale_y_log10(labels = label_percent(accuracy = 1),\n                  breaks = c(0.5, 1/1.6, 0.8, 1, 1.25, 1.6, 2),\n                  expand = expansion()) +\n    scale_colour_brewer(type = \"div\", palette = \"RdYlBu\", guide = guide_legend(nrow = 1)) +\n    facet_wrap(\"sveitarfelag\") +\n    coord_cartesian(ylim = c(0.5, 2)) +\n    theme_half_open(font_size = 10) +\n    theme(legend.position = \"top\",\n          plot.title = element_text(face = \"bold\"),\n          panel.spacing.x = unit(0.5, \"cm\"),\n          strip.background = element_rect(fill = \"grey95\", colour = \"black\"),\n          plot.margin = margin(t = 5, r = 15, b = 5, l = 5)) +\n    labs(x = NULL,\n         y = \"Leiguverð / Afborgun\",\n         col = NULL,\n         title = \"Hvernig hefur mánaðarlegt leiguverð þróast sem hlutfall af íbúðalánaafborgunum?\",\n         subtitle = \"Hér gildir 100% að leiguverð = afborgun, yfir 100% að leiguverð er hærra og undir 100% að það sé lægra.\",\n         caption = \"Óverðtryggt lán tekið fyrir 80% af miðgildi kaupverðs innan hvers flokks með jöfnum greiðslum og breytilegum vöxtum samkvæmt lánatöflu Landsbankans.\\nMyndin er á lograkvarða (50% og 200% eru jafnlangt frá 100%)\")\n\np\n\n\n\n\n\nCode\nggsave(plot = p, filename = \"leiga_hlutf_afborgun.png\",\n       width = 8, height = 0.7 * 8, scale = 1.2, bg = \"white\")"
  },
  {
    "objectID": "posts/kosningarannsokn/index.html",
    "href": "posts/kosningarannsokn/index.html",
    "title": "Kjósendatryggð",
    "section": "",
    "text": "Íslenska Kosningarannsóknin er framkvæmd af Félagsvísindastofnun Háskóla Íslands, og mér finnst vinnan sem fer fram þar hreint út sagt frábær og upplýsingar um gögnin vel skipulagðar, enda eina sviðið sem ég veit að sé með eigin RStudio server innanhúss!\nÞessi úrvinnsla byggir á Íslensku Kosningarannsókninni sem er framkvæmd af Félagsvísindastofnun Háskóla Íslands eftir alþingiskosninar. Notendaskilmálar GAGNÍS.\n\n\n\n\nCode\npreprocess_data_attrition <- function(doi, filename, year) {\n    get_dataframe_by_name(filename,\n                          doi,\n                          original = TRUE,\n                          .f = haven::read_sav) |> \n        select(current = starts_with(\"prtvote\"), former = starts_with(\"prtfvote\"), age) |> \n        mutate_at(vars(everything(), -age), as_factor) |> \n        filter(!as.character(current) %in% c(\"No, did not vote\",\n                                             \"Not applicable\",\n                                             \"Don‘t remember what I voted\",\n                                             \"95\",\n                                             \"Cast a blank or invalid ballot\",\n                                             \"Voted, refuses to say for what party\",\n                                             \"Other party, what party\",\n                                             \"Refuses to answer (volunteered)\",\n                                             \"Don’t know (volunteered)\",\n                                             \"Voted, does not want to say which party\",\n                                             \"Cast a blank ballot\",\n                                             \"Cast an invalid vote\",\n                                             \"Missing\",\n                                             \"Voted, doesn‘t want to say for what party\",\n                                             \"Another party or party list, which?\",\n                                             \"Refuses to answer\")) |> \n        drop_na(current) |> \n        group_by(current, former) |> \n        summarise(n = n(),\n                  age = mean(age),\n                  .groups = \"drop\") |> \n        arrange(former, desc(n)) |> \n        group_by(former) |> \n        mutate(p = n / sum(n),\n               cum_p = cumsum(p)) |> \n        ungroup() |> \n        mutate(year = year)\n}\n\ntranslate_parties <- function(name) {\n    parties <- c(\n        \"Independence Party\" = \"Sjálfstæðisflokkurinn\",\n        \"Progressive Party\" = \"Framsóknarflokkurinn\",\n        \"Social Democratic Alliance\" = \"Samfylkingin\",\n        \"Left Green Movement\" = \"Vinstri Græn\",\n        \"Pirate Party\" = \"Píratar\",\n        \"Reform Party\" = \"Viðreisn\",\n        \"Centre Party\" = \"Miðflokkurinn\",\n        \"Bright Future\" = \"Björt Framtíð\",\n        \"Peoples party\" = \"Flokkur Fólksins\",\n        \"Civic Movement\" = \"Borgarahreyfingin\",\n        \"Dawn\" = \"Dögun\",\n        \"Liberal Party\" = \"Frjálslyndi flokkurinn\",\n        \"Cast a blank or invalid ballot\" = \"Skilaði auðu\",\n        \"95\" = \"Nýr kjósandi\"\n    )\n    \n    ifelse(name %in% names(parties), parties[name], name)\n}\n\n\n\n\nCode\ndoi <- c(\"doi:10.34881/1.00011\", \n         \"doi:10.34881/1.00010\",\n         \"doi:10.34881/1.00009\",\n         \"doi:10.34881/1.00008\",\n         \"doi:10.34881/1.00007\",\n         \"doi:10.34881/1.00006\")\nfilename <- c(\"ICENES_2017_Open_access_english_1release.tab\",\n              \"ICENES_2016_Open_access_english_2release.tab\",\n              \"ICENESS_2013_open_access_english_1release.tab\",\n              \"ICENES_2009_open_access_english_3release.tab\",\n              \"ICENES_2007_open_access_english_3release.tab\",\n              \"ICENES_2003_open_access_english_4release.tab\")\nyear <- c(2017,\n          2016,\n          2013,\n          2009,\n          2007,\n          2003)\n\nd_retention <- pmap(list(doi = doi, filename = filename, year = year), preprocess_data_attrition) |> \n    reduce(bind_rows) |> \n    mutate_at(vars(current, former), as.character) |> \n    mutate_at(vars(current, former), translate_parties)\n\n\n\n\nTil að auðvelda mér að merkja flokkana með réttum litum geymi ég hex kóða fyrir litina þeirra og set þá svo inn í litapallettur þar sem við á.\n\n\nCode\nxS <- \"#e41a1c\"\nxV <- \"#238b45\"\nxD <- \"#377eb8\"\nxP <- \"#984ea3\"\nxB <- \"#b2df8a\"\nxBF <- \"#cab2d6\"\nxC <- \"#ff7f00\"\nxM <- \"#08306b\"\nxFF <- \"#fee391\"\nAnnad <- \"#e5d8bd\"\n\n\n\n\n\n\nÞátttakendur eru m.a. spurðir hvað þau kusu í nýliðnum kosningum en líka hvað þau kusu þar á undan. Þótt svör við slíkum spurningum séu ekki 100% áreiðanleg getum við nálgað svör við spurningunni:\n“Hvaða % kjósenda flokks úr síðustu kosningum kaus hann aftur núna?”\n\n\nCode\nplot_dat <- d_retention |> \n    filter(current %in% c(\"Framsóknarflokkurinn\",\n                          \"Píratar\",\n                          \"Samfylkingin\",\n                          \"Sjálfstæðisflokkurinn\",\n                          \"Vinstri Græn\"),\n           current == former)\n\nplot_text <- plot_dat |> \n    filter(year == max(year)) |> \n    mutate(p = case_when(current == \"Píratar\" ~ p + 0.005,\n                         current == \"Framsóknarflokkurinn\" ~ p - 0.005,\n                         current == \"Samfylkingin\" ~ p + 0.00,\n                         TRUE ~ p))\n\n\np <- plot_dat |> \n    ggplot(aes(year, p)) +\n    geom_line(aes(col = current, group = current)) +\n    geom_point(aes(col = current, group = current)) +\n    geom_text(data = plot_text, \n              aes(label = current, col = current), hjust = 0, nudge_x = 0.2) +\n    geom_rangeframe() +\n    scale_y_continuous(limits = range(plot_dat$p), \n                       labels = label_percent(),\n                       breaks = c(range(plot_dat$p), 0.4, 0.5, 0.6, 0.7)) +\n    scale_x_continuous(breaks = c(2003, 2007, 2009, 2013, 2016, 2017),\n                       limits = c(2003, 2020)) +\n    scale_colour_manual(values = c(xB,\n                                   xP,\n                                   xS,\n                                   xD,\n                                   xV)) +\n    labs(title = \"Flokkshollusta í alþingiskosningum frá 2003 - 2017\",\n         subtitle = \"Hlutfall eigin kjósenda sem flokkur heldur í frá síðustu kosningum\",\n         x = NULL,\n         y = NULL) +\n    theme_tufte() +\n    theme(plot.caption = element_text(hjust = 0),\n          legend.position = \"none\",\n          plot.title = element_text(face = \"bold\"))\n\np\n\n\n\n\n\nCode\nggsave(plot = p, filename = \"flokkshollusta.png\",\n       width = 8, height = 0.5 * 8, scale = 1.3, bg = \"white\")\n\n\n\n\n\n\nSamfylkinginSjálfstæðisflokkurinnFramsóknarflokkurinnVinstri Græn\n\n\n\n\nCode\np <- d_retention |> \n    filter(former == \"Samfylkingin\") |> \n    mutate(current = ifelse(current %in% c(\"Samfylkingin\",\n                                           \"Vinstri Græn\",\n                                           \"Sjálfstæðisflokkurinn\", \n                                           \"Píratar\",\n                                           \"Framsóknarflokkurinn\", \n                                           \"Píratar\",\n                                           \"Björt Framtíð\",\n                                           \"Viðreisn\",\n                                           \"Miðflokkurinn\",\n                                           \"Flokkur Fólksins\"),\n                            current,\n                            \"Annað\")) |> \n    mutate(current = as_factor(current),\n           current = fct_reorder(current, p * (current != \"Annað\"), .fun = max)) |> \n    mutate(election = as.numeric(as.factor(year)),\n           text = str_c(\"Kaus síðast: \", former, \"\\n\",\n                        \"Kaus nú: \", current, \"\\n\",\n                        \"Hlutfall (af kjósendum síðast): \", percent(p, accuracy = 0.1))) |>\n    ggplot(aes(election, p, text = text)) +\n    geom_col(aes(fill = current), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xFF,\n                                 xM,\n                                 xD,\n                                 xC,\n                                 xB,\n                                 xP,\n                                 xBF,\n                                 xV,\n                                 xS)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert missir Samfylkingin kjósendur sína?\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\np <- d_retention |> \n    filter(former == \"Sjálfstæðisflokkurinn\") |> \n    mutate(current = ifelse(current %in% c(\"Samfylkingin\",\n                                           \"Vinstri Græn\",\n                                           \"Flokkur Fólksins\",\n                                           \"Sjálfstæðisflokkurinn\", \n                                           \"Píratar\",\n                                           \"Framsóknarflokkurinn\", \n                                           \"Píratar\",\n                                           \"Björt Framtíð\",\n                                           \"Viðreisn\",\n                                           \"Miðflokkurinn\"),\n                            current,\n                            \"Annað\")) |> \n    mutate(current = as_factor(current),\n           current = fct_reorder(current, p * (current != \"Annað\"), .fun = max),\n           curent = factor(current, levels = rev(levels(current)))) |> \n    mutate(election = as.numeric(as.factor(year)),\n           text = str_c(\"Kaus síðast: \", former, \"\\n\",\n                        \"Kaus nú: \", current, \"\\n\",\n                        \"Hlutfall (af kjósendum síðast): \", percent(p, accuracy = 0.1))) |>\n    ggplot(aes(election, p, text = text)) +\n    geom_col(aes(fill = current), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xP,\n                                 xFF,\n                                 xBF,\n                                 xV,\n                                 xM,\n                                 xC,\n                                 xB,\n                                 xS,\n                                 xD)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert missir Sjálfstæðisflokkurinn kjósendur sína?\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\np <- d_retention |> \n    filter(former == \"Framsóknarflokkurinn\") |> \n    mutate(current = ifelse(current %in% c(\"Samfylkingin\",\n                                           \"Vinstri Græn\",\n                                           \"Flokkur Fólksins\",\n                                           \"Sjálfstæðisflokkurinn\", \n                                           \"Píratar\",\n                                           \"Framsóknarflokkurinn\", \n                                           \"Píratar\",\n                                           \"Björt Framtíð\",\n                                           \"Viðreisn\",\n                                           \"Miðflokkurinn\"),\n                            current,\n                            \"Annað\")) |> \n    mutate(current = as_factor(current),\n           current = fct_reorder(current, p * (current != \"Annað\"), .fun = max),\n           curent = factor(current, levels = rev(levels(current)))) |> \n    mutate(election = as.numeric(as.factor(year)),\n           text = str_c(\"Kaus síðast: \", former, \"\\n\",\n                        \"Kaus nú: \", current, \"\\n\",\n                        \"Hlutfall (af kjósendum síðast): \", percent(p, accuracy = 0.1))) |>\n    ggplot(aes(election, p, text = text)) +\n    geom_col(aes(fill = current), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xBF,\n                                 xC,\n                                 xP,\n                                 xFF,\n                                 xV,\n                                 xS,\n                                 xD,\n                                 xM,\n                                 xB)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert missir Framsóknarflokkurinn kjósendur sína?\",\n         caption = \"Kóði og gögn: https://github.com/bgautijonsson/kosningarannsokn\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\np <- d_retention |> \n    filter(former == \"Vinstri Græn\") |> \n    mutate(current = ifelse(current %in% c(\"Samfylkingin\",\n                                           \"Flokkur Fólksins\",\n                                           \"Vinstri Græn\",\n                                           \"Sjálfstæðisflokkurinn\", \n                                           \"Píratar\",\n                                           \"Framsóknarflokkurinn\", \n                                           \"Píratar\",\n                                           \"Björt Framtíð\",\n                                           \"Viðreisn\",\n                                           \"Miðflokkurinn\"),\n                            current,\n                            \"Annað\")) |> \n    mutate(current = as_factor(current),\n           current = fct_reorder(current, p * (current != \"Annað\"), .fun = max),\n           curent = factor(current, levels = rev(levels(current)))) |> \n    mutate(election = as.numeric(as.factor(year)),\n           text = str_c(\"Kaus síðast: \", former, \"\\n\",\n                        \"Kaus nú: \", current, \"\\n\",\n                        \"Hlutfall (af kjósendum síðast): \", percent(p, accuracy = 0.1))) |>\n    ggplot(aes(election, p, text = text)) +\n    geom_col(aes(fill = current), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xM,\n                                 xFF,\n                                 xC,\n                                 xD,\n                                 xBF,\n                                 xB,\n                                 xP,\n                                 xS,\n                                 xV)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert missa Vinstri Græn kjósendur sína?\")\n\nggplotly(p, tooltip = \"text\")"
  },
  {
    "objectID": "posts/kosningarannsokn/index.html#útbúa-gögnin-1",
    "href": "posts/kosningarannsokn/index.html#útbúa-gögnin-1",
    "title": "Kjósendatryggð",
    "section": "Útbúa gögnin",
    "text": "Útbúa gögnin\n\n\nCode\npreprocess_data_recruitment <- function(doi, filename, year) {\n    get_dataframe_by_name(filename,\n                          doi,\n                          original = TRUE,\n                          .f = haven::read_sav) |> \n        select(current = starts_with(\"prtvote\"), former = starts_with(\"prtfvote\"), age) |> \n        mutate_at(vars(everything(), -age), as_factor) |> \n        filter(!as.character(former) %in% c(\"No, did not vote\",\n                                            \"Not applicable\",\n                                            \"Don‘t remember what I voted\",\n                                            \"95\",\n                                            \"Cast a blank or invalid ballot\",\n                                            \"Voted, refuses to say for what party\",\n                                            \"Other party, what party\",\n                                            \"Refuses to answer (volunteered)\",\n                                            \"Don’t know (volunteered)\",\n                                            \"Voted, does not want to say which party\",\n                                            \"Cast a blank ballot\",\n                                            \"Cast an invalid vote\",\n                                            \"Missing\",\n                                            \"Voted, doesn‘t want to say for what party\",\n                                            \"Another party or party list, which?\",\n                                            \"Refuses to answer\")) |> \n        drop_na(former) |> \n        group_by(current, former) |> \n        summarise(n = n(),\n                  age = mean(age),\n                  .groups = \"drop\") |> \n        arrange(current, desc(n)) |> \n        group_by(current) |> \n        mutate(p = n / sum(n),\n               cum_p = cumsum(p)) |> \n        ungroup() |> \n        mutate(year = year)\n}\n\ntranslate_parties <- function(name) {\n    parties <- c(\n        \"Independence Party\" = \"Sjálfstæðisflokkurinn\",\n        \"Progressive Party\" = \"Framsóknarflokkurinn\",\n        \"Social Democratic Alliance\" = \"Samfylkingin\",\n        \"Left Green Movement\" = \"Vinstri Græn\",\n        \"Pirate Party\" = \"Píratar\",\n        \"Reform Party\" = \"Viðreisn\",\n        \"Centre Party\" = \"Miðflokkurinn\",\n        \"Bright Future\" = \"Björt Framtíð\",\n        \"Peoples party\" = \"Flokkur Fólksins\",\n        \"Civic Movement\" = \"Borgarahreyfingin\",\n        \"Dawn\" = \"Dögun\",\n        \"Liberal Party\" = \"Frjálslyndi flokkurinn\"\n    )\n    \n    ifelse(name %in% names(parties), parties[name], name)\n}\n\nd_recruitment <- pmap(list(doi = doi, filename = filename, year = year), preprocess_data_recruitment) |> \n    reduce(bind_rows) |> \n    mutate_at(vars(current, former), as.character) |> \n    mutate_at(vars(current, former), translate_parties)"
  },
  {
    "objectID": "posts/kosningarannsokn/index.html#nýliðun-frá-öðrum-flokkum",
    "href": "posts/kosningarannsokn/index.html#nýliðun-frá-öðrum-flokkum",
    "title": "Kjósendatryggð",
    "section": "Nýliðun frá öðrum flokkum",
    "text": "Nýliðun frá öðrum flokkum\n\n\nCode\nplot_dat <- d_recruitment |> \n    filter(current %in% c(\"Framsóknarflokkurinn\",\n                          \"Píratar\",\n                          \"Samfylkingin\",\n                          \"Sjálfstæðisflokkurinn\",\n                          \"Vinstri Græn\"),\n           current != former,\n           !former %in% c(\"No, did not vote\",\n                          \"Not applicable\",\n                          \"Don‘t remember what I voted\",\n                          \"Nýr kjósandi\",\n                          \"Skilaði auðu\",\n                          \"Voted, refuses to say for what party\",\n                          \"Other party, what party\",\n                          \"Refuses to answer (volunteered)\",\n                          \"Don’t know (volunteered)\"),\n           !(current == \"Píratar\" & year == 2013), !(current %in% c(\"Flokkur Fólksins\", \"Viðreisn\") & year == 2016)) |> \n    group_by(current, year) |> \n    summarise(p = sum(p),\n              .groups = \"drop\")\n\nplot_text <- plot_dat |> \n    filter(year == max(year)) |> \n    mutate(p = case_when(current == \"Flokkur Fólksins\" ~ p + 0.025,\n                         current == \"Framsóknarflokkurinn\" ~ p - 0.01,\n                         current == \"Viðreisn\" ~ p - 0.01,\n                         TRUE ~ p))\n\n\np <- plot_dat |> \n    ggplot(aes(year, p)) +\n    geom_line(aes(col = current, group = current)) +\n    geom_point(aes(col = current, group = current)) +\n    geom_text(data = plot_text, \n              aes(label = current, col = current), hjust = 0, nudge_x = 0.2) +\n    geom_rangeframe() +\n    scale_y_continuous(limits = range(plot_dat$p), \n                       labels = label_percent(),\n                       breaks = c(range(plot_dat$p), 0.1, 0.2, 0.3, 0.4, 0.5, 0.6)) +\n    scale_x_continuous(breaks = c(2003, 2007, 2009, 2013, 2016, 2017),\n                       limits = c(2003, 2021.5)) +\n    scale_colour_manual(values = c(xB,\n                                   xP,\n                                   xS,\n                                   xD,\n                                   xV)) +\n    labs(title = \"Nýliðun kjósenda frá öðrum flokkum í alþingiskosningum frá 2003 - 2017\",\n         subtitle = \"Hlutfall kjósenda sem kusu annan flokk í síðustu kosningum\",\n         x = NULL,\n         y = NULL) +\n    theme_tufte() +\n    theme(plot.caption = element_text(hjust = 0),\n          legend.position = \"none\",\n          plot.title = element_text(face = \"bold\"))\n\np"
  },
  {
    "objectID": "posts/kosningarannsokn/index.html#hvaðan-sækja-flokkar-kjósendur-sína",
    "href": "posts/kosningarannsokn/index.html#hvaðan-sækja-flokkar-kjósendur-sína",
    "title": "Kjósendatryggð",
    "section": "Hvaðan sækja flokkar kjósendur sína?",
    "text": "Hvaðan sækja flokkar kjósendur sína?\n\nSamfylkinginSjálfstæðisflokkurinnFramsóknarflokkurinnVinstri GrænViðreisnPíratarMiðflokurinn\n\n\n\n\nCode\np <- d_recruitment |> \n    filter(current == \"Samfylkingin\") |> \n    mutate(former = ifelse(former %in% c(\"Samfylkingin\",\n                                         \"Vinstri Græn\",\n                                         \"Sjálfstæðisflokkurinn\", \n                                         \"Píratar\",\n                                         \"Framsóknarflokkurinn\", \n                                         \"Flokkur Fólksins\",\n                                         \"Píratar\",\n                                         \"Björt Framtíð\",\n                                         \"Viðreisn\",\n                                         \"Miðflokkurinn\"),\n                           former,\n                           \"Annað\")) |> \n    mutate(former = as_factor(former),\n           former = fct_reorder(former, p * (former != \"Annað\") + 1e-8 * (former == \"Miðflokkurinn\"), .fun = max),\n           election = as.numeric(as.factor(year)),\n           text = str_c(\"Kaus síðast: \", former, \"\\n\",\n                        \"Kaus nú: \", current, \"\\n\",\n                        \"Hlutfall (af kjósendum núna): \", percent(p, accuracy = 0.1))) |>\n    ggplot(aes(election, p, text = text)) +\n    geom_col(aes(fill = former), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xC,\n                                 xP,\n                                 xBF,\n                                 xB,\n                                 xD,\n                                 xV,\n                                 xS)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert sækir Samfylkingin kjósendur sína?\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\np <- d_recruitment |> \n    filter(current == \"Sjálfstæðisflokkurinn\") |> \n    mutate(former = ifelse(former %in% c(\"Samfylkingin\",\n                                         \"Vinstri Græn\",\n                                         \"Sjálfstæðisflokkurinn\", \n                                         \"Píratar\",\n                                         \"Framsóknarflokkurinn\", \n                                         \"Píratar\",\n                                         \"Björt Framtíð\",\n                                         \"Viðreisn\",\n                                         \"Miðflokkurinn\"),\n                           former,\n                           \"Annað\")) |> \n    mutate(former = as_factor(former),\n           former = fct_reorder(former, p * (former != \"Annað\"), .fun = max),\n           election = as.numeric(as.factor(year)),\n           text = str_c(\"Kaus síðast: \", former, \"\\n\",\n                        \"Kaus nú: \", current, \"\\n\",\n                        \"Hlutfall (af kjósendum núna): \", percent(p, accuracy = 0.1))) |>\n    ggplot(aes(election, p, text = text)) +\n    geom_col(aes(fill = former), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xBF,\n                                 xP,\n                                 xV,\n                                 xC,\n                                 xS,\n                                 xB,\n                                 xD)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert sækir Sjálfstæðisflokkurinn kjósendur sína?\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\np <- d_recruitment |> \n    filter(current == \"Framsóknarflokkurinn\") |> \n    mutate(former = ifelse(former %in% c(\"Samfylkingin\",\n                                         \"Vinstri Græn\",\n                                         \"Sjálfstæðisflokkurinn\", \n                                         \"Píratar\",\n                                         \"Framsóknarflokkurinn\", \n                                         \"Píratar\",\n                                         \"Björt Framtíð\",\n                                         \"Viðreisn\",\n                                         \"Miðflokkurinn\"),\n                           former,\n                           \"Annað\")) |> \n    mutate(former = as_factor(former),\n           former = fct_reorder(former, p * (former != \"Annað\"), .fun = max),\n           election = as.numeric(as.factor(year)),\n           text = str_c(\"Kaus síðast: \", former, \"\\n\",\n                        \"Kaus nú: \", current, \"\\n\",\n                        \"Hlutfall (af kjósendum núna): \", percent(p, accuracy = 0.1))) |>\n    ggplot(aes(election, p, text = text)) +\n    geom_col(aes(fill = former), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xP,\n                                 xBF,\n                                 xC,\n                                 xV,\n                                 xS,\n                                 xD,\n                                 xB)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert sækir Framsóknarflokurinn kjósendur sína?\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\np <- d_recruitment |> \n    filter(current == \"Vinstri Græn\") |> \n    mutate(former = ifelse(former %in% c(\"Samfylkingin\",\n                                         \"Vinstri Græn\",\n                                         \"Sjálfstæðisflokkurinn\", \n                                         \"Píratar\",\n                                         \"Framsóknarflokkurinn\", \n                                         \"Píratar\",\n                                         \"Björt Framtíð\",\n                                         \"Viðreisn\",\n                                         \"Miðflokkurinn\"),\n                           former,\n                           \"Annað\")) |> \n    mutate(former = as_factor(former),\n           former = fct_reorder(former, p * (former != \"Annað\"), .fun = max),\n           election = as.numeric(as.factor(year)),\n           text = str_c(\"Kaus síðast: \", former, \"\\n\",\n                        \"Kaus nú: \", current, \"\\n\",\n                        \"Hlutfall (af kjósendum núna): \", percent(p, accuracy = 0.1))) |>\n    ggplot(aes(election, p, text = text)) +\n    geom_col(aes(fill = former), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xC,\n                                 xBF,\n                                 xD,\n                                 xP,\n                                 xB,\n                                 xS,\n                                 xV)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvaðan sækja Vinstri Græn kjósendur sína?\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\np <- d_recruitment |> \n    filter(current == \"Viðreisn\") |> \n    mutate(former = ifelse(former %in% c(\"Samfylkingin\",\n                                         \"Vinstri Græn\",\n                                         \"Sjálfstæðisflokkurinn\", \n                                         \"Píratar\",\n                                         \"Framsóknarflokkurinn\", \n                                         \"Píratar\",\n                                         \"Björt Framtíð\",\n                                         \"Viðreisn\",\n                                         \"Miðflokkurinn\"),\n                           former,\n                           \"Annað\")) |> \n    mutate(former = as_factor(former),\n           former = fct_reorder(former, p * (former != \"Annað\"), .fun = max),\n           election = as.numeric(as.factor(year)),\n           text = str_c(\"Kaus síðast: \", former, \"\\n\",\n                        \"Kaus nú: \", current, \"\\n\",\n                        \"Hlutfall (af kjósendum núna): \", percent(p, accuracy = 0.1))) |>\n    ggplot(aes(election, p, text = text)) +\n    geom_col(aes(fill = former), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:2, labels = c(2016, 2017)) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xP,\n                                 xV,\n                                 xBF,\n                                 xB,\n                                 xS,\n                                 xD,\n                                 xC)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert sækir Viðreisn kjósendur sína?\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\np <- d_recruitment |> \n    filter(current == \"Píratar\") |> \n    mutate(former = ifelse(former %in% c(\"Samfylkingin\",\n                                         \"Vinstri Græn\",\n                                         \"Sjálfstæðisflokkurinn\", \n                                         \"Píratar\",\n                                         \"Framsóknarflokkurinn\", \n                                         \"Píratar\",\n                                         \"Björt Framtíð\",\n                                         \"Viðreisn\",\n                                         \"Miðflokkurinn\"),\n                           former,\n                           \"Annað\")) |> \n    mutate(former = as_factor(former),\n           former = fct_reorder(former, p * (former != \"Annað\"), .fun = max),\n           election = as.numeric(as.factor(year)),\n           text = str_c(\"Kaus síðast: \", former, \"\\n\",\n                        \"Kaus nú: \", current, \"\\n\",\n                        \"Hlutfall (af kjósendum núna): \", percent(p, accuracy = 0.1))) |>\n    ggplot(aes(election, p, text = text)) +\n    geom_col(aes(fill = former), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:3, labels = c(2013, 2016, 2017)) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xC,\n                                 xB,\n                                 xD,\n                                 xBF,\n                                 xS,\n                                 xV,\n                                 xP)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvaðan sækja Píratar kjósendur sína?\")\n\nggplotly(p, tooltip = \"text\")\n\n\n\n\n\n\n\n\n\n\nCode\np <- d_recruitment |> \n    filter(current == \"Miðflokkurinn\") |> \n    mutate(former = ifelse(former %in% c(\"Samfylkingin\",\n                                         \"Vinstri Græn\",\n                                         \"Sjálfstæðisflokkurinn\", \n                                         \"Píratar\",\n                                         \"Framsóknarflokkurinn\", \n                                         \"Píratar\",\n                                         \"Björt Framtíð\",\n                                         \"Viðreisn\",\n                                         \"Miðflokkurinn\"),\n                           former,\n                           \"Annað\")) |> \n    mutate(former = as_factor(former),\n           former = fct_reorder(former, p * (former != \"Annað\"), .fun = max),\n           election = as.numeric(as.factor(year)),\n           text = str_c(\"Kaus síðast: \", former, \"\\n\",\n                        \"Kaus nú: \", current, \"\\n\",\n                        \"Hlutfall (af kjósendum núna): \", percent(p, accuracy = 0.1))) |>\n    ggplot(aes(election, p, text = text)) +\n    geom_col(aes(fill = former), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:1, labels = c(2017)) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xV,\n                                 xS,\n                                 xC,\n                                 xP,\n                                 xD,\n                                 xB,\n                                 xM)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert sækir Miðflokkurinn kjósendur sína?\")\n\nggplotly(p, tooltip = \"text\")"
  },
  {
    "objectID": "posts/orkumal/index.html",
    "href": "posts/orkumal/index.html",
    "title": "Orkumál",
    "section": "",
    "text": "Efnahagsþróun\n\nLandsframleiðslaHagvöxtur\n\n\n\n\nCode\ncountries <- c(\"Denmark\", \"Finland\",\n               \"Iceland\", \"New Zealand\",\n               \"Norway\", \"Qatar\", \n               \"Sweden\", \"United States\",\n               \"Venezuela\")\nicelandic <- c(\n    \"Denmark\" = \"Danmörk\",\n    \"Finland\" = \"Finnland\",\n    \"Germany\" = \"Þýskaland\", \n    \"Iceland\" = \"Ísland\", \n    \"New Zealand\" = \"Nýja Sjáland\",\n    \"Norway\" = \"Noregur\",\n    \"Qatar\" = \"Katar\",\n    \"Sweden\" = \"Svíþjóð\",\n    \"United States\" = \"Bandaríkin\",\n    \"Venezuela\" = \"Venesúela\")\n\nplot_dat <- d |> \n    select(year, country, gdp_per_capita) |> \n    drop_na() |> \n    mutate(alpha = country %in% countries,\n           colour = fct_other(country,\n                              keep = countries,\n                              other_level = \"Other\"),\n           y = gdp_per_capita,\n           y = case_when(country == \"Iceland\" ~ y * 0.95,\n                         country == \"Denmark\" ~ y * 1.05,\n                         country == \"Germany\" ~ y * 1.02,\n                         country == \"Sweden\" ~ y * 0.98,\n                         country == \"Norway\" ~ y - 0.02,\n                         TRUE ~ y)) |> \n    filter(year >= 1990) |> \n    group_by(country) |> \n    filter(all(gdp_per_capita >= 1e4)) |> \n    ungroup()\n\n\nplot_dat |> \n    ggplot(aes(year, gdp_per_capita,\n               colour = colour,\n               alpha = alpha)) +\n    geom_line(aes(group = country, colour = colour, alpha = alpha, size = alpha)) +\n    geom_text(data = plot_dat |> \n                  filter(country %in% countries,\n                         year == max(year)) |> \n                  mutate(country = icelandic[country]),\n              aes(y = y, label = country),\n              hjust = 0, nudge_x = 0.1, size = 4) +\n    geom_rangeframe(alpha = 1, colour = \"black\") +\n    scale_x_continuous(expand = expansion(),\n                       limits = c(1990, 2021.5),\n                       breaks = c(1990,  1995, 2000, 2005, 2010, 2015, 2018)) +\n    scale_y_log10(breaks = c(3e4, 1e5, range(plot_dat$gdp_per_capita)),\n                  limits = c(1e4, NA),\n                  labels = label_number(suffix = \"$\", big.mark = \".\", decimal.mark = \",\")) +\n    scale_colour_manual(values = c(\"#a50f15\",\n                                   \"#a6bddb\",\n                                   \"#045a8d\",\n                                   \"black\", \n                                   \"#e41a1c\", \n                                   \"#980043\",\n                                   \"#fed976\",\n                                   \"#0868ac\",\n                                   \"#fed976\",\n                                   \"grey\")) +\n    scale_alpha_manual(values = c(0.3, 1)) +\n    scale_size_manual(values = c(0.5, 1)) +\n    theme_tufte() +\n    theme(legend.position = \"none\",\n          plot.title = element_text(face = \"bold\")) +\n    coord_cartesian() +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Þróun landsframleiðslu á mann (verðlag 2011) árin 1980 - 2018\")\n\n\n\n\n\n\n\n\n\nCode\ncountries <- c(\"Denmark\", \"Finland\",\n               \"Iceland\", \n               \"Norway\", \n               \"Sweden\")\nicelandic <- c(\n    \"Denmark\" = \"Danmörk\",\n    \"Finland\" = \"Finnland\",\n    \"Germany\" = \"Þýskaland\", \n    \"Iceland\" = \"Ísland\", \n    \"New Zealand\" = \"Nýja Sjáland\",\n    \"Norway\" = \"Noregur\",\n    \"Qatar\" = \"Katar\",\n    \"Sweden\" = \"Svíþjóð\",\n    \"United States\" = \"Bandaríkin\",\n    \"Venezuela\" = \"Venesúela\")\n\nplot_dat <- d |> \n    select(year, country, gdp_per_capita) |> \n    drop_na() |> \n    filter(year >= 1989) |> \n    group_by(country) |> \n    filter(all(gdp_per_capita >= 1e4)) |> \n    mutate(growth = c(1, exp(diff(log(gdp_per_capita))))) |> \n    ungroup() |> \n    filter(year >= 1990) |> \n    mutate(alpha = country %in% countries,\n           colour = fct_other(country,\n                              keep = countries,\n                              other_level = \"Other\"),\n           y = growth,\n           y = case_when(country == \"Iceland\" ~ y * 1,\n                         country == \"Denmark\" ~ y * 1,\n                         country == \"Finland\" ~ y + 0.002,\n                         country == \"Sweden\" ~ y -0.003,\n                         country == \"Norway\" ~ y - 0.002,\n                         TRUE ~ y))\n\n\n\nplot_dat |> \n    ggplot(aes(year, growth,\n               colour = colour,\n               alpha = alpha)) +\n    geom_hline(yintercept = 1, lty = 2, alpha = 0.5) +\n    geom_line(aes(group = country, colour = colour, alpha = alpha, size = alpha)) +\n    geom_text(data = plot_dat |> \n                  filter(country %in% countries,\n                         year == max(year)) |> \n                  mutate(country = icelandic[country]),\n              aes(y = y, label = country),\n              hjust = 0, nudge_x = 0.1, size = 4) +\n    geom_rangeframe(alpha = 1, colour = \"black\") +\n    scale_x_continuous(expand = expansion(),\n                       limits = c(1990, 2018.5),\n                       breaks = c(1990,  1995, 2000, 2005, 2010, 2015, 2018)) +\n    scale_y_log10(breaks = c(range(plot_dat$growth),\n                             1, 0.9, 1.1, 1.2),\n                  labels = function(x) percent(x - 1, accuracy = 1),\n                  limits = c(1/1.4, 1.4)\n    ) +\n    scale_colour_manual(values = c(\"#a50f15\",\n                                   \"#a6bddb\",\n                                   \"#045a8d\",\n                                   \"#e41a1c\", \n                                   \"#fed976\",\n                                   \"grey\")) +\n    scale_alpha_manual(values = c(0.223, 1)) +\n    scale_size_manual(values = c(0.5, 1)) +\n    theme_tufte() +\n    theme(legend.position = \"none\",\n          plot.title = element_text(face = \"bold\")) +\n    coord_cartesian(ylim = c(1/1.11, 1.11),\n                    xlim = c(NA, 2021.5)) +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Þróun hagvaxtar árin 1980 - 2018\")\n\n\n\n\n\n\n\n\n\n\nOrkunotkun\n\nÖll orkaJarðefnaeldsneytiHlutfall orku frá jarðefnaeldsneyti\n\n\n\n\nCode\ncountries <- c(\"Denmark\", \"Finland\",\n               \"Iceland\", \"New Zealand\",\n               \"Norway\", \"Qatar\", \n               \"Sweden\", \"United States\",\n               \"Venezuela\")\nicelandic <- c(\n    \"Denmark\" = \"Danmörk\",\n    \"Finland\" = \"Finnland\",\n    \"Germany\" = \"Þýskaland\", \n    \"Iceland\" = \"Ísland\", \n    \"New Zealand\" = \"Nýja Sjáland\",\n    \"Norway\" = \"Noregur\",\n    \"Qatar\" = \"Katar\",\n    \"Sweden\" = \"Svíþjóð\",\n    \"United States\" = \"Bandaríkin\",\n    \"Venezuela\" = \"Venesúela\")\n\nplot_dat <- d |> \n    select(year, country, energy_per_capita) |> \n    drop_na() |> \n    mutate(alpha = country %in% countries,\n           colour = fct_other(country,\n                              keep = countries,\n                              other_level = \"Other\"),\n           y = energy_per_capita,\n           y = case_when(country == \"Iceland\" ~ y * 0.95,\n                         country == \"Qatar\" ~ y * 1.05,\n                         country == \"Denmark\" ~ y * 1,\n                         country == \"Germany\" ~ y,\n                         country == \"Sweden\" ~ y * 1.03,\n                         country == \"Norway\" ~ y * 1,\n                         TRUE ~ y)) |> \n    filter(year >= 1990, country != \"United States Virgin Islands\") |> \n    group_by(country) |> \n    filter(all(energy_per_capita >= 1e4)) |> \n    ungroup()\n\nplot_dat |> \n    ggplot(aes(year, energy_per_capita,\n               colour = colour,\n               alpha = alpha)) +\n    geom_line(aes(group = country, colour = colour, alpha = alpha, size = alpha)) +\n    geom_text(data = plot_dat |> \n                  filter(country %in% countries,\n                         year == max(year)) |> \n                  mutate(country = icelandic[country]),\n              aes(y = y, label = country),\n              hjust = 0, nudge_x = 0.1, size = 4) +\n    geom_rangeframe(alpha = 1, colour = \"black\") +\n    scale_x_continuous(expand = expansion(),\n                       limits = c(1990, 2023.3),\n                       breaks = c(1990,  1995, 2000, 2005, 2010, 2015, 2020)) +\n    scale_y_log10(breaks = c(3e4, 1e5, range(plot_dat$energy_per_capita)),\n                  # limits = c(1e4, NA),\n                  labels = label_number(suffix = \" kWh\", big.mark = \".\", decimal.mark = \",\")\n    ) +\n    scale_colour_manual(values = c(\"#a50f15\",\n                                   \"#a6bddb\",\n                                   \"#045a8d\",\n                                   \"black\", \n                                   \"#e41a1c\", \n                                   \"#980043\",\n                                   \"#fed976\",\n                                   \"#0868ac\",\n                                   \"#fed976\",\n                                   \"grey\")) +\n    scale_alpha_manual(values = c(0.3, 1)) +\n    scale_size_manual(values = c(0.5, 1)) +\n    theme_tufte() +\n    theme(legend.position = \"none\",\n          plot.title = element_text(face = \"bold\")) +\n    coord_cartesian() +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Þróun orkunotkunar á mann árin 1990 - 2020\")\n\n\n\n\n\n\n\n\n\nCode\ncountries <- c(\"Denmark\", \"Finland\",\n               \"Iceland\", \"New Zealand\",\n               \"Norway\", \"Qatar\", \n               \"Sweden\", \"United States\",\n               \"Venezuela\")\n\nicelandic <- c(\n    \"Denmark\" = \"Danmörk\",\n    \"Finland\" = \"Finnland\",\n    \"Germany\" = \"Þýskaland\", \n    \"Iceland\" = \"Ísland\", \n    \"New Zealand\" = \"Nýja Sjáland\",\n    \"Norway\" = \"Noregur\",\n    \"Qatar\" = \"Katar\",\n    \"Sweden\" = \"Svíþjóð\",\n    \"United States\" = \"Bandaríkin\",\n    \"Venezuela\" = \"Venesúela\")\n\nplot_dat <- d |> \n    select(year, country, fossil_fuel_consumption, population) |> \n    mutate(fossil_per_capita = fossil_fuel_consumption / population) |> \n    drop_na() |> \n    mutate(alpha = country %in% countries,\n           colour = fct_other(country,\n                              keep = countries,\n                              other_level = \"Other\"),\n           y = fossil_per_capita,\n           y = case_when(country == \"Iceland\" ~ y * 0.97,\n                         country == \"Finland\" ~ y * 0.91,\n                         country == \"Qatar\" ~ y * 1.05,\n                         country == \"Denmark\" ~ y * 1.05,\n                         country == \"New Zealand\" ~ y * 1.08,\n                         country == \"Germany\" ~ y,\n                         country == \"Sweden\" ~ y * 0.97,\n                         country == \"Norway\" ~ y * 1.04,\n                         TRUE ~ y)) |> \n    filter(year >= 1990, country != \"United States Virgin Islands\") |> \n    group_by(country) |> \n    filter(all(fossil_per_capita >= 1e4)) |> \n    ungroup()\n\nplot_dat |> \n    ggplot(aes(year, fossil_per_capita,\n               colour = colour,\n               alpha = alpha)) +\n    geom_line(aes(group = country, colour = colour, alpha = alpha, size = alpha)) +\n    geom_text(data = plot_dat |> \n                  filter(country %in% countries,\n                         year == max(year)) |> \n                  mutate(country = icelandic[country]),\n              aes(y = y, label = country),\n              hjust = 0, nudge_x = 0.1, size = 4) +\n    geom_rangeframe(alpha = 1, colour = \"black\") +\n    scale_x_continuous(expand = expansion(),\n                       limits = c(1990, 2023.3),\n                       breaks = c(1990,  1995, 2000, 2005, 2010, 2015, 2020)) +\n    scale_y_log10(breaks = c(3e4, 1e5, range(plot_dat$fossil_per_capita)),\n                  # limits = c(1e4, NA),\n                  labels = label_number(suffix = \" kWh\", big.mark = \".\", decimal.mark = \",\")\n    ) +\n    scale_colour_manual(values = c(\"#a50f15\",\n                                   \"#a6bddb\",\n                                   \"#045a8d\",\n                                   \"black\", \n                                   \"#e41a1c\", \n                                   \"#980043\",\n                                   \"#fed976\",\n                                   \"#0868ac\",\n                                   \"#fed976\",\n                                   \"grey\")) +\n    scale_alpha_manual(values = c(0.3, 1)) +\n    scale_size_manual(values = c(0.5, 1)) +\n    theme_tufte() +\n    theme(legend.position = \"none\",\n          plot.title = element_text(face = \"bold\")) +\n    coord_cartesian() +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Þróun notkunar jarðefnaeldsneytis á mann árin 1990 - 2020\")\n\n\n\n\n\n\n\n\n\nCode\ncountries <- c(\"Denmark\", \"Finland\",\n               \"Iceland\", \"New Zealand\",\n               \"Norway\", \"Qatar\", \n               \"Sweden\", \"United States\",\n               \"Venezuela\")\nicelandic <- c(\n    \"Denmark\" = \"Danmörk\",\n    \"Finland\" = \"Finnland\",\n    \"Germany\" = \"Þýskaland\", \n    \"Iceland\" = \"Ísland\", \n    \"New Zealand\" = \"Nýja Sjáland\",\n    \"Norway\" = \"Noregur\",\n    \"Qatar\" = \"Katar\",\n    \"Sweden\" = \"Svíþjóð\",\n    \"United States\" = \"Bandaríkin\",\n    \"Venezuela\" = \"Venesúela\")\n\nplot_dat <- d |> \n    select(year, country, fossil_share_energy) |> \n    drop_na() |> \n    mutate(fossil_share_energy = fossil_share_energy / 100,\n           alpha = country %in% countries,\n           colour = fct_other(country,\n                              keep = countries,\n                              other_level = \"Other\"),\n           y = fossil_share_energy,\n           y = case_when(country == \"Iceland\" ~ y * 1,\n                         country == \"Finland\" ~ y * 1,\n                         country == \"Qatar\" ~ y * 1,\n                         country == \"Denmark\" ~ y * 1.01,\n                         country == \"New Zealand\" ~ y * 0.99,\n                         country == \"United States\" ~ y * 1.01,\n                         country == \"Venezuela\" ~ y * 0.99,\n                         country == \"Germany\" ~ y,\n                         country == \"Sweden\" ~ y * 1.02,\n                         country == \"Norway\" ~ y * 0.98,\n                         TRUE ~ y)) |> \n    filter(year >= 1990)\n\nplot_dat |> \n    ggplot(aes(year, fossil_share_energy,\n               colour = colour,\n               alpha = alpha)) +\n    geom_line(aes(group = country, colour = colour, alpha = alpha, size = alpha)) +\n    geom_text(data = plot_dat |> \n                  filter(country %in% countries,\n                         year == max(year)) |> \n                  mutate(country = icelandic[country]),\n              aes(y = y, label = country),\n              hjust = 0, nudge_x = 0.1, size = 4) +\n    geom_rangeframe(alpha = 1, colour = \"black\") +\n    scale_x_continuous(expand = expansion(),\n                       limits = c(1990, 2023.5),\n                       breaks = c(1990,  1995, 2000, 2005, 2010, 2015, 2020)) +\n    scale_y_continuous(breaks = c(range(plot_dat$fossil_share_energy),\n                                  seq(0.1, 0.9, by = 0.1)),\n                       # limits = c(1e4, NA),\n                       labels = label_percent()\n    ) +\n    scale_colour_manual(values = c(\"#a50f15\",\n                                   \"#a6bddb\",\n                                   \"#045a8d\",\n                                   \"black\", \n                                   \"#e41a1c\", \n                                   \"#980043\",\n                                   \"#fed976\",\n                                   \"#0868ac\",\n                                   \"#fed976\",\n                                   \"grey\")) +\n    scale_alpha_manual(values = c(0.3, 1)) +\n    scale_size_manual(values = c(0.5, 1)) +\n    theme_tufte() +\n    theme(legend.position = \"none\",\n          plot.title = element_text(face = \"bold\")) +\n    coord_cartesian() +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Hlutfall orku frá jarðefnaeldsneyti árin 1990 - 2020\")\n\n\n\n\n\n\n\n\n\n\nOrka og hagvöxtur\nTil að vernda jörðina viljum við draga úr notkun jarðefnaeldsneytis, en einnig vilja þjóðir heims vaxa efnahagslega.\nVið getum skoðað hvað þjóðir nota margar kílówattstundir (kWh) af jarðefnaeldsneytis eða orku almennt per $ af landsframleiðslu.\nHér sjáum við þróun þessa hlutfalls frá 1990 fyrir alla orku og fyrir jarðefnaeldsneyti, auk þess sem við skoðum hlutfall jarðefnaeldsneytis af allri orkunotkun.\n\nÖll orkaJarðefnaeldsneyti\n\n\n\n\nCode\ncountries <- c(\"Denmark\", \"Finland\",\n               \"Iceland\", \"New Zealand\",\n               \"Norway\", \"Qatar\", \n               \"Sweden\", \"Trinidad and Tobago\",\n               \"United States\", \"Venezuela\")\nicelandic <- c(\n    \"Denmark\" = \"Danmörk\",\n    \"Finland\" = \"Finnland\",\n    \"Germany\" = \"Þýskaland\", \n    \"Iceland\" = \"Ísland\", \n    \"New Zealand\" = \"Nýja Sjáland\",\n    \"Norway\" = \"Noregur\",\n    \"Qatar\" = \"Katar\",\n    \"Sweden\" = \"Svíþjóð\",\n    \"Trinidad and Tobago\" = \"Trínidad og Tóbagó\",\n    \"United States\" = \"Bandaríkin\",\n    \"Venezuela\" = \"Venesúela\")\n\nplot_dat <- d |> \n    select(year, country, energy_per_gdp) |> \n    drop_na() |> \n    mutate(alpha = country %in% countries,\n           colour = fct_other(country,\n                              keep = countries,\n                              other_level = \"Other\"),\n           y = energy_per_gdp,\n           y = case_when(country == \"Iceland\" ~ y * 1,\n                         country == \"Finland\" ~ y * 1.02,\n                         country == \"Qatar\" ~ y * 0.91,\n                         country == \"Denmark\" ~ y * 1.01,\n                         country == \"New Zealand\" ~ y * 1.14,\n                         country == \"United States\" ~ y * 0.94,\n                         country == \"Venezuela\" ~ y * 1,\n                         country == \"Germany\" ~ y,\n                         country == \"Sweden\" ~ y * 0.97,\n                         country == \"Norway\" ~ y * 0.84,\n                         TRUE ~ y)) |> \n    filter(year >= 1980)\n\nplot_dat |> \n    ggplot(aes(year, energy_per_gdp,\n               colour = colour,\n               alpha = alpha)) +\n    geom_line(aes(group = country, colour = colour, alpha = alpha, size = alpha)) +\n    geom_text(data = plot_dat |> \n                  filter(country %in% countries,\n                         year == max(year)) |> \n                  mutate(country = icelandic[country]),\n              aes(y = y, label = country),\n              hjust = 0, nudge_x = 0.1, size = 4) +\n    geom_rangeframe(alpha = 1, colour = \"black\") +\n    scale_x_continuous(expand = expansion(),\n                       limits = c(1980, 2025),\n                       breaks = c(1980, 1985, 1990,  1995, 2000, 2005, 2010, 2015, 2018)) +\n    scale_y_continuous(breaks = c(range(plot_dat$energy_per_gdp), 1, 2, 3, 4, 5),\n                       # limits = c(1e4, NA),\n                       labels = label_number(suffix = \" kWh\", big.mark = \".\", decimal.mark = \",\",\n                                             accuracy = 0.1)\n    ) +\n    scale_colour_manual(values = c(\"#a50f15\",\n                                   \"#a6bddb\",\n                                   \"#045a8d\",\n                                   \"black\", \n                                   \"#e41a1c\", \n                                   \"#980043\",\n                                   \"#fed976\",\n                                   \"#67000d\",\n                                   \"#0868ac\",\n                                   \"#fed976\",\n                                   \"grey\")) +\n    scale_alpha_manual(values = c(0.3, 1)) +\n    scale_size_manual(values = c(0.5, 1)) +\n    theme_tufte() +\n    theme(legend.position = \"none\",\n          plot.title = element_text(face = \"bold\")) +\n    coord_cartesian(ylim = c(0, 6),\n                    xlim = c(1980, 2024.5),\n                    expand = T) +\n    labs(x = NULL,\n         y = \"Orkunotkun (kWh) deilt með landsframleiðslu ($)\",\n         title = \"Þróun orkunotkunar (kWh) per $ af landsframleiðslu árin 1980 - 2018\")\n\n\n\n\n\n\n\n\n\nCode\ncountries <- c(\"Denmark\", \"Finland\",\n               \"Germany\", \"Iceland\", \"India\", \"New Zealand\", \"Norway\", \"Sweden\")\nicelandic <- c(\n    \"Denmark\" = \"Danmörk\",\n    \"Finland\" = \"Finnland\",\n    \"Germany\" = \"Þýskaland\", \n    \"Iceland\" = \"Ísland\", \n    \"India\" = \"Indland\", \n    \"New Zealand\" = \"Nýja Sjáland\",\n    \"Norway\" = \"Noregur\",\n    \"Sweden\" = \"Svíþjóð\")\n\n\nplot_dat <- d |> \n    select(year, country, fossil_fuel_consumption, gdp) |> \n    drop_na() |> \n    mutate(fossil_per_gdp = fossil_fuel_consumption / gdp) |> \n    filter(year >= 1980) |> \n    mutate(alpha = country %in% countries,\n           colour = fct_other(country,\n                              keep = countries,\n                              other_level = \"Other\"),\n           y = fossil_per_gdp,\n           y = case_when(country == \"Iceland\" ~ y + 0,\n                         country == \"New Zealand\" ~ y - 0.05,\n                         country == \"India\" ~ y + 0.05,\n                         country == \"Finland\" ~ y - 0.02,\n                         country == \"Sweden\" ~ y + 0.02,\n                         country == \"Norway\" ~ y - 0.02,\n                         TRUE ~ y))\n\np <- plot_dat |> \n    ggplot(aes(year, fossil_per_gdp,\n               colour = colour,\n               alpha = alpha)) +\n    geom_line(aes(group = country, size = alpha)) +\n    geom_text(data = plot_dat |> \n                  filter(country %in% countries,\n                         year == max(year)) |> \n                  mutate(country = icelandic[country]),\n              aes(y = y, label = country),\n              hjust = 0, nudge_x = 0.1, size = 4) +\n    geom_rangeframe(colour = \"black\", alpha = 1) +\n    scale_x_continuous(expand = expansion(),\n                       limits = c(1980, 2018.5),\n                       breaks = c(1980, 1985, 1990, 1995, 2000, 2005, 2010, 2015, 2018)) +\n    scale_y_continuous() +\n    scale_colour_manual(values = c(\"#a50f15\",\n                                   \"#a6bddb\",\n                                   \"#ff7f00\", \n                                   \"#045a8d\",\n                                   \"#4daf4a\",\n                                   \"black\", \n                                   \"#e41a1c\", \n                                   \"#fed976\",\n                                   \"grey\")) +\n    scale_alpha_manual(values = c(0.3, 1)) +\n    scale_size_manual(values = c(0.5, 1)) +\n    theme_tufte() +\n    theme(legend.position = \"none\",\n          plot.title = element_text(face = \"bold\")) +\n    coord_cartesian(ylim = c(0, 2),\n                    xlim = c(1980, 2022.3),\n                    expand = F) +\n    labs(x = NULL,\n         y = \"Notkun jarðefnaeldsneytis (kWh) deilt með landsframleiðslu ($)\",\n         title = \"Þróun jarðefnaeldsneytis (kWh) per $ af landsframleiðslu árin 1980 - 2018\")\n\nggsave(plot = p, filename = \"throun_fossil.png\",\n       width = 8, height = 0.621 * 8, scale = 1.5, bg = \"white\")\n\np\n\n\n\n\n\n\n\n\n\n\nLöndum raðað eftir hlutfalli jarðefnaeldsneytis og landsframleiðslu\nVið sáum að á Íslandi hækkaði þessi tala frá 2010 til 2018, nánar tiltekið um 14%, þ.a. dollari af landsframleiðslu kostaði 14% meira jarðefnaeldsneyti árið 2018 (0.94 kWh) en 2010 (0.83 kWh).\n\n20102018Breyting 2010 - 2018\n\n\n\n\nCode\np <- d |> \n    filter(year == 2010) |> \n    select(country, fossil_fuel_consumption, gdp) |> \n    drop_na() |> \n    mutate(fossil_per_gdp = fossil_fuel_consumption / gdp,\n           country = fct_reorder(country, fossil_per_gdp)) |> \n    ggplot(aes(fossil_per_gdp, country,\n               fill = country == \"Iceland\")) +\n    geom_col() +\n    scale_fill_manual(values = c(\"#969696\", \"#4292c6\")) +\n    theme_half_open() +\n    theme(legend.position = \"none\") +\n    coord_cartesian(expand = FALSE) +\n    labs(x = \"Notkun jarðefnaeldsneytis (kWh) deilt með landsframleiðslu ($)\",\n         y = NULL,\n         title = \"Röðun landa eftir jarðefnaeldsneyti (kWh) per $ af landsframleiðslu árið 2010\",\n         subtitle = \"Árið 2010 kostaði 1$ af landsframleiðslu 0.82 kWh af jarðefnaeldsneyti\")\n\n\np\n\n\n\n\n\n\n\n\n\nCode\np <- d |> \n    filter(year == 2018) |> \n    select(country, fossil_fuel_consumption, gdp) |> \n    drop_na() |> \n    mutate(fossil_per_gdp = fossil_fuel_consumption / gdp,\n           country = fct_reorder(country, fossil_per_gdp)) |> \n    ggplot(aes(fossil_per_gdp, country,\n               fill = country == \"Iceland\")) +\n    geom_col() +\n    scale_fill_manual(values = c(\"#969696\", \"#4292c6\")) +\n    theme_half_open() +\n    theme(legend.position = \"none\") +\n    coord_cartesian(expand = FALSE) +\n    labs(x = \"Notkun jarðefnaeldsneytis (kWh) deilt með landsframleiðslu ($)\",\n         y = NULL,\n         title = \"Röðun landa eftir jarðefnaeldsneyti (kWh) per $ af landsframleiðslu árið 2018\",\n         subtitle = \"Árið 2018 kostaði1$ af landsframleiðslu 0.94 kWh af jarðefnaeldsneyti\")\n\nggsave(plot = p, filename = \"ordered_fossil.png\",\n       width = 8, height = 8, scale = 1.7, bg = \"white\")\n\np\n\n\n\n\n\n\n\n\n\nCode\np <- d |> \n    filter(year %in% c(2010, 2018)) |> \n    select(year, country, fossil_fuel_consumption, gdp) |> \n    drop_na() |> \n    mutate(fossil_per_gdp = fossil_fuel_consumption / gdp,\n           country = fct_reorder(country, fossil_per_gdp),\n           year = ifelse(year == max(year), \"eftir\", \"fyrir\")) |> \n    select(year, country, fossil_per_gdp) |> \n    pivot_wider(names_from = year, values_from = fossil_per_gdp) |> \n    mutate(breyting = eftir / fyrir - 1) |> \n    mutate(country = fct_reorder(country, breyting)) |> \n    ggplot(aes(breyting, country,\n               fill = country == \"Iceland\")) +\n    geom_col() +\n    scale_x_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(\"#969696\", \"#4292c6\")) +\n    theme_half_open() +\n    theme(legend.position = \"none\") +\n    coord_cartesian(expand = FALSE) +\n    labs(x = \"Notkun jarðefnaeldsneytis (kWh) deilt með landsframleiðslu ($) (% breyting frá 2010 til 2018)\",\n         y = NULL,\n         title = \"Breyting í notkun jarðefnaeldsneytis (kWh) per $ af landsframleiðslu frá 2010 til 2018\",\n         subtitle = \"Árið 2018 kostaði dollari af landsframleiðslu á Íslandi 14% meira jarðefnaeldsneyti en 2010\")\n\np\n\n\n\n\n\n\n\n\n\n\nTengsl orkunotkunar, útblásturs og landsframleiðslu\nLítum á þessi tengsl með þremur myndböndum:\n\nTengsl orkunotkunar almennt og landsframleiðslu\nTengsl notkunar jarðefnaeldsneytis og landsframleiðslu\nTengsl útblásturs gróðurhúsalofttegundar við framleiðslurafnmagns og landsframleiðslu\n\nHeilar línur eru viðmið fyrir hlutföllin sem við reiknuðum að ofan. Við viljum sjá punktana færast upp (efnahagsvöxtur) og til vinstri (draga úr jarðefnaeldsneyti/útblæstri). Punktar sem eru nær norðvestur horni myndarinnar gætu kallast “skilvirkari”, þ.e. dollari af landsframleiðslu kostar minni orku/jarðefnaeldsneyti/útblástur.\n\nOrka og landsframleiðslaJarðefnaeldsneyti og framleiðslaGróðurhúsalofttegundir og framleiðsla\n\n\n\n\nCode\nstart <- d |> filter(year >= 1980, energy_per_capita > 0) |> pull(energy_per_capita) |> min(na.rm = T)\nend <- d |> filter(year >= 1980, energy_per_capita > 0) |> pull(energy_per_capita) |> max(na.rm = T)\n\nmin_gdp <- d |> filter(year >= 1980) |> pull(gdp_per_capita) |> min(na.rm = T)\nmax_gdp <- d |> filter(year >= 1980) |> pull(gdp_per_capita) |> max(na.rm = T)\n\nplot_dat <- crossing(energy_per_capita = seq(log(start), log(end), length = 100) |> exp(),\n                     ratio = c(0.25, 0.5, 1, 2, 4)) |> \n    mutate(gdp_per_capita = ratio * energy_per_capita) |> \n    filter(gdp_per_capita < max_gdp * 1.1,\n           gdp_per_capita > min_gdp)\n\nadd_preds <- function(data, ...) {\n    m <- lm(log(gdp_per_capita) ~ log(energy_per_capita), data = data)\n    data$pred <- exp(predict(m))\n    \n    data\n}\n\n\np <- d |> \n    select(gdp_per_capita, energy_per_capita, country, year) |> \n    drop_na() |> \n    filter(year >= 1980, country != \"World\") |> \n    group_by(country) |>\n    ungroup() |> \n    group_by(year) |> \n    group_modify(add_preds) |> \n    ungroup() |> \n    ggplot(aes(energy_per_capita, gdp_per_capita,\n               colour = (country == \"Iceland\"),\n               size = (country == \"Iceland\"),\n               alpha = (country == \"Iceland\"))) +\n    geom_line(\n        data = plot_dat,\n        aes(energy_per_capita, gdp_per_capita, group = ratio),\n        inherit.aes = FALSE\n    ) +\n    geom_text(data = plot_dat |> \n                  group_by(ratio) |> \n                  filter(energy_per_capita == max(energy_per_capita)) |> \n                  ungroup(),\n              aes(x = energy_per_capita,\n                  y = gdp_per_capita,\n                  label = 1 / ratio),\n              inherit.aes = FALSE, hjust = 0, vjust = 0, \n              nudge_x = 0.03,\n              nudge_y = 0.03) +\n    geom_line(aes(y = pred), lty = 2, col = \"black\", size = 1) +\n    geom_point(aes(group = country)) +\n    # geom_rangeframe() +\n    scale_x_log10(labels = label_number(suffix = \" kWh\", big.mark = \".\", decimal.mark = \",\")) +\n    scale_y_log10(labels = label_number(suffix = \"$\", big.mark = \".\", decimal.mark = \",\")) +\n    scale_colour_manual(values = c(\"#969696\", \"#4292c6\")) +\n    scale_size_manual(values = c(2.5, 4)) +\n    scale_alpha_manual(values = c(0.7, 1)) +\n    theme_half_open(font_size = 12) +\n    theme(legend.position = \"none\",\n          plot.title = element_markdown(face = \"plain\")) +\n    labs(x = \"Orkuframleiðsla á mann\",\n         y = \"Landsframleiðsla á mann\",\n         title = \"Þróun orku- og landsframleiðslu á <b style='color:#4292c6'>Íslandi</b> samanborið við <b style='color:#969696'>heiminn</b>\",\n         subtitle = str_c(\"Heilar línur sýna mismunandi hlutföll orku- / landsframleiðslu\",\n                          \"\\n\",\n                          \"Brotin lína sýnir fylgni stærðanna á heimsvísu\",\n                          \"\\n\",\n                          \"Ár: {frame_time}\")) +\n    transition_time(as.integer(year)) +\n    ease_aes(\"cubic-in-out\")\n\np_vid <- animate(p, width = 12, height = 0.5 * 12, unit = \"in\", res = 150, fps = 25, duration = 15,\n                 renderer = ffmpeg_renderer(format = \"mp4\"))\n\np_vid\n\n\n\n\n\n\n\n\n\nCode\nstart <- d |> \n    filter(year >= 1990, fossil_energy_per_capita > 0) |> \n    pull(fossil_energy_per_capita) |>\n    min(na.rm = T)\nend <- d |>\n    filter(year >= 1990, fossil_energy_per_capita > 0) |> \n    pull(fossil_energy_per_capita) |> \n    max(na.rm = T)\n\nmin_gdp <- d |> \n    filter(year >= 1990) |> \n    pull(gdp_per_capita) |> \n    min(na.rm = T)\nmax_gdp <- d |> \n    filter(year >= 1990) |> \n    pull(gdp_per_capita) |>\n    max(na.rm = T)\n\nplot_dat <- crossing(fossil_energy_per_capita = seq(log(start),\n                                                    log(end), \n                                                    length = 500) |> exp(),\n                     ratio = c(1/4, 1/2, 1, 2, 4)) |> \n    mutate(gdp_per_capita = ratio * fossil_energy_per_capita) |> \n    filter(gdp_per_capita <= max_gdp * 1.1,\n           gdp_per_capita >= min_gdp)\n\nadd_preds <- function(data, ...) {\n    m <- lm(log(gdp_per_capita) ~ log(fossil_energy_per_capita), data = data)\n    data$pred <- exp(predict(m))\n    \n    data\n}\n\n\np <- d |> \n    select(gdp_per_capita, fossil_energy_per_capita, country, year) |> \n    drop_na() |> \n    filter(year >= 1980, country != \"World\") |> \n    group_by(country) |>\n    filter(gdp_per_capita > 0, \n           fossil_energy_per_capita > 0) |> \n    ungroup() |>\n    group_by(year) |> \n    group_modify(add_preds) |> \n    ungroup() |> \n    ggplot(aes(fossil_energy_per_capita, gdp_per_capita,\n               colour = (country == \"Iceland\"),\n               size = (country == \"Iceland\"),\n               alpha = (country == \"Iceland\"))) +\n    geom_line(\n        data = plot_dat,\n        aes(fossil_energy_per_capita, gdp_per_capita, group = ratio),\n        inherit.aes = FALSE\n    ) +\n    geom_text(data = plot_dat |> \n                  group_by(ratio) |> \n                  filter(fossil_energy_per_capita == max(fossil_energy_per_capita)) |> \n                  ungroup(),\n              aes(x = fossil_energy_per_capita,\n                  y = gdp_per_capita,\n                  label = 1 / ratio),\n              inherit.aes = FALSE, hjust = 0, vjust = 0, \n              nudge_x = 0.03,\n              nudge_y = 0.03) +\n    geom_line(aes(y = pred), lty = 2, col = \"black\", size = 1) +\n    geom_point(aes(group = country)) +\n    # geom_rangeframe() +\n    scale_x_log10(labels = label_number(suffix = \" kWh\", big.mark = \".\", decimal.mark = \",\")) +\n    scale_y_log10(labels = label_number(suffix = \"$\", big.mark = \".\", decimal.mark = \",\")) +\n    scale_colour_manual(values = c(\"#969696\", \"#4292c6\")) +\n    scale_size_manual(values = c(2.5, 4)) +\n    scale_alpha_manual(values = c(0.7, 1)) +\n    theme_half_open(font_size = 12) +\n    theme(legend.position = \"none\",\n          plot.title = element_markdown(face = \"plain\")) +\n    labs(x = \"Jarðefnaeldsneytisnotkun á mann\",\n         y = \"Landsframleiðsla á mann\",\n         title = \"Þróun notkunar jarðefnaeldsneytis og landsframleiðslu á <b style='color:#4292c6'>Íslandi</b> samanborið við <b style='color:#969696'>heiminn</b>\",\n         subtitle = str_c(\"Heilar línur sýna mismunandi hlutföll jarðefnaeldsneytis / landsframleiðslu\",\n                          \"\\n\",\n                          \"Brotin lína sýnir fylgni stærðanna á heimsvísu\",\n                          \"\\n\",\n                          \"Ár: {frame_time}\")) +\n    transition_time(as.integer(year)) +\n    ease_aes(\"cubic-in-out\")\n\np_vid <- animate(p, width = 12, height = 0.5 * 12, unit = \"in\", res = 150, fps = 25,\n                 duration = 15,\n                 renderer = ffmpeg_renderer(format = \"mp4\"))\n\np_vid\n\n\n\n\n\n\n\n\n\nCode\nstart <- d |> \n    filter(year >= 2000, greenhouse_per_capita > 0) |> \n    pull(greenhouse_per_capita) |>\n    min(na.rm = T)\nend <- d |>\n    filter(year >= 2000, greenhouse_per_capita > 0) |> \n    pull(greenhouse_per_capita) |> \n    max(na.rm = T)\n\nmin_gdp <- d |> \n    filter(year >= 2000) |> \n    pull(gdp_per_capita) |> \n    min(na.rm = T)\nmax_gdp <- d |> \n    filter(year >= 2000) |> \n    pull(gdp_per_capita) |>\n    max(na.rm = T)\n\nplot_dat <- crossing(greenhouse_per_capita = seq(log(start),\n                                                 log(end), \n                                                 length = 500) |> exp(),\n                     ratio = c(1/16, 1/8, 1/4, 1/2, 1, 2, 4)) |> \n    mutate(gdp_per_capita = ratio * greenhouse_per_capita) |> \n    filter(gdp_per_capita <= max_gdp * 1.1,\n           gdp_per_capita >= min_gdp)\n\nadd_preds <- function(data, ...) {\n    m <- lm(log(gdp_per_capita) ~ log(greenhouse_per_capita), data = data)\n    data$pred <- exp(predict(m))\n    \n    data\n}\n\n\np <- d |> \n    select(gdp_per_capita, greenhouse_per_capita, country, year) |> \n    drop_na() |> \n    filter(year >= 2000, country != \"World\") |> \n    group_by(country) |>\n    filter(greenhouse_per_capita > 0, gdp_per_capita > 0) |>\n    ungroup() |> \n    group_by(year) |> \n    group_modify(add_preds) |> \n    ungroup() |> \n    ggplot(aes(greenhouse_per_capita, gdp_per_capita,\n               colour = (country == \"Iceland\"),\n               size = (country == \"Iceland\"),\n               alpha = (country == \"Iceland\"))) +\n    geom_line(\n        data = plot_dat,\n        aes(greenhouse_per_capita, gdp_per_capita, group = ratio),\n        inherit.aes = FALSE\n    ) +\n    geom_text(data = plot_dat |> \n                  group_by(ratio) |> \n                  filter(greenhouse_per_capita == max(greenhouse_per_capita)) |> \n                  ungroup(),\n              aes(x = greenhouse_per_capita,\n                  y = gdp_per_capita,\n                  label = 1 / ratio),\n              inherit.aes = FALSE, hjust = 0, vjust = 0, \n              nudge_x = 0.03,\n              nudge_y = 0.03) +\n    geom_line(aes(y = pred), lty = 2, col = \"black\", size = 1) +\n    geom_point(aes(group = country)) +\n    # geom_rangeframe() +\n    scale_x_log10(labels = label_number(big.mark = \".\", decimal.mark = \",\")) +\n    scale_y_log10(labels = label_number(suffix = \"$\", big.mark = \".\", decimal.mark = \",\")) +\n    scale_colour_manual(values = c(\"#969696\", \"#4292c6\")) +\n    scale_size_manual(values = c(2.5, 4)) +\n    scale_alpha_manual(values = c(0.7, 1)) +\n    theme_half_open(font_size = 12) +\n    theme(legend.position = \"none\",\n          plot.title = element_markdown(face = \"plain\")) +\n    labs(x = \"Útblástur gróðurhúsalofttegunda (tonn á 100.000 íbúa) við framleiðslu rafmagns\",\n         y = \"Landsframleiðsla á mann\",\n         title = \"Þróun útblásturs gróðurhúsalofttegunda og landsframleiðslu á <b style='color:#4292c6'>Íslandi</b> samanborið við <b style='color:#969696'>heiminn</b>\",\n         subtitle = str_c(\"Heilar línur sýna mismunandi hlutföll gróðushúsalofttegunda / landsframleiðslu\",\n                          \"\\n\",\n                          \"Brotin lína sýnir fylgni stærðanna á heimsvísu\",\n                          \"\\n\",\n                          \"Ár: {frame_time}\")) +\n    transition_time(as.integer(year)) +\n    ease_aes(\"cubic-in-out\")\n\np_vid <- animate(p, width = 12, height = 0.5 * 12, unit = \"in\", res = 150, \n                 fps = 25, duration = 10,\n                 renderer = ffmpeg_renderer(format = \"mp4\"))\n\np_vid"
  },
  {
    "objectID": "posts/vinnuafl/index.html",
    "href": "posts/vinnuafl/index.html",
    "title": "Vinnumarkaður",
    "section": "",
    "text": "Fjöldi starfandi\n\nAlmennur vinnumarkaðurOpinber vinnumarkaðurSaman\n\n\n\n\nCode\nplot_dat <-  d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |>  \n    filter(year(dags) >= 2008)\n\np <- plot_dat |> \n    ggplot(aes(dags, Annad)) +  \n    geom_line() +  \n    geom_rangeframe() +  \n    scale_y_continuous(breaks = c(range(plot_dat$Annad), 1.2e5, 1.3e5, 1.4e5),\n                       limits = c(1e5, 1.5e5),\n                       labels = label_number()) +\n    scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\",   \n                 expand = expansion()) +  \n    labs(x = NULL,\n         y = NULL,\n         title = \"Fjöldi starfandi á almennum vinnumarkaði\") +\n    theme_tufte() +  \n    theme(plot.margin = margin(t = 5, r = 20, b = 5, l = 5),\n          plot.title = element_text(face = \"bold\"))\n\np\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <-  d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n)\n\np <- plot_dat |> \n    ggplot(aes(dags, Opinbert)) +  \n    geom_line() +  \n    geom_rangeframe() +  \n    scale_y_continuous(breaks = c(range(plot_dat$Opinbert), 5e4, 5.5e4, 6e4, 6.5e4),\n                       labels = label_number()) +\n    scale_x_date(date_breaks = \"year\", date_labels = \"%Y\", \n                 expand = expansion()) +  \n    labs(x = NULL,\n         y = NULL,\n         title = \"Fjöldi opinbers starfsfólks\") +\n    theme_tufte() +  \n    theme(plot.margin = margin(t = 5, r = 20, b = 5, l = 5),\n          plot.title = element_text(face = \"bold\"))\n\np\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <-  d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    mutate(tegund = fct_recode(as_factor(tegund),\n                               \"Opinber\" = \"Opinbert\",\n                               \"Almennur\" = \"Annad\"))\n\np <- plot_dat |> \n    ggplot(aes(dags, n)) +  \n    geom_line(aes(col = tegund)) +\n    geom_text(data = plot_dat |> filter(dags == max(dags)),\n              aes(label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    geom_rangeframe() +  \n    scale_y_continuous(breaks = c(range(plot_dat$n[plot_dat$tegund == \"Opinber\"]), \n                                  range(plot_dat$n[plot_dat$tegund == \"Almennur\"]), 0),\n                       labels = label_number(),\n                       limits = c(0, 1.5e5),\n                       expand = expansion()) +\n    scale_x_date(date_breaks = \"year\", date_labels = \"%Y\",  \n                 expand = expansion(add = 31),\n                 limits = c(min(plot_dat$dags), max(plot_dat$dags) + 15)) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Fjöldi starfandi á almennum og opinberum vinnumarkaði\") +\n    coord_cartesian(clip = \"off\") +\n    theme_tufte() +  \n    theme(plot.margin = margin(t = 5, r = 60, b = 5, l = 5),\n          legend.position = \"none\",\n          plot.title = element_text(face = \"bold\"))\n\np\n\n\n\n\n\n\n\n\n\n\nFjöldi miðað við fyrri ár\n\nAlmennurHlutfall Opinbert\n\n\n\n20172019\n\n\n\n\nCode\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |>  \n    filter(year(dags) >= 2017) |>  \n    mutate(manudur = month(dags)) |>  \n    group_by(manudur) |>  \n    mutate(breyting = Annad - Annad[year(dags) == min(year(dags))]) |> \n    ungroup()\n\np <- plot_dat |> \n    ggplot(aes(dags, breyting)) +  \n    geom_vline(xintercept = ymd(c(\"2018-01-01\", \"2019-01-01\", \"2020-01-01\", \"2021-01-01\", \"2022-01-01\")), lty = 2, alpha = 0.3) +\n    geom_hline(yintercept = 0, lty = 2) +  \n    geom_line() +  \n    geom_rangeframe() +  \n    scale_y_continuous(breaks = c(range(plot_dat$breyting), -1e4, -5e3, 0, 5e3),\n                       labels = label_number(),\n                       limits = c(-1.8e4, 1e4)) +  \n    scale_x_date(date_breaks = \"3 months\", date_labels = \"%b/%y\",  \n                 guide = guide_axis(n.dodge = 2),  \n                 expand = expansion()) +  \n    labs(x = NULL, y = NULL,  \n         title = \"Fjöldi starfandi á almennum vinnumarkaði miðað við sama mánuð 2017\",\n         subtitle = \"Janúar 2022 er fyrsti mánuður þar sem fleiri unnu á almennum markaði en sama mánuð 2017\") +  \n    theme_tufte() +  \n    theme(plot.margin = margin(t = 5, r = 20, b = 5, l = 5),\n          plot.title = element_text(face = \"bold\"))\n\np\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |>  \n    filter(year(dags) >= 2019) |>  \n    mutate(manudur = month(dags)) |>  \n    group_by(manudur) |>  \n    mutate(breyting = Annad - Annad[year(dags) == min(year(dags))]) |> \n    ungroup()\n\np <- plot_dat |> \n    ggplot(aes(dags, breyting)) +  \n    geom_vline(xintercept = ymd(c(\"2020-01-01\", \"2021-01-01\", \"2022-01-01\")), lty = 1, alpha = 0.1) +\n    geom_hline(yintercept = 0, lty = 2) +  \n    geom_line() +  \n    geom_rangeframe() +  \n    scale_y_continuous(breaks = c(range(plot_dat$breyting), -1.5e4, -1e4, -5e3, 0, 5e3),\n                       labels = label_number(big.mark = \".\", decimal.mark = \",\"),\n                       limits = c(-1.8e4, 2e3)) +  \n    scale_x_date(date_breaks = \"3 months\", date_labels = \"%b/%y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion()) +  \n    labs(x = NULL, y = NULL,  \n         title = \"Fjöldi starfandi á almennum vinnumarkaði miðað við sama mánuð 2019\",\n         subtitle = \"Mars 2022 er annar mánuður frá 2020 þar sem fleiri unnu á almennum markaði en sama mánuð 2019\") +  \n    theme_tufte() +  \n    theme(plot.margin = margin(t = 5, r = 20, b = 5, l = 5),\n          plot.title = element_text(face = \"bold\"))\n\np\n\n\n\n\n\n\n\n\n\n\n\n20172019\n\n\n\n\nCode\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |>  \n    filter(year(dags) >= 2017) |>  \n    mutate(manudur = month(dags),\n           hlutf = Opinbert / (Annad + Opinbert)) |> \n    ungroup() |> \n    group_by(manudur) |>  \n    mutate(breyting = hlutf - hlutf[year(dags) == min(year(dags))]) |> \n    ungroup()\n\np <- plot_dat |> \n    ggplot(aes(dags, breyting)) +  \n    geom_vline(xintercept = ymd(c(\"2018-01-01\", \"2019-01-01\", \"2020-01-01\", \"2021-01-01\", \"2022-01-01\")), lty = 2, alpha = 0.3) +\n    geom_line() +  \n    geom_rangeframe() +  \n    scale_y_continuous(breaks = c(range(plot_dat$breyting), 0.05, 0.04, 0.03, 0.02, 0.01),\n                       labels = label_percent(accuracy = 0.1)) +  \n    scale_x_date(date_breaks = \"3 months\", date_labels = \"%b\\n%y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion()) +  \n    labs(x = NULL, y = NULL,  \n         title = \"Munur á hlutfalli opinbers starfsfólks frá sama mánuði 2017\") +  \n    theme_tufte() +  \n    theme(plot.margin = margin(t = 5, r = 20, b = 5, l = 5),\n          plot.title = element_text(face = \"bold\"))\n\np\n\n\n\n\n\n\n\n\n\nCode\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |>  \n    filter(year(dags) >= 2019) |>  \n    mutate(manudur = month(dags),\n           hlutf = Opinbert / (Annad + Opinbert)) |> \n    ungroup() |> \n    group_by(manudur) |>  \n    mutate(breyting = hlutf - hlutf[year(dags) == min(year(dags))]) |> \n    ungroup()\n\np <- plot_dat |> \n    ggplot(aes(dags, breyting)) +  \n    geom_vline(xintercept = ymd(c(\"2020-01-01\", \"2021-01-01\", \"2022-01-01\")), lty = 2, alpha = 0.3) +\n    geom_line() +  \n    geom_rangeframe() +  \n    scale_y_continuous(breaks = c(range(plot_dat$breyting), 0.05, 0.04, 0.03, 0.02, 0.01),\n                       labels = label_percent(accuracy = 0.1)) +  \n    scale_x_date(date_breaks = \"3 months\", date_labels = \"%b\\n%y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion()) +  \n    labs(x = NULL, y = NULL,  \n         title = \"Munur á hlutfalli opinbers starfsfólks frá sama mánuði 2019\") +  \n    theme_tufte() +  \n    theme(plot.margin = margin(t = 5, r = 20, b = 5, l = 5),\n          plot.title = element_text(face = \"bold\"))\n\np\n\n\n\n\n\n\n\n\n\n\n\n\n\nÁrstíðaleiðrétt hlutfall opinbers starfsfólks\n\nMyndAðferð\n\n\n\n\nCode\nmodel_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |>  \n    mutate(Heild = Opinbert + Annad) |> \n    filter(year(dags) >= 2008) |>  \n    mutate(manudur = month(dags),\n           timi = as.numeric(as.factor(dags)),\n           hlutf = Opinbert / (Annad + Opinbert)) |> \n    ungroup()\n\nm <- gam(Opinbert ~ s(manudur, bs = \"cc\") + s(timi, bs = \"ad\"), \n         data = model_dat, offset = log(Heild), family = nb(), method = \"REML\")\n\nplot_dat <- emmeans(m, ~ timi + manudur, at = list(timi = model_dat$timi,\n                                                   manudur = 1:12)) |> \n    tidy(type = \"response\") |> \n    group_by(timi) |> \n    mutate(wt = 1 / std.error,\n           wt = wt / sum(wt)) |> \n    summarise(response = sum(response * wt)) |> \n    inner_join(\n        model_dat,\n        by = \"timi\"\n    )\n\n\nopinbert_dat <- gam(Opinbert ~ s(manudur, bs = \"cc\") + s(timi, bs = \"ad\"), data = model_dat,\n    family = nb(), method = \"REML\") |> \n    emmeans(~ timi, at = list(timi = unique(model_dat$timi))) |> \n    tidy() |> \n    inner_join(\n        model_dat |> \n            distinct(timi, dags)\n    ) |> \n    mutate(change = c(0, diff(estimate)),\n           perc_change = exp(change))\n\n\nalm_dat <- gam(Annad ~ s(manudur, bs = \"cc\") + s(timi, bs = \"ad\"), data = model_dat,\n                 family = nb(), method = \"REML\") |> \n    emmeans(~ timi, at = list(timi = unique(model_dat$timi))) |> \n    tidy() |> \n    inner_join(\n        model_dat |> \n            distinct(timi, dags)\n    ) |> \n    mutate(change = c(0, diff(estimate)),\n           perc_change = exp(change))\n\n\nheild_dat <- gam(Heild ~ s(manudur, bs = \"cc\") + s(timi, bs = \"ad\"), data = model_dat,\n                    family = nb(), method = \"REML\") |> \n    emmeans(~ timi, at = list(timi = unique(model_dat$timi))) |> \n    tidy() |> \n    inner_join(\n        model_dat |> \n            distinct(timi, dags)\n    ) |> \n    mutate(change = c(0, diff(estimate)),\n           perc_change = exp(change))\n\nplot_dat2 <- heild_dat |> \n    mutate(tegund = \"Heild\") |> \n    bind_rows(\n        opinbert_dat |> \n            mutate(tegund = \"Opinber\")\n    )\n\n\ndates <- c(\"2009-08-01\", \"2018-01-01\", \"2021-01-01\")\n\np1 <- plot_dat |> \n    ggplot(aes(dags, hlutf)) +  \n    geom_vline(xintercept = ymd(dates), lty = 2, alpha = 0.5) +\n    geom_line(aes(y = hlutf), alpha = 0.1) +\n    geom_line(aes(y = response)) +  \n    geom_rangeframe(col = \"black\", size  = 1) +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2022-04-01\"))) +\n    scale_y_continuous(breaks = c(range(plot_dat$hlutf),\n                                  0.3, 0.325),\n                       labels = label_percent(accuracy = 0.01),\n                       limits = c(0.25, 0.37)) +  \n    labs(x = NULL, y = NULL,  \n         title = \"Hlutfall opinbers starfsfólks af vinnumarkaði (2008 - 2022)\",\n         subtitle = \"Leiðrétt fyrir mánaðarlegum sveiflum. Raungögn teiknuð í gráu\") +  \n    theme_tufte() +  \n    theme(plot.margin = margin(t = 5, r = 60, b = 5, l = 5),\n          plot.title = element_text(face = \"bold\"))\n\np2 <- plot_dat2 |> \n    ggplot(aes(dags, perc_change)) +\n    geom_vline(xintercept = ymd(dates), lty = 2, alpha = 0.5) +\n    geom_hline(yintercept = 1, lty = 2) +\n    geom_line(aes(col = tegund)) +\n    geom_text(data = plot_dat2 |> filter(dags == max(dags)),\n              aes(label = tegund, col = tegund),\n              hjust = 0, nudge_x = 20) +\n    geom_rangeframe() +\n    scale_x_date(date_breaks = \"year\", date_labels = \"%Y\", \n                 expand = expansion()) +\n    scale_y_log10(labels = function(x) percent(x - 1),\n                  breaks = c(1, range(plot_dat2$perc_change), 1.005, 0.995)) +\n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    coord_cartesian(clip = \"off\") +\n    theme_tufte() +\n    theme(plot.margin = margin(t = 5, r = 60, b = 5, l = 5),\n          legend.position = \"none\",\n          plot.title = element_text(face = \"bold\")) +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Mánaðarleg hlutfallsleg breyting fjölda starfsfólks (2008 - 2022)\",\n         subtitle = \"Er hækkun/lækkun hlutfalls að ofan vegna breytinga á opinberum eða almennum vinnumarkaði?\\nÞegar blá lína er ofar en sú rauða hækkar hlutfallið, og þegar hún er neðar lækkar hlutfallið\")\n\n\np <- plot_grid(p1, p2, ncol = 1)\n\np\n\n\n\n\n\nCode\nggsave(plot = p, filename = \"hlutf_opinbert.png\",\n       width = 8, height = 1 * 8, scale = 1.3, bg = \"white\")\n\n\n\n\n\nLeiðrétting fyrir árstíðarsveiflumTeljarinn og nefnarinn\n\n\nVið getum hugsað að þetta séu tvö ferli:\n\nLangtímaferli sem breytist án mjög ákveðins mynsturs\nÁrstíðabundnar sveiflur sem eru að mestu leyti svipaðar frá ári til árs\n\nNotum GAM (Generalized Additive Models) til að meta bæði ferlin saman. Splæsibrúunin (e. splines) metur ferlið í tveimur hlutum, línulegum og ólínulegum, og notar stika til að toga ólínulega hlutann í átt að línulegu ferli.\n\nÞar sem hæga þróunin getur verið að breytast mishratt á mismunandi árabilum notum við aðlögunarsplæsibrúun (e. adaptive smoother) þar sem ólínulegi stikinn fær að breytast með tíma. Í kóðanum er þetta táknað með s(timi, bs = \"ad\")\nÁrstíðarferlið hefur þær skorður að frávikið í upphafi og byrjun ársins á að stefna í sömu tölu, þ.e. \\(\\text{31. desember} \\approx \\text{1. janúar}\\). Pakkinn mgcv býður upp á slíka hringrásarsplæsara (e. cyclic smooths) [alveg í ruglinu með íslenskuna núna]. Í kóðanum er þetta táknað með s(manudur, bs = \"cc\")\n\nÞegar við erum komin með mat á þessi tvö ferli er lítið mál að heilda yfir árstíðarbundnu sveiflurnar. Við vigtum árstíðarbundna matið eftir nákvæmni matsins í hverjum mánuði (einum deilt með staðalvillu matsins) og reiknum svo meðaltal eftir því.\nAllt í allt metum við þá líkanið svona (einfölduð útgáfa af kóða):\ngam(Opinbert ~ s(manudur, bs = \"cc\") + s(timi, bs = \"ad\"), offset = log(Heild), family = nb())\nFjöldi opinbers starfsfólks er jákvæð fjöldatala svo fyrsta ágískunin er alltaf neikvæða tvíkostadreifingin. Við metum líkanið á lograkvarða, bæði því það er náttúrulega matið fyrir dreifinguna, en líka því við búumst við því að útkoman breytist hlutfallslega milli ára.\nHér fyrir neðan sjáum við svo matið á árstíðaráhrifum:\n\n\nCode\nplot_dat <- emmeans(m, ~ manudur, at = list(manudur = seq(1, 12, length.out = 100))) |> \n    tidy(type = \"response\") |> \n    mutate(response = exp(log(response) - mean(log(response))))\n\nplot_dat |> \n    ggplot(aes(manudur, response)) +\n    geom_hline(yintercept = 1, lty = 2) +\n    geom_line() +\n    geom_rangeframe() +\n    scale_x_continuous(breaks = 1:12,\n                       labels = c(\"Janúar\", \"Febrúar\", \"Mars\",\n                                  \"Apríl\", \"Maí\", \"Júní\",\n                                  \"Júli\", \"Ágúst\", \"September\",\n                                  \"Október\", \"Nóvember\", \"Desember\")) +\n    scale_y_continuous(labels = function(x) percent(x - 1),\n                       breaks = c(range(plot_dat$response), 1, 1.03),\n                       limits = c(0.92, 1.08)) +\n    theme_tufte() +\n    theme(plot.title = element_text(face = \"bold\")) +\n    labs(x = \"Mánuður\",\n         y = \"Árstíðarbundnar sveiflur\",\n         title = \"Árstíðarsveiflur í hlutfalli opinbers starfsfólks\")\n\n\n\n\n\n\n\nHlutall (p) opinbers starfsfólks (O) af heildarfjölda starfsfólks (H) má skrifa\n\\[\np = \\frac{O}{H},\n\\]\nÞar sem \\(H\\) inniheldur líka starfsfólk á almennum vinnumarkaði (A), s.s. \\(H = O + A\\).\nSkoðum hlutfallið á tveimur mismunandi tímapunktum, \\(p_1\\) og \\(p_2\\).\n\\[\n\\frac{p_2}{p_1} = \\frac{O_2/H_2}{O_1/H_1} = \\frac{O_2/O_1}{H_2/H_1}.\n\\]\nEf \\(p_2 > p_1\\) og \\(p_1 \\neq 0\\) gildir að \\(p_2/p_1 > 1\\) og því\n\\[\n\\begin{aligned}\n\\frac{O_2/O_1}{H_2/H_1} &> 1 \\\\\n\\rightarrow \\frac{O_2}{O_1} &> \\frac{H_2}{H_1},\n\\end{aligned}\n\\]\nþ.e. fjöldi opinbers starfsfólks hefur vaxið hlutfallslega hraðar en fjöldi starfsfólks alls.\nÞetta er kannski augljóst, en það er gott að hafa þetta í huga þegar hlutfallið hækkar og athuga hvort það sé vegna mikilla opinberra ráðninga eða fækkunar starfa á almennum vinnumarkaði.\nHér nota ég GAM til að smootha gögnin og nota svo árstíðaleiðrétt smooth gögn til að reikna stöðugar mánaðarlegar breytingar og teiknum þær svo.\n\n\n\n\n\n\n\n\nÁrlegar breytingar\n\nHrein breytingEftir bakgrunniHlutfallsleg breytingEftir bakgrunni\n\n\n\n\nCode\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |> \n    mutate(Heild = Annad + Opinbert) |> \n    pivot_longer(c(-dags), names_to = \"tegund\", values_to = \"n\") |> \n    filter(year(dags) >= 2008) |>  \n    mutate(manudur = month(dags)) |>\n    group_by(manudur, tegund) |>  \n    mutate(breyting = c(0, diff(n)),\n           uppsofnud_breyting = cumsum(breyting)) |> \n    ungroup() |> \n    filter(year(dags) > min(year(dags))) |> \n    mutate(tegund = fct_recode(tegund,\n                               \"Almennur\" = \"Annad\",\n                               \"Opinber\" = \"Opinbert\"))\n\np <- plot_dat |> \n    ggplot(aes(dags, breyting)) +  \n    # geom_vline(xintercept = ymd(seq.Date(from = min(plot_dat$dags),\n    #                                      to = ymd(\"2022-01-01\"),\n    #                                      by = \"year\")), lty = 2, alpha = 0.1) +\n    geom_hline(yintercept = 1, lty = 2, alpha = 0.6) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags)),\n              aes(label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    geom_rangeframe() +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2023-10-01\"))) +  \n    scale_y_continuous(labels = label_number(big.mark = \".\", decimal.mark = \",\"),\n                       breaks = c(range(plot_dat$breyting), -1.5e4, -1e4, -5e3, 0, 5e3, 1e4, 1.5e4)) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    # coord_cartesian(ylim = c(0.84, 1.127)) +\n    labs(x = NULL, y = NULL,  \n         title = \"Hrein árleg breyting á fjölda starfsfólks á vinnumarkaði (2009 - 2022)\",\n         subtitle = \"Y-ás táknar mun á fjölda vinnandi frá sama mánuði á síðasta ári\") +  \n    theme_tufte() +  \n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n          legend.position = \"none\",\n          plot.title = element_text(face = \"bold\"))\n\np\n\n\n\n\n\nCode\nggsave(plot = p, filename = \"hrein_breyting_saman.png\",\n       width = 8, height = 0.5 * 8, scale = 1.3, bg = \"white\")\n\n\n\n\n\n\nCode\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\") |>  \n    count(dags, tegund, bakgrunnur, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |> \n    mutate(Heild = Annad + Opinbert) |> \n    pivot_longer(c(-dags, -bakgrunnur), names_to = \"tegund\", values_to = \"n\") |> \n    filter(year(dags) >= 2008) |>  \n    mutate(manudur = month(dags)) |>\n    group_by(manudur, tegund, bakgrunnur) |>  \n    mutate(breyting = c(0, diff(n)),\n           uppsofnud_breyting = cumsum(breyting)) |> \n    ungroup() |> \n    filter(year(dags) > min(year(dags))) |> \n    mutate(tegund = fct_recode(tegund,\n                               \"Almennur\" = \"Annad\",\n                               \"Opinber\" = \"Opinbert\"),\n           y = breyting,\n           y = case_when(tegund == \"Heild\" ~ y * 1.06,\n                         tegund == \"Almennur\" ~ y * 0.95,\n                         TRUE ~ y))\n\np1 <- plot_dat |> \n    filter(bakgrunnur == \"Íslenskur bakgrunnur\") |> \n    ggplot(aes(dags, breyting)) +  \n    geom_line(data = tibble(x = range(plot_dat$dags), y = c(0, 0)),\n              aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes =) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Íslenskur bakgrunnur\"),\n              aes(y = y, label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    geom_rangeframe(sides = \"l\") +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%b/%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n    scale_y_continuous(labels = label_number(),\n                       breaks = c(0, range(plot_dat$breyting[plot_dat$bakgrunnur == \"Íslenskur bakgrunnur\"])),\n                       limits = range(plot_dat$breyting[plot_dat$bakgrunnur == \"Íslenskur bakgrunnur\"]), \n                       oob = oob_keep) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    facet_grid(bakgrunnur ~ .) +\n    labs(x = NULL, y = NULL,\n         title = \"Hrein árleg breyting á fjölda starfsfólks á vinnumarkaði (2009 - 2022)\",\n         subtitle = \"Y-ás táknar mun á fjölda vinnandi frá sama mánuði árið á undan\",) +  \n    theme_tufte() +  \n    coord_cartesian(clip = \"off\") +\n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n          legend.position = \"none\",\n          plot.title = element_text(face = \"bold\"),\n          strip.background = element_rect(fill = \"grey95\", colour = NA),\n          axis.text.x = element_blank(),\n          axis.ticks.x = element_blank())\n\np2 <- plot_dat |> \n    filter(bakgrunnur == \"Innflytjendur\") |> \n    ggplot(aes(dags, breyting)) +  \n    geom_line(data = tibble(x = range(plot_dat$dags), y = c(0, 0)),\n              aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes = FALSE) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Innflytjendur\"),\n              aes(y = y, label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    geom_rangeframe(sides = \"l\") +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%b/%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n    scale_y_continuous(labels = label_number(),\n                       breaks = c(0, range(plot_dat$breyting[plot_dat$bakgrunnur == \"Innflytjendur\"])),\n                       limits = range(plot_dat$breyting[plot_dat$bakgrunnur == \"Innflytjendur\"]),\n                       oob = oob_keep) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    facet_grid(bakgrunnur ~ .) +\n    labs(x = NULL, y = NULL) +  \n    theme_tufte() +  \n    coord_cartesian(clip = \"off\") +\n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 9),\n          legend.position = \"none\",\n          plot.title = element_text(face = \"bold\"),\n          strip.background = element_rect(fill = \"grey95\", colour = NA),\n          axis.text.x = element_blank(),\n          axis.ticks.x = element_blank())\n\np3 <- plot_dat |> \n    filter(bakgrunnur == \"Alls\") |> \n    ggplot(aes(dags, breyting)) +  \n    geom_line(data = tibble(x = range(plot_dat$dags), y = c(0, 0)),\n              aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes = FALSE) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Alls\"),\n              aes(y = y, label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    geom_rangeframe() +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n    scale_y_continuous(labels = label_number(),\n                       breaks = c(range(plot_dat$breyting), 0),\n                       limits = range(plot_dat$breyting),\n                       oob = oob_keep) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    facet_grid(bakgrunnur ~ .) +\n    labs(x = NULL, y = NULL,) +  \n    theme_tufte() +  \n    coord_cartesian(clip = \"off\") +\n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n          legend.position = \"none\",\n          plot.title = element_text(face = \"bold\"),\n          strip.background = element_rect(fill = \"grey95\", colour = NA))\n\np <- plot_grid(p1, p2, p3, ncol = 1, rel_heights = c(1, 0.85, 1))\n\np\n\n\n\n\n\nCode\nggsave(plot = p, filename = \"hrein_breyting_saman_facet.png\",\n       width = 8, height = 0.7 * 8, scale = 1.2, bg = \"white\")\n\n\n\n\n\n\nCode\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\", bakgrunnur == \"Alls\") |>  \n    count(dags, tegund, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |> \n    mutate(Heild = Annad + Opinbert) |> \n    pivot_longer(c(-dags), names_to = \"tegund\", values_to = \"n\") |> \n    filter(year(dags) >= 2008) |>  \n    mutate(manudur = month(dags)) |>\n    group_by(manudur, tegund) |>  \n    mutate(breyting = c(1, exp(diff(log(n)))),\n           uppsofnud_breyting = exp(cumsum(log(breyting)))) |> \n    ungroup() |> \n    filter(year(dags) > min(year(dags))) |> \n    mutate(tegund = fct_recode(tegund,\n                               \"Almennur\" = \"Annad\",\n                               \"Opinber\" = \"Opinbert\"))\n\np <- plot_dat |> \n    ggplot(aes(dags, breyting)) +  \n    # geom_vline(xintercept = ymd(seq.Date(from = min(plot_dat$dags),\n    #                                      to = ymd(\"2022-01-01\"),\n    #                                      by = \"year\")), lty = 2, alpha = 0.1) +\n    geom_hline(yintercept = 1, lty = 2, alpha = 0.6) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags)),\n              aes(label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    geom_rangeframe() +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2023-10-01\"))) +  \n    scale_y_log10(breaks = c(range(plot_dat$breyting, na.rm = T), 0.9, 0.95, 1, 1.05, 1.1),\n                  labels = function(x) percent(x - 1)) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    coord_cartesian(ylim = c(0.84, 1.127)) +\n    labs(x = NULL, y = NULL,  \n         title = \"Hlutfallsleg árleg breyting á fjölda starfsfólks á vinnumarkaði (2009 - 2022)\",\n         subtitle = \"Y-ás er á lograkvarða svo að -50% og +100% eru jafnlangt frá 0% breytingu\") +  \n    theme_tufte() +  \n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n          legend.position = \"none\",\n          plot.title = element_text(face = \"bold\"))\n\np\n\n\n\n\n\nCode\nggsave(plot = p, filename = \"hlutf_breyting_saman.png\",\n       width = 8, height = 0.621 * 8, scale = 1.3, bg = \"white\")\n\n\n\n\n\n\nCode\nplot_dat <- d |>  \n    filter(rekstrarform != \"Alls starfandi\") |>  \n    count(dags, tegund, bakgrunnur, wt = starfandi) |>  \n    pivot_wider(names_from = tegund, values_from = n) |> \n    mutate(Heild = Annad + Opinbert) |> \n    pivot_longer(c(-dags, -bakgrunnur), names_to = \"tegund\", values_to = \"n\") |> \n    filter(year(dags) >= 2008) |>  \n    mutate(manudur = month(dags)) |>\n    group_by(manudur, tegund, bakgrunnur) |>  \n    mutate(breyting = c(1, exp(diff(log(n))))) |> \n    ungroup() |> \n    filter(year(dags) > min(year(dags))) |> \n    mutate(tegund = fct_recode(tegund,\n                               \"Almennur\" = \"Annad\",\n                               \"Opinber\" = \"Opinbert\"),\n           y = breyting,\n           y = case_when(tegund == \"Heild\" ~ y * (1 - 0.015 * (bakgrunnur == \"Innflytjendur\")),\n                         tegund == \"Almennur\" ~ y * 1,\n                         TRUE ~ y))\n\np1 <- plot_dat |> \n    filter(bakgrunnur == \"Íslenskur bakgrunnur\") |> \n    ggplot(aes(dags, breyting)) +  \n    geom_line(data = tibble(x = range(plot_dat$dags), y = c(1, 1)),\n              aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes = FALSE) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Íslenskur bakgrunnur\"),\n              aes(y = y, label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    geom_rangeframe(sides = \"l\") +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%b/%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n    scale_y_log10(breaks = c(range(plot_dat$breyting[plot_dat$bakgrunnur == \"Íslenskur bakgrunnur\"], na.rm = T), 1),\n                  labels = function(x) percent(x - 1)) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    facet_grid(bakgrunnur ~ .) +\n    labs(x = NULL, y = NULL,\n         title = \"Hlutfallsleg árleg breyting á fjölda starfsfólks á vinnumarkaði (2009 - 2022)\",\n         subtitle = \"Y-ás er á lograkvarða svo að -50% og +100% eru jafnlangt frá 0% breytingu\") +  \n    theme_tufte() +  \n    coord_cartesian(clip = \"off\") +\n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n          legend.position = \"none\",\n          plot.title = element_text(face = \"bold\"),\n          strip.background = element_rect(fill = \"grey95\", colour = NA),\n          axis.text.x = element_blank(),\n          axis.ticks.x = element_blank())\n\np2 <- plot_dat |> \n    filter(bakgrunnur == \"Innflytjendur\") |> \n    ggplot(aes(dags, breyting)) +  \n    geom_line(data = tibble(x = range(plot_dat$dags), y = c(1, 1)),\n              aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes = FALSE) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Innflytjendur\"),\n              aes(y = y, label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    geom_rangeframe(sides = \"l\") +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%b/%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n    scale_y_log10(breaks = c(range(plot_dat$breyting[plot_dat$bakgrunnur == \"Innflytjendur\"], na.rm = T), 1),\n                  labels = function(x) percent(x - 1)) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    facet_grid(bakgrunnur ~ .) +\n    labs(x = NULL, y = NULL) +  \n    theme_tufte() +  \n    coord_cartesian(clip = \"off\") +\n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 9),\n          legend.position = \"none\",\n          plot.title = element_text(face = \"bold\"),\n          strip.background = element_rect(fill = \"grey95\", colour = NA),\n          axis.text.x = element_blank(),\n          axis.ticks.x = element_blank())\n\np3 <- plot_dat |> \n    filter(bakgrunnur == \"Alls\") |> \n    ggplot(aes(dags, breyting)) +  \n    geom_line(data = tibble(x = range(plot_dat$dags), y = c(1, 1)),\n              aes(x = x, y = y), lty = 2, alpha = 0.5, inherit.aes = FALSE) +\n    geom_line(aes(col = tegund)) +  \n    geom_text(data = plot_dat |> filter(dags == max(dags), bakgrunnur == \"Alls\"),\n              aes(y = y, label = tegund, col = tegund), hjust = 0, nudge_x = 10) +\n    geom_rangeframe(sides = \"lb\") +  \n    scale_x_date(breaks = seq.Date(from = min(plot_dat$dags), to = ymd(\"2022-01-01\"), by = \"year\"), \n                 date_labels = \"%Y\",  \n                 guide = guide_axis(n.dodge = 1),  \n                 expand = expansion(),\n                 limits = c(min(plot_dat$dags), ymd(\"2024-01-01\"))) +  \n    scale_y_log10(breaks = c(range(plot_dat$breyting[plot_dat$bakgrunnur == \"Alls\"], na.rm = T), 1),\n                  labels = function(x) percent(x - 1)) +  \n    scale_colour_brewer(type = \"qual\", palette = \"Set1\") +\n    facet_grid(bakgrunnur ~ .) +\n    labs(x = NULL, y = NULL,) +  \n    theme_tufte() +  \n    coord_cartesian(clip = \"off\") +\n    theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 5),\n          legend.position = \"none\",\n          plot.title = element_text(face = \"bold\"),\n          strip.background = element_rect(fill = \"grey95\", colour = NA))\n\np <- plot_grid(p1, p2, p3, ncol = 1, rel_heights = c(1, 0.85, 1))\n\np\n\n\n\n\n\nCode\nggsave(plot = p, filename = \"hrein_breyting_saman_facet.png\",\n       width = 8, height = 0.7 * 8, scale = 1.2, bg = \"white\")"
  },
  {
    "objectID": "posts/stjornsysla_heilbr/index.html",
    "href": "posts/stjornsysla_heilbr/index.html",
    "title": "Stjórnsýsla í heilbrigðiskerfinu",
    "section": "",
    "text": "Hér nota ég gögn Hagstofu um rekstrarútgjöld til heilbrigðismála eftir tegund þjónustu og fjármögnun 2003-2020 auk gagna frá hagstofum annarra norðurlanda um sama málaflokk. Einn flokkur í “Tegund þjónustu” er HC.7 Stjórnsýsla og fjármögnun heilbrigðiskerfa. Hagstofan birtir þessar tölur bara í krónum eða sem hlutfall af landsframleiðslu, en við getum náð í gögnin og reiknað hlutfall útgjalda sem fara í þennan flokk sjálf.\n\n\nCode\nisland <- pxweb_get(\n    url =\"https://px.hagstofa.is:443/pxis/api/v1/is/Efnahagur/fjaropinber/fjarmal_heilbr/THJ05551.px\", \n    query = list(\n        \"Fjármögnun (HF)\" = c(\"*\"),\n        \"Tegund þjónustu (HC)\"  = c(\"*\"),\n        \"Eining\" = c(\"*\"),\n        \"Ár\" = c(\"*\")\n    ),\n    verbose = FALSE\n) |> \n    as.data.frame() |> \n    as_tibble() |> \n    janitor::clean_names() |> \n    filter(str_detect(fjarmognun_hf, \"Hið\"),\n           str_detect(tegund_thjonustu_hc, \"^HC\\\\.[0-9] \"),\n           str_detect(eining, \"millj\")) |> \n    rename(value = 5) |> \n    select(tegund = 2, 4, 5) |> \n    mutate(ar = parse_number(ar)) |> \n    mutate(tegund = str_sub(tegund, start = 6)) |> \n    group_by(ar) |> \n    mutate(hlutf = value / sum(value)) |> \n    ungroup() |> \n    filter(str_detect(tegund, \"Stjórnsýsla\")) |> \n    select(ar, hlutf) |> \n    mutate(land = \"Ísland\")\n\n\nswe <- pxweb_get(\"https://api.scb.se/OV0104/v1/doris/en/ssd/START/NR/NR0109/HCHF\",\n                 query = list(\n                     \"HC\" = c(\"HC.7\", \"HC.0 - HC.7\"),\n                     \"Finansiar\" = c(\"HF.1.1.1\", \"HF.1.1.2.1\", \"HF1.1.2.2+HF1.1.2.3\"),\n                     \"ContentsCode\" = c(\"000001ZO\"),\n                     \"Tid\" = c(\"*\")\n                 )) |> \n    as.data.frame() |> \n    as_tibble() |> \n    janitor::clean_names() |> \n    count(function_of_health_care, year, wt = x2_total_health_care_expenditures_sek_million) |> \n    rename(type = 1) |> \n    mutate(type = str_sub(type, end = 3)) |> \n    pivot_wider(names_from = type, values_from = n) |> \n    mutate(hlutf = Gov / Tot,\n           year = parse_number(year),\n           land = \"Svíþjóð\") |> \n    select(land, ar = year, hlutf)\n\n\nnor <- pxweb_get(\"https://data.ssb.no/api/v0/en/table/11743/\",\n                 query = list(\"Sektor\" = c(\"6100\", \"6500\"),\n                              \"MedisinKost\" = c(\"HC.1-HC.7\", \"HC.7\"),\n                              \"ContentsCode\" = c(\"BelopLopende\"),\n                              \"Tid\" = c(\"*\"))) |> \n    as.data.frame() |> \n    as_tibble() |> \n    janitor::clean_names() |> \n    count(function_of_care, year, wt = health_expenditure_in_current_prices) |> \n    rename(type = 1) |> \n    mutate(year = parse_number(year),\n           type = str_sub(type, end = 3)) |> \n    pivot_wider(names_from = type, values_from = n) |> \n    mutate(hlutf = Gov / Cur,\n           land = \"Noregur\") |> \n    select(land, ar = year, hlutf)\n\n\ndanmork <- read.px(\"dk.px\") |> \n    as.data.frame() |> \n    as_tibble() |> \n    janitor::clean_names() |> \n    rename(type = 2) |> \n    count(time, type, wt = value) |> \n    mutate(type = ifelse(str_detect(type, \"^7\"), \"stjorns\", \"alls\")) |> \n    pivot_wider(names_from = type, values_from = n) |> \n    mutate(hlutf = stjorns / alls,\n           time = parse_number(as.character(time)),\n           land = \"Danmörk\") |> \n    select(ar = time, hlutf, land)\n\n\n\nplot_dat <- island |> \n    bind_rows(\n        swe,\n        nor,\n        danmork\n    ) |> \n    mutate(text = str_c(\"<b>\", land, \"</b>\\n\",\n                        \"Ár: \", ar, \"\\n\",\n                        \"Hlutfall: \", percent(hlutf, \n                                              accuracy = 0.1,\n                                              big.mark = \".\",\n                                              decimal.mark = \",\"), \"\\n\"))\n\n\n\n\nCode\np <- plot_dat |> \n    ggplot(aes(ar, hlutf, text = text)) +\n    geom_line(aes(group = land, col = land)) +\n    scale_x_continuous(breaks = c(2005, 2010, 2015, 2020)) +\n    scale_y_continuous(labels = label_percent(accuracy = 0.1),\n                       breaks = pretty_breaks(5),\n                       limits = c(0, 0.06),\n                       expand = expansion()) +\n    scale_colour_manual(values = c(\"#d95f02\",\n                                   \"#377eb8\",\n                                   \"#e41a1c\",\n                                   \"#ffff99\")) +\n    theme_half_open() +\n    theme(title = element_text(face = \"bold\", size = 12),\n          legend.position = \"right\") +\n    labs(x = NULL, y = NULL, col = NULL,\n         title = \"Hlutfall heilbrigðisútgjalda merkt \\\"Stjórnsýslu og fjármögnun heilbrigðiskerfa\\\"\")\n\nggsave(p + \n           theme_tufte() + \n           geom_rangeframe() +\n           geom_text(data = plot_dat |> group_by(land) |> filter(ar == max(ar)) |> ungroup(),\n                     aes(label = land, col = land),\n                     hjust = 0, nudge_x = 0.1) + \n           scale_x_continuous(breaks = 2002:2021,\n                              limits = c(NA, 2022)) +\n           scale_y_continuous(breaks = c(range(plot_dat$hlutf),0,   0.02, 0.03, 0.04, 0.05),\n                              labels = label_percent(accuracy = 0.1, big.mark = \".\",\n                                                     decimal.mark = \",\"),\n                              limits = c(0, 0.06),\n                              expand = expansion()) +\n           theme(plot.title = element_text(face = \"bold\"),\n                 legend.position = \"none\"),\n       filename = \"stjornsysl.png\",\n       width = 8, height = 0.5 * 8, scale = 1.3, bg = \"white\")\n\nggplotly(\n    p\n    ,\n    tooltip = \"text\"\n) |> \n    layout(hoverlabel = list(align = \"left\"))"
  },
  {
    "objectID": "posts/forest-plot-table/index.html",
    "href": "posts/forest-plot-table/index.html",
    "title": "Forest Plots with Built-In Tables",
    "section": "",
    "text": "I’ve seen this kind of figure poking around, but I didn’t really think about them until the other day I was asked about how to make one in R. Here I will walk through making one of these plots using the ggplot2 and cowplot packages.\nTo start with I have some fake data, d.\n\n\nCode\nd |> \n    kable(format = \"html\") |> \n    kable_styling(full_width = F)\n\n\n\n\n \n  \n    name \n    mean \n    lower \n    upper \n  \n \n\n  \n    Covfefe \n    1.1989430 \n    1.0707825 \n    1.358700 \n  \n  \n    Coffee \n    1.8509518 \n    1.5589701 \n    2.227752 \n  \n  \n    Variable \n    1.2181512 \n    1.0834045 \n    1.411683 \n  \n  \n    Covariate \n    1.1970336 \n    1.0699671 \n    1.342737 \n  \n  \n    Predictor \n    0.9085823 \n    0.8049225 \n    1.000000 \n  \n  \n    Smoking \n    0.8770238 \n    0.7447709 \n    1.000000 \n  \n  \n    Age \n    0.9344551 \n    0.8305984 \n    1.000000 \n  \n  \n    Uranium \n    0.9177338 \n    0.8021060 \n    1.000000 \n  \n  \n    Stuff \n    1.0760010 \n    1.0000000 \n    1.216474 \n  \n  \n    Thing \n    0.9143605 \n    0.7753231 \n    1.000000 \n  \n  \n    Koffing \n    1.0686924 \n    1.0000000 \n    1.178642 \n  \n  \n    Coughing \n    1.0648236 \n    1.0000000 \n    1.194998 \n  \n  \n    Polvo \n    0.9227277 \n    0.8097846 \n    1.000000 \n  \n\n\n\n\n\n\nThe Forest Plot\nThe forest plot itself is not hard to do. Notice how I create this striped pattern with geom_vline(aes(xintercept = name), col = \"grey95\", size = 5). I’ll do the same thing to the table part of the figure later.\n\n\nCode\np1 <- d |> \n    mutate(name = fct_reorder(name, mean)) |> \n    ggplot(aes(x = name, y = mean,\n                  ymin = lower, ymax = upper)) +\n    geom_vline(aes(xintercept = name), col = \"grey95\", size = 5) +\n    geom_hline(yintercept = 1, lty = 2) +\n    geom_point() +\n    geom_linerange() +\n    coord_flip() +\n    labs(x = NULL, y = NULL) +\n    theme(plot.margin = margin(t = 5, r = -4, b = 5, l = 5))\n\np1\n\n\n\n\n\n\n\nThe Table\nTo make the table look nice I convert the numbers to text and clean them up so that the text is justified nicely when plotting it. I did some manual tuning of the margins to make the plot and table line up nicely.\n\n\nCode\np2 <- d |> \n    mutate(name = fct_reorder(name, mean),\n           mean = round(mean, 2),\n           mean = str_pad(mean, width = 4, side = \"right\", pad = \"0\"),\n           lower = round(lower, 2),\n           lower = as.character(lower),\n           lower = ifelse(lower == \"1\", \"1.00\", lower),\n           lower = str_pad(lower, width = 4, side = \"right\", pad = \"0\"),\n           upper = round(upper, 2),\n           upper = as.character(upper),\n           upper = ifelse(upper == \"1\", \"1.00\", upper),\n           upper = str_pad(upper, width = 4, side = \"right\", pad = \"0\"),\n           ci = str_c(lower, \", \", upper)) |> \n    ggplot(aes(x = name)) +\n    geom_vline(aes(xintercept = name), col = \"grey95\", size = 5) +\n    geom_text(aes(label = mean, y = 1)) +\n    geom_text(aes(label = ci, y = 1.07)) +\n    coord_flip(ylim = c(0.99, 1.1)) +\n    theme(axis.title = element_blank(),\n          axis.text = element_blank(),\n          axis.ticks = element_blank(),\n          axis.line.y = element_blank(),\n          panel.border = element_blank(), \n          panel.grid = element_blank(), \n          plot.background = element_blank(),\n          plot.margin = margin(t = 5, r = 5, b = 19.3, l = 0))\n\np2\n\n\n\n\n\n\nThe finished bottom row\nNow we have alligned the plot and table. If you zoom in you might see that they don’t line up perfectly. I am not liable for any bodily harm caused by this.\n\n\nCode\nbottom_row <- plot_grid(p1, p2, nrow = 1, rel_widths = c(1, 0.3)) \n\nbottom_row\n\n\n\n\n\n\n\n\nThe headers\nI admit that this is a pretty handwavy manual way to make the header fit, and there is probably a nice way to automatically fit this using the coordinate system.\n\n\nCode\ntop_row <- ggplot(data = tibble()) +\n    geom_text(aes(y = 1, x = 0.02, label = \"Variable\"), size = 5) +\n    geom_text(aes(y = 1, x = 0.84, label = \"Mean\"), size = 5) +\n    geom_text(aes(y = 1, x = 0.98, label = \"95% CI\"), size = 5) +\n    coord_cartesian(xlim = c(0, 1)) +\n    theme_void() +\n    theme(plot.margin = margin(t = 0, r = 5, b = 0, l = 5),\n          axis.line.x.bottom = element_line())\n\n\ntop_row\n\n\n\n\n\n\n\nPutting it all together\nAnd so we come to the finished plot. If we wrangle the rel_heights setting a little bit we can get a pretty nice looking forest plot and table hybrid.\n\n\nCode\nplot_grid(top_row, bottom_row, ncol = 1, rel_heights = c(0.07, 1))\n\n\n\n\n\nThis was actually less of an inconvenience than I thought. The mixture of ggplot2 and cowplot made this a pretty easy task."
  },
  {
    "objectID": "talks/mbl_2022-08-10/index.html",
    "href": "talks/mbl_2022-08-10/index.html",
    "title": "Viðtal á mbl.is um Landspítalafærslu",
    "section": "",
    "text": "Viðtalið má finna hér"
  },
  {
    "objectID": "talks/mbl_2020-08-20/index.html",
    "href": "talks/mbl_2020-08-20/index.html",
    "title": "Viðtal á mbl.is um störf COVID-19 hópsins",
    "section": "",
    "text": "Viðtalið má finna hér"
  },
  {
    "objectID": "talks/hi-vefur/index.html",
    "href": "talks/hi-vefur/index.html",
    "title": "Viðtal á vef HÍ",
    "section": "",
    "text": "Viðtalið má finna hér"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Brynjólfur Gauti Guðrúnar Jónsson",
    "section": "",
    "text": "Ég er doktorsnemi í tölfræði við Verkfræði- og Náttúruvísindasvið Háskóla Íslands að rannsaka tölfræðilega skölun á hámarksúrkomu á klukkustundarskala frá veðurfræðilíkani á þéttu landfræðilegu neti. Auk þessa kenni ég Tölfræðiráðgjöf og vinn hjá Hjartavernd.\nÉg býð upp á tölfræðiráðgjöf gegn gjaldi og hvet þig til að hafa samband ef þig vantar aðstoð!"
  },
  {
    "objectID": "index.html#fyrirlestrar-viðtöl-og-fleira",
    "href": "index.html#fyrirlestrar-viðtöl-og-fleira",
    "title": "Brynjólfur Gauti Guðrúnar Jónsson",
    "section": "Fyrirlestrar, viðtöl og fleira",
    "text": "Fyrirlestrar, viðtöl og fleira\n\n\n\n\n\n\n\n\n\n\nViðtal á mbl.is um Landspítalafærslu\n\n\n\nviðtal\n\n\nlandspítali\n\n\níslenska\n\n\n\nKarlotta Líf Sumarliðadóttir tók viðtal við mig um færsluna mína þar sem ég fjallaði um starfsemisupplýsingar Landspítala. Viðtalið birtist á mbl.is 10. ágúst 2022.\n\n\n\n\n\n\nAug 10, 2022\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nViðtal á vef HÍ\n\n\n\nviðtal\n\n\níslenska\n\n\ncovid19\n\n\n\nHalldór Marteinsson tók viðtal við mig sem birtist á vef Háskóla Íslands 22. desember 2020.\n\n\n\n\n\n\nDec 22, 2020\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nViðtal á mbl.is um störf COVID-19 hópsins\n\n\n\nviðtal\n\n\ncovid19\n\n\níslenska\n\n\n\nAlexander Kristjánsson tók viðtal fyrir mbl.is við stóran hluta hópsins sem vann að COVID-19 spálíkanagerð á vegum Háskóla Íslands, Landspítala og Landlæknis. Viðtalið…\n\n\n\n\n\n\nAug 20, 2020\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCOVID-19 Spálíkan\n\n\n\nenglish\n\n\npresentation\n\n\ncovid19\n\n\nbayesian statistics\n\n\n\nÉg flutti erindi um aðferðafræðina á bak við COVID-19 spálíkan Háskóla Íslands, Landspítala og Embættis Landlæknis á StanCon árið 2020.\n\n\n\n\n\n\nAug 13, 2020\n\n\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "index.html#færslur",
    "href": "index.html#færslur",
    "title": "Brynjólfur Gauti Guðrúnar Jónsson",
    "section": "Færslur",
    "text": "Færslur\n\n\n\n\n  \n\n\n\n\nVísitala neysluverðs\n\n\nVísitalan og áhrif undirtalna á heildina\n\n\n\n\nefnahagur\n\n\nverðlag\n\n\nHagstofa\n\n\nR\n\n\níslenska\n\n\n\n\nVerðbólga er ekki alltaf það sama og verðbólga. Stundum er stór hluti af henni hækkun á húsnæðisverði, stundum ferðir og flutningar. Það er því gott að skoða undirvísitölurnar og áhrif þeirra á heildina.\n\n\n\n\n\n\nAug 30, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\nLandspítalinn\n\n\nHvaða upplýsingar eru til um rekstur Landspítalans og hvar má finna þær?\n\n\n\n\nlandspítali\n\n\nR\n\n\níslenska\n\n\n\n\nHvernig er nýting legurýma á Landspítala? Hvaða hlutfall launa fer í þessi margræddu millistjórnendastörf? Hér ætla ég aðeins að skoða hvaða gögn eru til um rekstur landspítalans, hvar má finna þau og hvað mætti betur fara í birtingu þeirra gagna.\n\n\n\n\n\n\nAug 24, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\nLaus störf\n\n\nNánari skoðun á gögnum Hagstofunnar um laus störf eftir atvinnugreinum og ársfjórðungum\n\n\n\n\nvinnumarkaður\n\n\nefnahagur\n\n\nHagstofa\n\n\nR\n\n\níslenska\n\n\n\n\nHagstofan birtir reglulega uppfærð gögn um fjölda og hlutfall lausra starfa eftir atvinnugreinum. Þar sem þessi gögn voru uppfærð í dag datt mér í hug að setja saman stutta samantekt á þeim sem ég get svo auðveldlega uppfært þegar gögnin sjálf eru uppfærð.\n\n\n\n\n\n\nAug 18, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\nStjórnsýsla í heilbrigðiskerfinu\n\n\nHvaða hlutfall útgjalda í heilbrigðiskerfinu er merkt stjórnsýslu og fjármögnun heilbrigðiskerfa?\n\n\n\n\nlandspítali\n\n\nHagstofa\n\n\nR\n\n\níslenska\n\n\n\n\nHér skoða ég hlutfall útgjalda heilbrigðiskerfisins sem er merkt stjórnsýslu og fjármögnun heilbrigðiskerfa. Ég teikna svo sama hlutfallið í Noregi, Svíþjóð og Danmörku til viðmiðunar.\n\n\n\n\n\n\nAug 13, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\nLeiga og kaupverð fasteigna\n\n\nHvernig ber leiguverði saman við afborganir húsnæðisláns?\n\n\n\n\nfasteignir\n\n\nefnahagur\n\n\nÞjóðskrá\n\n\nR\n\n\níslenska\n\n\n\n\nStundum er talað um að leiga vaxi of hratt, eða að hún vaxi hægar en húsnæðisverð. Hérna nota ég kaupskrá, leiguskrá og vaxtatöflu Landsbanka til að bera leigu saman við afborganir á óverðtryggðu láni með jöfnum greiðslum og breytilegum vöxtum að því gefnu að kaupandi fær lán fyrir 80% af kaupverði fasteignarinnar.\n\n\n\n\n\n\nJul 28, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\nVinnumarkaður\n\n\nHver er fjöldi starfandi einstaklinga og hvernig skiptast þeir á vinnumarkaði?\n\n\n\n\nefnahagur\n\n\nvinnumarkaður\n\n\nHagstofa\n\n\nR\n\n\níslenska\n\n\n\n\nReglulega sjást fyrirsagnir þar sem talað er um að opinbert starfsfólk sé allt of margt og að hlutfall þess af heildarfjölda vinnandi fólks sé of hátt. Hér kryf ég reglulega nýjustu gögnin til að geta vitað hvort slíkar fullyrðingar séu teknar úr samhengi eða endurspegli raunveruleikann.\n\n\n\n\n\n\nJul 17, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\nOrkumál\n\n\nHver er útblástur Íslands og hvernig er hann borið saman við önnur lönd?\n\n\n\n\norkumál\n\n\nOurWorldInData\n\n\nR\n\n\níslenska\n\n\n\n\nTil að vernda jörðina viljum við draga úr notkun jarðefnaeldsneytis, en einnig vilja þjóðir heims vaxa efnahagslega. Hér skoða ég hvað þjóðir nota margar kílówattstundir (kWh) af jarðefnaeldsneyti og eldsneyti alls per $ af landsframleiðslu. Ég skoða líka útblástur gróðurhúsaloftteguna við framleiðslu rafmagns og tengingu við landsframleiðslu.\n\n\n\n\n\n\nJul 15, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\nForest Plots with Built-In Tables\n\n\nCreating forest plots with coefficient tables in ggplot2 with cowplot\n\n\n\n\nenglish\n\n\nR\n\n\nplots\n\n\ntutorial\n\n\n\n\nI’ve seen this kind of figure poking around, but I didn’t really think about them until the other day I was asked about how to make one in R. Here I will walk through making one of these plots using the ggplot2 and cowplot packages.\n\n\n\n\n\n\nJun 28, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\nKjósendatryggð\n\n\nHvert missa flokkar kjósendur sína og hvaðan sækja þeir nýja?\n\n\n\n\nR\n\n\nkosningar\n\n\níslenska\n\n\n\n\nÍslenska Kosningarannsóknin er framkvæmd af Félagsvísindastofnun Háskóla Íslands, og mér finnst vinnan sem fer fram þar hreint út sagt frábær og upplýsingar um gögnin vel skipulagðar, enda eina sviðið sem ég veit að sé með eigin RStudio server innanhúss!\n\n\n\n\n\n\nJun 26, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\nDreifing húsnæðislánategunda hjá íslenskum heimilum\n\n\nDæmi um notkun Quarto og RStudio til að útbúa gagnvirkar HTML skýrslur\n\n\n\n\nefnahagur\n\n\nR\n\n\níslenska\n\n\n\n\n\n\n\n\n\n\n\nJun 23, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "posts.html",
    "href": "posts.html",
    "title": "Færslur",
    "section": "",
    "text": "Vísitalan og áhrif undirtalna á heildina\n\n\n\n\nefnahagur\n\n\nverðlag\n\n\nHagstofa\n\n\nR\n\n\níslenska\n\n\n\n\nVerðbólga er ekki alltaf það sama og verðbólga. Stundum er stór hluti af henni hækkun á húsnæðisverði, stundum ferðir og flutningar. Það er því gott að skoða undirvísitölurnar og áhrif þeirra á heildina.\n\n\n\n\n\n\nAug 30, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\n\nHvaða upplýsingar eru til um rekstur Landspítalans og hvar má finna þær?\n\n\n\n\nlandspítali\n\n\nR\n\n\níslenska\n\n\n\n\nHvernig er nýting legurýma á Landspítala? Hvaða hlutfall launa fer í þessi margræddu millistjórnendastörf? Hér ætla ég aðeins að skoða hvaða gögn eru til um rekstur landspítalans, hvar má finna þau og hvað mætti betur fara í birtingu þeirra gagna.\n\n\n\n\n\n\nAug 24, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\n\nNánari skoðun á gögnum Hagstofunnar um laus störf eftir atvinnugreinum og ársfjórðungum\n\n\n\n\nvinnumarkaður\n\n\nefnahagur\n\n\nHagstofa\n\n\nR\n\n\níslenska\n\n\n\n\nHagstofan birtir reglulega uppfærð gögn um fjölda og hlutfall lausra starfa eftir atvinnugreinum. Þar sem þessi gögn voru uppfærð í dag datt mér í hug að setja saman stutta samantekt á þeim sem ég get svo auðveldlega uppfært þegar gögnin sjálf eru uppfærð.\n\n\n\n\n\n\nAug 18, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\n\nHvaða hlutfall útgjalda í heilbrigðiskerfinu er merkt stjórnsýslu og fjármögnun heilbrigðiskerfa?\n\n\n\n\nlandspítali\n\n\nHagstofa\n\n\nR\n\n\níslenska\n\n\n\n\nHér skoða ég hlutfall útgjalda heilbrigðiskerfisins sem er merkt stjórnsýslu og fjármögnun heilbrigðiskerfa. Ég teikna svo sama hlutfallið í Noregi, Svíþjóð og Danmörku til viðmiðunar.\n\n\n\n\n\n\nAug 13, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\n\nHvernig ber leiguverði saman við afborganir húsnæðisláns?\n\n\n\n\nfasteignir\n\n\nefnahagur\n\n\nÞjóðskrá\n\n\nR\n\n\níslenska\n\n\n\n\nStundum er talað um að leiga vaxi of hratt, eða að hún vaxi hægar en húsnæðisverð. Hérna nota ég kaupskrá, leiguskrá og vaxtatöflu Landsbanka til að bera leigu saman við afborganir á óverðtryggðu láni með jöfnum greiðslum og breytilegum vöxtum að því gefnu að kaupandi fær lán fyrir 80% af kaupverði fasteignarinnar.\n\n\n\n\n\n\nJul 28, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\n\nHver er fjöldi starfandi einstaklinga og hvernig skiptast þeir á vinnumarkaði?\n\n\n\n\nefnahagur\n\n\nvinnumarkaður\n\n\nHagstofa\n\n\nR\n\n\níslenska\n\n\n\n\nReglulega sjást fyrirsagnir þar sem talað er um að opinbert starfsfólk sé allt of margt og að hlutfall þess af heildarfjölda vinnandi fólks sé of hátt. Hér kryf ég reglulega nýjustu gögnin til að geta vitað hvort slíkar fullyrðingar séu teknar úr samhengi eða endurspegli raunveruleikann.\n\n\n\n\n\n\nJul 17, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\n\nHver er útblástur Íslands og hvernig er hann borið saman við önnur lönd?\n\n\n\n\norkumál\n\n\nOurWorldInData\n\n\nR\n\n\níslenska\n\n\n\n\nTil að vernda jörðina viljum við draga úr notkun jarðefnaeldsneytis, en einnig vilja þjóðir heims vaxa efnahagslega. Hér skoða ég hvað þjóðir nota margar kílówattstundir (kWh) af jarðefnaeldsneyti og eldsneyti alls per $ af landsframleiðslu. Ég skoða líka útblástur gróðurhúsaloftteguna við framleiðslu rafmagns og tengingu við landsframleiðslu.\n\n\n\n\n\n\nJul 15, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\n\nCreating forest plots with coefficient tables in ggplot2 with cowplot\n\n\n\n\nenglish\n\n\nR\n\n\nplots\n\n\ntutorial\n\n\n\n\nI’ve seen this kind of figure poking around, but I didn’t really think about them until the other day I was asked about how to make one in R. Here I will walk through making one of these plots using the ggplot2 and cowplot packages.\n\n\n\n\n\n\nJun 28, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\n\nHvert missa flokkar kjósendur sína og hvaðan sækja þeir nýja?\n\n\n\n\nR\n\n\nkosningar\n\n\níslenska\n\n\n\n\nÍslenska Kosningarannsóknin er framkvæmd af Félagsvísindastofnun Háskóla Íslands, og mér finnst vinnan sem fer fram þar hreint út sagt frábær og upplýsingar um gögnin vel skipulagðar, enda eina sviðið sem ég veit að sé með eigin RStudio server innanhúss!\n\n\n\n\n\n\nJun 26, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\n  \n\n\n\n\n\nDæmi um notkun Quarto og RStudio til að útbúa gagnvirkar HTML skýrslur\n\n\n\n\nefnahagur\n\n\nR\n\n\níslenska\n\n\n\n\n\n\n\n\n\n\n\nJun 23, 2022\n\n\nBrynjólfur Gauti Guðrúnar Jónsson\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "pages/radgjof.html",
    "href": "pages/radgjof.html",
    "title": "Ráðgjöf",
    "section": "",
    "text": "Ég hef mikla reynslu í ráðgjöf þar sem ég kennt Tölfræðiráðgjöf við Háskóla Íslands núna í nokkur ár og starfaði áður í Tölfræðiráðgjöf Heilbrigðisvísindasviðs Háskóla Íslands.\n\n  \n    \n\n    \n  \n    \n     \n  \n  \n    \n     \n  \n  \n    \n     \n  \n  \n    \n     \n  \n\n  \n  \nÉg býð upp á aðstoð við meðal annars:\n\nSkipulag gagnasöfnunar fyrir rannsóknir\nGagnahreinsun til að undirbúa fyrir líkanasmíð\nVal á tölfræðiaðferð\nFramkvæmd tölfræðilegra greininga\nFramsetningu niðurstaðna í myndum, töflum og texta\nÞróa gagnvirk mælaborð sem gefa yfirsýn yfir gögn og starfsemi (sjá mælaborð hér efst uppi fyrir dæmi)\nÞróa áhættureikna eða spálíkön og meta gæði þeirra á nýjum gögnum\n\nEf þig vantar aðstoð með tölfræði af einhverju tagi endilega hafðu samband við mig í tölvupósti.\n\n\nVerðið er mismunandi eftir umfangi og tímaþröng verkefnisins. Þegar tími leyfir býð ég upp á 30 mínútna ókeypis ráðgjöf til að fara yfir þarfir verkefnisins þar sem við getum svo í kjölfarið náð samkomulagi um verð.\n\n\n\n\n\n\nTo consult the statistician after an experiment is finished is often merely to ask him to conduct a post mortem examination. He can perhaps say what the experiment died of.\n\n\nRonald Fisher"
  },
  {
    "objectID": "pages/covid_spalikan.html",
    "href": "pages/covid_spalikan.html",
    "title": "COVID-19 Spálíkan",
    "section": "",
    "text": "Ég flutti erindi um aðferðafræðina á bak við COVID-19 spálíkan Háskóla Íslands, Landspítala og Embættis Landlæknis á StanCon árið 2020. Fyrirlesturinn má sjá í spilaranum að neðan:"
  },
  {
    "objectID": "pages/about.html",
    "href": "pages/about.html",
    "title": "Brynjólfur Gauti Guðrúnar Jónsson",
    "section": "",
    "text": "Auk þessa kenni ég Tölfræðiráðgjöf og vinn hjá Hjartavernd."
  }
]