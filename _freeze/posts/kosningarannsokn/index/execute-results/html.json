{
  "hash": "b60750e2b92edff44c7085cc25c653a0",
  "result": {
    "markdown": "---\ntitle: \"Kjósendatryggð\"\nsubtitle: \"Hvert missa flokkar kjósendur sína og hvaðan sækja þeir nýja?\"\ndescription: |\n    Unnið úr kosningarannsóknum Félagsvísindastofnunar Háskóla Íslands frá 2003 til 2017\nauthor: \n    -   name: \"Brynjólfur Gauti Guðrúnar Jónsson\"\n        url: \"https://twitter.com/bgautijonsson\"\n        affiliation: \"Tölfræði, Raunvísindadeild Háskóla Íslands\"\n        affiliation-url: \"https://www.hi.is/tolfraedi_0\"\ndate: today\nformat: \n    html:\n        code-fold: true\n        toc: true\n        toc-location: right\n        toc-title: Efnisyfirlit\n        page-layout: full\neditor: source\ntheme: flatly\ntitle-block-banner: true\nstandalone: true\nself-contained: true\n---\n\n\n\n\n# Hvert fara atkvæðin?\n\n## Útbúa gögnin\n\n\n::: {.cell}\n\n```{.r .cell-code}\npreprocess_data_attrition <- function(doi, filename, year) {\n    get_dataframe_by_name(filename,\n                          doi,\n                          original = TRUE,\n                          .f = haven::read_sav) |> \n        select(current = starts_with(\"prtvote\"), former = starts_with(\"prtfvote\"), age) |> \n        mutate_at(vars(everything(), -age), as_factor) |> \n        filter(!as.character(current) %in% c(\"No, did not vote\",\n                                             \"Not applicable\",\n                                             \"Don‘t remember what I voted\",\n                                             \"95\",\n                                             \"Cast a blank or invalid ballot\",\n                                             \"Voted, refuses to say for what party\",\n                                             \"Other party, what party\",\n                                             \"Refuses to answer (volunteered)\",\n                                             \"Don’t know (volunteered)\",\n                                             \"Voted, does not want to say which party\",\n                                             \"Cast a blank ballot\",\n                                             \"Cast an invalid vote\",\n                                             \"Missing\",\n                                             \"Voted, doesn‘t want to say for what party\",\n                                             \"Another party or party list, which?\",\n                                             \"Refuses to answer\")) |> \n        drop_na(current) |> \n        group_by(current, former) |> \n        summarise(n = n(),\n                  age = mean(age),\n                  .groups = \"drop\") |> \n        arrange(former, desc(n)) |> \n        group_by(former) |> \n        mutate(p = n / sum(n),\n               cum_p = cumsum(p)) |> \n        ungroup() |> \n        mutate(year = year)\n}\n\ntranslate_parties <- function(name) {\n    parties <- c(\n        \"Independence Party\" = \"Sjálfstæðisflokkurinn\",\n        \"Progressive Party\" = \"Framsóknarflokkurinn\",\n        \"Social Democratic Alliance\" = \"Samfylkingin\",\n        \"Left Green Movement\" = \"Vinstri Græn\",\n        \"Pirate Party\" = \"Píratar\",\n        \"Reform Party\" = \"Viðreisn\",\n        \"Centre Party\" = \"Miðflokkurinn\",\n        \"Bright Future\" = \"Björt Framtíð\",\n        \"Peoples party\" = \"Flokkur Fólksins\",\n        \"Civic Movement\" = \"Borgarahreyfingin\",\n        \"Dawn\" = \"Dögun\",\n        \"Liberal Party\" = \"Frjálslyndi flokkurinn\",\n        \"Cast a blank or invalid ballot\" = \"Skilaði auðu\",\n        \"95\" = \"Nýr kjósandi\"\n    )\n    \n    ifelse(name %in% names(parties), parties[name], name)\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndoi <- c(\"doi:10.34881/1.00011\", \n         \"doi:10.34881/1.00010\",\n         \"doi:10.34881/1.00009\",\n         \"doi:10.34881/1.00008\",\n         \"doi:10.34881/1.00007\",\n         \"doi:10.34881/1.00006\")\nfilename <- c(\"ICENES_2017_Open_access_english_1release.tab\",\n              \"ICENES_2016_Open_access_english_2release.tab\",\n              \"ICENESS_2013_open_access_english_1release.tab\",\n              \"ICENES_2009_open_access_english_3release.tab\",\n              \"ICENES_2007_open_access_english_3release.tab\",\n              \"ICENES_2003_open_access_english_4release.tab\")\nyear <- c(2017,\n          2016,\n          2013,\n          2009,\n          2007,\n          2003)\n\nd_retention <- pmap(list(doi = doi, filename = filename, year = year), preprocess_data_attrition) |> \n    reduce(bind_rows) |> \n    mutate_at(vars(current, former), as.character) |> \n    mutate_at(vars(current, former), translate_parties)\n```\n:::\n\n\n\n### Litir flokkanna\n\n\n::: {.cell}\n\n```{.r .cell-code}\nxS <- \"#e41a1c\"\nxV <- \"#238b45\"\nxD <- \"#377eb8\"\nxP <- \"#984ea3\"\nxB <- \"#b2df8a\"\nxBF <- \"#cab2d6\"\nxC <- \"#ff7f00\"\nxM <- \"#08306b\"\nxFF <- \"#fee391\"\nAnnad <- \"#e5d8bd\"\n```\n:::\n\n\n## Kjósendatryggð\n\n\n::: {.cell fig.asp='0.5'}\n\n```{.r .cell-code}\nplot_dat <- d_retention |> \n    filter(current %in% c(\"Framsóknarflokkurinn\",\n                          \"Píratar\",\n                          \"Samfylkingin\",\n                          \"Sjálfstæðisflokkurinn\",\n                          \"Vinstri Græn\"),\n           current == former)\n\nplot_text <- plot_dat |> \n    filter(year == max(year)) |> \n    mutate(p = case_when(current == \"Píratar\" ~ p + 0.005,\n                         current == \"Framsóknarflokkurinn\" ~ p - 0.005,\n                         current == \"Samfylkingin\" ~ p + 0.00,\n                         TRUE ~ p))\n\n\np <- plot_dat |> \n    ggplot(aes(year, p)) +\n    geom_line(aes(col = current, group = current)) +\n    geom_point(aes(col = current, group = current)) +\n    geom_text(data = plot_text, \n              aes(label = current, col = current), hjust = 0, nudge_x = 0.2) +\n    geom_rangeframe() +\n    scale_y_continuous(limits = range(plot_dat$p), \n                       labels = label_percent(),\n                       breaks = c(range(plot_dat$p), 0.4, 0.5, 0.6, 0.7)) +\n    scale_x_continuous(breaks = c(2003, 2007, 2009, 2013, 2016, 2017),\n                       limits = c(2003, 2021.5)) +\n    scale_colour_manual(values = c(xB,\n                                   xP,\n                                   xS,\n                                   xD,\n                                   xV)) +\n    labs(title = \"Flokkshollusta í alþingiskosningum frá 2003 - 2017\",\n         subtitle = \"Hlutfall eigin kjósenda sem flokkur heldur í frá síðustu kosningum\",\n         x = NULL,\n         y = NULL) +\n    theme_tufte() +\n    theme(plot.caption = element_text(hjust = 0)) +\n    theme(legend.position = \"none\")\n\np\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=768}\n:::\n:::\n\n\n## Hvert missa flokkar kjósendur sína?\n\n:::{.panel-tabset}\n\n### Samfylkingin\n\n\n::: {.cell fig.asp='0.5'}\n\n```{.r .cell-code}\np <- d_retention |> \n    filter(former == \"Samfylkingin\") |> \n    mutate(current = ifelse(current %in% c(\"Samfylkingin\",\n                                           \"Vinstri Græn\",\n                                           \"Sjálfstæðisflokkurinn\", \n                                           \"Píratar\",\n                                           \"Framsóknarflokkurinn\", \n                                           \"Píratar\",\n                                           \"Björt Framtíð\",\n                                           \"Viðreisn\",\n                                           \"Miðflokkurinn\",\n                                           \"Flokkur Fólksins\"),\n                            current,\n                            \"Annað\")) |> \n    mutate(current = as_factor(current),\n           current = fct_reorder(current, p * (current != \"Annað\"), .fun = max)) |> \n    mutate(y_start = cum_p - p,\n           y_end = cum_p,\n           election = as.numeric(as.factor(year))) |>\n    ggplot(aes(election, p)) +\n    geom_col(aes(fill = current), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xFF,\n                                 xM,\n                                 xD,\n                                 xC,\n                                 xB,\n                                 xP,\n                                 xBF,\n                                 xV,\n                                 xS)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert missir Samfylkingin kjósendur sína?\")\n\np\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=768}\n:::\n:::\n\n\n### Sjálfstæðisflokkurinn\n\n\n::: {.cell fig.asp='0.5'}\n\n```{.r .cell-code}\np <- d_retention |> \n    filter(former == \"Sjálfstæðisflokkurinn\") |> \n    mutate(current = ifelse(current %in% c(\"Samfylkingin\",\n                                           \"Vinstri Græn\",\n                                           \"Flokkur Fólksins\",\n                                           \"Sjálfstæðisflokkurinn\", \n                                           \"Píratar\",\n                                           \"Framsóknarflokkurinn\", \n                                           \"Píratar\",\n                                           \"Björt Framtíð\",\n                                           \"Viðreisn\",\n                                           \"Miðflokkurinn\"),\n                            current,\n                            \"Annað\")) |> \n    mutate(current = as_factor(current),\n           current = fct_reorder(current, p * (current != \"Annað\"), .fun = max),\n           curent = factor(current, levels = rev(levels(current)))) |> \n    mutate(y_start = cum_p - p,\n           y_end = cum_p,\n           election = as.numeric(as.factor(year))) |>\n    ggplot(aes(election, p)) +\n    geom_col(aes(fill = current), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xP,\n                                 xFF,\n                                 xBF,\n                                 xV,\n                                 xM,\n                                 xC,\n                                 xB,\n                                 xS,\n                                 xD)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert missir Sjálfstæðisflokkurinn kjósendur sína?\")\n\np\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=768}\n:::\n:::\n\n\n### Framsóknarflokkurinn\n\n\n::: {.cell fig.asp='0.5'}\n\n```{.r .cell-code}\np <- d_retention |> \n    filter(former == \"Framsóknarflokkurinn\") |> \n    mutate(current = ifelse(current %in% c(\"Samfylkingin\",\n                                           \"Vinstri Græn\",\n                                           \"Flokkur Fólksins\",\n                                           \"Sjálfstæðisflokkurinn\", \n                                           \"Píratar\",\n                                           \"Framsóknarflokkurinn\", \n                                           \"Píratar\",\n                                           \"Björt Framtíð\",\n                                           \"Viðreisn\",\n                                           \"Miðflokkurinn\"),\n                            current,\n                            \"Annað\")) |> \n    mutate(current = as_factor(current),\n           current = fct_reorder(current, p * (current != \"Annað\"), .fun = max),\n           curent = factor(current, levels = rev(levels(current)))) |> \n    mutate(y_start = cum_p - p,\n           y_end = cum_p,\n           election = as.numeric(as.factor(year))) |>\n    ggplot(aes(election, p)) +\n    geom_col(aes(fill = current), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xBF,\n                                 xC,\n                                 xP,\n                                 xFF,\n                                 xV,\n                                 xS,\n                                 xD,\n                                 xM,\n                                 xB)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert missir Framsóknarflokkurinn kjósendur sína?\",\n         caption = \"Kóði og gögn: https://github.com/bgautijonsson/kosningarannsokn\")\n\np\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=768}\n:::\n:::\n\n\n### Vinstri Græn\n\n\n::: {.cell fig.asp='0.5'}\n\n```{.r .cell-code}\np <- d_retention |> \n    filter(former == \"Vinstri Græn\") |> \n    mutate(current = ifelse(current %in% c(\"Samfylkingin\",\n                                           \"Flokkur Fólksins\",\n                                           \"Vinstri Græn\",\n                                           \"Sjálfstæðisflokkurinn\", \n                                           \"Píratar\",\n                                           \"Framsóknarflokkurinn\", \n                                           \"Píratar\",\n                                           \"Björt Framtíð\",\n                                           \"Viðreisn\",\n                                           \"Miðflokkurinn\"),\n                            current,\n                            \"Annað\")) |> \n    mutate(current = as_factor(current),\n           current = fct_reorder(current, p * (current != \"Annað\"), .fun = max),\n           curent = factor(current, levels = rev(levels(current)))) |> \n    mutate(y_start = cum_p - p,\n           y_end = cum_p,\n           election = as.numeric(as.factor(year))) |>\n    ggplot(aes(election, p)) +\n    geom_col(aes(fill = current), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xM,\n                                 xFF,\n                                 xC,\n                                 xD,\n                                 xBF,\n                                 xB,\n                                 xP,\n                                 xS,\n                                 xV)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert missa Vinstri Græn kjósendur sína?\")\n\np\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=768}\n:::\n:::\n\n\n:::\n\n# Hvaðan koma atkvæðin?\n\n## Útbúa gögnin\n\n\n::: {.cell}\n\n```{.r .cell-code}\npreprocess_data_recruitment <- function(doi, filename, year) {\n    get_dataframe_by_name(filename,\n                          doi,\n                          original = TRUE,\n                          .f = haven::read_sav) |> \n        select(current = starts_with(\"prtvote\"), former = starts_with(\"prtfvote\"), age) |> \n        mutate_at(vars(everything(), -age), as_factor) |> \n        filter(!as.character(former) %in% c(\"No, did not vote\",\n                                            \"Not applicable\",\n                                            \"Don‘t remember what I voted\",\n                                            \"95\",\n                                            \"Cast a blank or invalid ballot\",\n                                            \"Voted, refuses to say for what party\",\n                                            \"Other party, what party\",\n                                            \"Refuses to answer (volunteered)\",\n                                            \"Don’t know (volunteered)\",\n                                            \"Voted, does not want to say which party\",\n                                            \"Cast a blank ballot\",\n                                            \"Cast an invalid vote\",\n                                            \"Missing\",\n                                            \"Voted, doesn‘t want to say for what party\",\n                                            \"Another party or party list, which?\",\n                                            \"Refuses to answer\")) |> \n        drop_na(former) |> \n        group_by(current, former) |> \n        summarise(n = n(),\n                  age = mean(age),\n                  .groups = \"drop\") |> \n        arrange(current, desc(n)) |> \n        group_by(current) |> \n        mutate(p = n / sum(n),\n               cum_p = cumsum(p)) |> \n        ungroup() |> \n        mutate(year = year)\n}\n\ntranslate_parties <- function(name) {\n    parties <- c(\n        \"Independence Party\" = \"Sjálfstæðisflokkurinn\",\n        \"Progressive Party\" = \"Framsóknarflokkurinn\",\n        \"Social Democratic Alliance\" = \"Samfylkingin\",\n        \"Left Green Movement\" = \"Vinstri Græn\",\n        \"Pirate Party\" = \"Píratar\",\n        \"Reform Party\" = \"Viðreisn\",\n        \"Centre Party\" = \"Miðflokkurinn\",\n        \"Bright Future\" = \"Björt Framtíð\",\n        \"Peoples party\" = \"Flokkur Fólksins\",\n        \"Civic Movement\" = \"Borgarahreyfingin\",\n        \"Dawn\" = \"Dögun\",\n        \"Liberal Party\" = \"Frjálslyndi flokkurinn\"\n    )\n    \n    ifelse(name %in% names(parties), parties[name], name)\n}\n\nd_recruitment <- pmap(list(doi = doi, filename = filename, year = year), preprocess_data_recruitment) |> \n    reduce(bind_rows) |> \n    mutate_at(vars(current, former), as.character) |> \n    mutate_at(vars(current, former), translate_parties)\n```\n:::\n\n\n## Nýliðun frá öðrum flokkum\n\n\n::: {.cell fig.asp='0.5'}\n\n```{.r .cell-code}\nplot_dat <- d_recruitment |> \n    filter(current %in% c(\"Framsóknarflokkurinn\",\n                          \"Píratar\",\n                          \"Samfylkingin\",\n                          \"Sjálfstæðisflokkurinn\",\n                          \"Vinstri Græn\"),\n           current != former,\n           !former %in% c(\"No, did not vote\",\n                          \"Not applicable\",\n                          \"Don‘t remember what I voted\",\n                          \"Nýr kjósandi\",\n                          \"Skilaði auðu\",\n                          \"Voted, refuses to say for what party\",\n                          \"Other party, what party\",\n                          \"Refuses to answer (volunteered)\",\n                          \"Don’t know (volunteered)\"),\n           !(current == \"Píratar\" & year == 2013), !(current %in% c(\"Flokkur Fólksins\", \"Viðreisn\") & year == 2016)) |> \n    group_by(current, year) |> \n    summarise(p = sum(p),\n              .groups = \"drop\")\n\nplot_text <- plot_dat |> \n    filter(year == max(year)) |> \n    mutate(p = case_when(current == \"Flokkur Fólksins\" ~ p + 0.025,\n                         current == \"Framsóknarflokkurinn\" ~ p - 0.01,\n                         current == \"Viðreisn\" ~ p - 0.01,\n                         TRUE ~ p))\n\n\np <- plot_dat |> \n    ggplot(aes(year, p)) +\n    geom_line(aes(col = current, group = current)) +\n    geom_point(aes(col = current, group = current)) +\n    geom_text(data = plot_text, \n              aes(label = current, col = current), hjust = 0, nudge_x = 0.2) +\n    geom_rangeframe() +\n    scale_y_continuous(limits = range(plot_dat$p), \n                       labels = label_percent(),\n                       breaks = c(range(plot_dat$p), 0.1, 0.2, 0.3, 0.4, 0.5, 0.6)) +\n    scale_x_continuous(breaks = c(2003, 2007, 2009, 2013, 2016, 2017),\n                       limits = c(2003, 2021.5)) +\n    scale_colour_manual(values = c(xB,\n                                   xP,\n                                   xS,\n                                   xD,\n                                   xV)) +\n    labs(title = \"Nýliðun kjósenda frá öðrum flokkum í alþingiskosningum frá 2003 - 2017\",\n         subtitle = \"Hlutfall kjósenda sem kusu annan flokk í síðustu kosningum\",\n         x = NULL,\n         y = NULL) +\n    theme_tufte() +\n    theme(plot.caption = element_text(hjust = 0)) +\n    theme(legend.position = \"none\")\n\np\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=768}\n:::\n:::\n\n\n\n## Hvaðan sækja flokkar kjósendur sína?\n\n::: {.panel-tabset}\n\n### Samfylkingin\n\n\n::: {.cell fig.asp='0.5'}\n\n```{.r .cell-code}\np <- d_recruitment |> \n    filter(current == \"Samfylkingin\") |> \n    mutate(former = ifelse(former %in% c(\"Samfylkingin\",\n                                         \"Vinstri Græn\",\n                                         \"Sjálfstæðisflokkurinn\", \n                                         \"Píratar\",\n                                         \"Framsóknarflokkurinn\", \n                                         \"Flokkur Fólksins\",\n                                         \"Píratar\",\n                                         \"Björt Framtíð\",\n                                         \"Viðreisn\",\n                                         \"Miðflokkurinn\"),\n                           former,\n                           \"Annað\")) |> \n    mutate(former = as_factor(former),\n           former = fct_reorder(former, p * (former != \"Annað\") + 1e-8 * (former == \"Miðflokkurinn\"), .fun = max),\n           election = as.numeric(as.factor(year))) |>\n    ggplot(aes(election, p)) +\n    geom_col(aes(fill = former), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xC,\n                                 xP,\n                                 xBF,\n                                 xB,\n                                 xD,\n                                 xV,\n                                 xS)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert sækir Samfylkingin kjósendur sína?\")\n\np\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=768}\n:::\n:::\n\n\n### Sjálfstæðisflokkurinn\n\n\n::: {.cell fig.asp='0.5'}\n\n```{.r .cell-code}\np <- d_recruitment |> \n    filter(current == \"Sjálfstæðisflokkurinn\") |> \n    mutate(former = ifelse(former %in% c(\"Samfylkingin\",\n                                         \"Vinstri Græn\",\n                                         \"Sjálfstæðisflokkurinn\", \n                                         \"Píratar\",\n                                         \"Framsóknarflokkurinn\", \n                                         \"Píratar\",\n                                         \"Björt Framtíð\",\n                                         \"Viðreisn\",\n                                         \"Miðflokkurinn\"),\n                           former,\n                           \"Annað\")) |> \n    mutate(former = as_factor(former),\n           former = fct_reorder(former, p * (former != \"Annað\"), .fun = max),\n           election = as.numeric(as.factor(year))) |>\n    ggplot(aes(election, p)) +\n    geom_col(aes(fill = former), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xBF,\n                                 xP,\n                                 xV,\n                                 xC,\n                                 xS,\n                                 xB,\n                                 xD)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert sækir Sjálfstæðisflokkurinn kjósendur sína?\")\n\np\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.png){width=768}\n:::\n:::\n\n\n### Framsóknarflokkurinn\n\n\n::: {.cell fig.asp='0.5'}\n\n```{.r .cell-code}\np <- d_recruitment |> \n    filter(current == \"Framsóknarflokkurinn\") |> \n    mutate(former = ifelse(former %in% c(\"Samfylkingin\",\n                                         \"Vinstri Græn\",\n                                         \"Sjálfstæðisflokkurinn\", \n                                         \"Píratar\",\n                                         \"Framsóknarflokkurinn\", \n                                         \"Píratar\",\n                                         \"Björt Framtíð\",\n                                         \"Viðreisn\",\n                                         \"Miðflokkurinn\"),\n                           former,\n                           \"Annað\")) |> \n    mutate(former = as_factor(former),\n           former = fct_reorder(former, p * (former != \"Annað\"), .fun = max),\n           election = as.numeric(as.factor(year))) |>\n    ggplot(aes(election, p)) +\n    geom_col(aes(fill = former), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xP,\n                                 xBF,\n                                 xC,\n                                 xV,\n                                 xS,\n                                 xD,\n                                 xB)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert sækir Framsóknarflokurinn kjósendur sína?\")\n\np\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=768}\n:::\n:::\n\n\n### Vinstri Græn\n\n\n::: {.cell fig.asp='0.5'}\n\n```{.r .cell-code}\np <- d_recruitment |> \n    filter(current == \"Vinstri Græn\") |> \n    mutate(former = ifelse(former %in% c(\"Samfylkingin\",\n                                         \"Vinstri Græn\",\n                                         \"Sjálfstæðisflokkurinn\", \n                                         \"Píratar\",\n                                         \"Framsóknarflokkurinn\", \n                                         \"Píratar\",\n                                         \"Björt Framtíð\",\n                                         \"Viðreisn\",\n                                         \"Miðflokkurinn\"),\n                           former,\n                           \"Annað\")) |> \n    mutate(former = as_factor(former),\n           former = fct_reorder(former, p * (former != \"Annað\"), .fun = max),\n           election = as.numeric(as.factor(year))) |>\n    ggplot(aes(election, p)) +\n    geom_col(aes(fill = former), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:6, labels = rev(unique(d_retention$year))) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xC,\n                                 xBF,\n                                 xD,\n                                 xP,\n                                 xB,\n                                 xS,\n                                 xV)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvaðan sækja Vinstri Græn kjósendur sína?\")\n\np\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-1.png){width=768}\n:::\n:::\n\n\n### Viðreisn\n\n\n::: {.cell fig.asp='0.5'}\n\n```{.r .cell-code}\np <- d_recruitment |> \n    filter(current == \"Viðreisn\") |> \n    mutate(former = ifelse(former %in% c(\"Samfylkingin\",\n                                         \"Vinstri Græn\",\n                                         \"Sjálfstæðisflokkurinn\", \n                                         \"Píratar\",\n                                         \"Framsóknarflokkurinn\", \n                                         \"Píratar\",\n                                         \"Björt Framtíð\",\n                                         \"Viðreisn\",\n                                         \"Miðflokkurinn\"),\n                           former,\n                           \"Annað\")) |> \n    mutate(former = as_factor(former),\n           former = fct_reorder(former, p * (former != \"Annað\"), .fun = max),\n           election = as.numeric(as.factor(year))) |>\n    ggplot(aes(election, p)) +\n    geom_col(aes(fill = former), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:2, labels = c(2016, 2017)) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xP,\n                                 xV,\n                                 xBF,\n                                 xB,\n                                 xS,\n                                 xD,\n                                 xC)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert sækir Viðreisn kjósendur sína?\")\n\np\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-16-1.png){width=768}\n:::\n:::\n\n\n### Píratar\n\n\n::: {.cell fig.asp='0.5'}\n\n```{.r .cell-code}\np <- d_recruitment |> \n    filter(current == \"Píratar\") |> \n    mutate(former = ifelse(former %in% c(\"Samfylkingin\",\n                                         \"Vinstri Græn\",\n                                         \"Sjálfstæðisflokkurinn\", \n                                         \"Píratar\",\n                                         \"Framsóknarflokkurinn\", \n                                         \"Píratar\",\n                                         \"Björt Framtíð\",\n                                         \"Viðreisn\",\n                                         \"Miðflokkurinn\"),\n                           former,\n                           \"Annað\")) |> \n    mutate(former = as_factor(former),\n           former = fct_reorder(former, p * (former != \"Annað\"), .fun = max),\n           election = as.numeric(as.factor(year))) |>\n    ggplot(aes(election, p)) +\n    geom_col(aes(fill = former), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:3, labels = c(2013, 2016, 2017)) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xC,\n                                 xB,\n                                 xD,\n                                 xBF,\n                                 xS,\n                                 xV,\n                                 xP)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvaðan sækja Píratar kjósendur sína?\")\n\np\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-17-1.png){width=768}\n:::\n:::\n\n\n### Miðflokurinn\n\n\n::: {.cell fig.asp='0.5'}\n\n```{.r .cell-code}\np <- d_recruitment |> \n    filter(current == \"Miðflokkurinn\") |> \n    mutate(former = ifelse(former %in% c(\"Samfylkingin\",\n                                         \"Vinstri Græn\",\n                                         \"Sjálfstæðisflokkurinn\", \n                                         \"Píratar\",\n                                         \"Framsóknarflokkurinn\", \n                                         \"Píratar\",\n                                         \"Björt Framtíð\",\n                                         \"Viðreisn\",\n                                         \"Miðflokkurinn\"),\n                           former,\n                           \"Annað\")) |> \n    mutate(former = as_factor(former),\n           former = fct_reorder(former, p * (former != \"Annað\"), .fun = max),\n           election = as.numeric(as.factor(year))) |>\n    ggplot(aes(election, p)) +\n    geom_col(aes(fill = former), position = \"stack\", width = 1, alpha = 0.7) +\n    scale_x_continuous(breaks = 1:1, labels = c(2017)) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(Annad,\n                                 xV,\n                                 xS,\n                                 xC,\n                                 xP,\n                                 xD,\n                                 xB,\n                                 xM)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvert sækir Miðflokkurinn kjósendur sína?\")\n\np\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-18-1.png){width=768}\n:::\n:::\n\n\n:::\n\n# Aldursdreifing kjósenda\n\n\n::: {.cell}\n\n```{.r .cell-code}\npreprocess_data_agedist <- function(doi, filename, year) {\n    get_dataframe_by_name(filename,\n                          doi,\n                          original = TRUE,\n                          .f = haven::read_sav) |> \n        select(current = starts_with(\"prtvote\"), former = starts_with(\"prtfvote\"), age) |> \n        mutate_at(vars(everything(), -age), as_factor) |> \n        filter(!as.character(current) %in% c(\"No, did not vote\",\n                                             \"Not applicable\",\n                                             \"Don‘t remember what I voted\",\n                                             \"95\",\n                                             \"Cast a blank or invalid ballot\",\n                                             \"Voted, refuses to say for what party\",\n                                             \"Other party, what party\",\n                                             \"Refuses to answer (volunteered)\",\n                                             \"Don’t know (volunteered)\",\n                                             \"Voted, does not want to say which party\",\n                                             \"Cast a blank ballot\",\n                                             \"Cast an invalid vote\",\n                                             \"Missing\",\n                                             \"Voted, doesn‘t want to say for what party\",\n                                             \"Another party or party list, which?\",\n                                             \"Refuses to answer\")) |> \n        drop_na(current) |> \n        mutate(year = year) |> \n        select(year, current, age)\n}\n\nd_agedist <- pmap(list(doi = doi, filename = filename, year = year), preprocess_data_agedist) |> \n    reduce(bind_rows) |> \n    mutate_at(vars(current), as.character) |> \n    mutate_at(vars(current), translate_parties)\n```\n:::\n\n\n\n\n## 2017\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd_agedist |> \n    mutate(age_binned = cut(age, \n                            breaks = c(0, 30, 40, 50, 60, Inf),\n                            labels = c(\"18 - 29 ára\",\n                                       \"30 - 39 ára\",\n                                       \"40 - 49 ára\",\n                                       \"50 - 59 ára\",\n                                       \"60+ ára\"),\n                            include.lowest = TRUE,\n                            right = FALSE),\n           current = ifelse(current %in% c(\"Samfylkingin\",\n                                           \"Vinstri Græn\",\n                                           \"Sjálfstæðisflokkurinn\", \n                                           \"Píratar\",\n                                           \"Framsóknarflokkurinn\", \n                                           \"Píratar\",\n                                           \"Björt Framtíð\",\n                                           \"Viðreisn\",\n                                           \"Miðflokkurinn\",\n                                           \"Flokkur Fólksins\"),\n                            current,\n                            \"Annað\")) |> \n    filter(year == max(year)) |> \n    count(age_binned, current) |> \n    group_by(age_binned) |> \n    mutate(p = n / sum(n)) |> \n    ungroup() |> \n    ggplot(aes(age_binned, n)) +\n    geom_col(aes(fill = current), position = \"fill\", width = 1, alpha = 0.7) +\n    scale_y_continuous(labels = label_percent()) +\n    scale_fill_manual(values = c(xBF,\n                                 xFF,\n                                 xB,\n                                 xM,\n                                 xP,\n                                 xS,\n                                 xD,\n                                 xC,\n                                 xV)) +\n    coord_cartesian(expand = F) +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(plot.caption = element_text(hjust = 0)) +\n    labs(x = NULL,\n         y = NULL,\n         fill = NULL,\n         title = \"Hvað kjósa mismunandi aldurshópar?\",\n         subtitle = \"Aldursdreifing kjósenda sýnd fyrir alþingiskosningar 2017\",\n         caption = \"Kóði og gögn: https://github.com/bgautijonsson/kosningarannsokn\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_dat <- d_agedist |> \n    filter(year == 2017) |> \n    mutate(age = as.numeric(age))\n\nplot_dat |> \n    ggplot(aes(age)) +\n    geom_density(data = plot_dat |> rename(cr = current), alpha = 0.5, fill = \"grey\") +\n    geom_density(aes(fill = current), alpha = 0.7) +\n    scale_fill_manual(values = c(xBF,\n                                 xFF,\n                                 xB,\n                                 xM,\n                                 xP,\n                                 xS,\n                                 xD,\n                                 xC,\n                                 xV)) +\n    facet_wrap(\"current\") +\n    theme_cowplot(font_size = 11, font_family = \"serif\") +\n    theme(legend.position = \"none\") +\n    labs(x = NULL,\n         y = NULL,\n         title = \"Aldursdreifing kjósenda eftir flokki (2017)\",\n         subtitle = \"Borið saman við aldursdreifingu heildarinnar\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}